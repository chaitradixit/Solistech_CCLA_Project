<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<title>
CCLA_ClientServices htmlIncludeOrString
</title>
</head>
<body>

<!-- Adds a Client Services link on the UCM home page. -->
<@dynamichtml std_main_page_begin@>

	<$include super.std_main_page_begin$>
	
<@end@>

<!-- Appends extra stylesheet for Client Services CSS. -->
<@dynamichtml ccla_cs_styles@>
	
	<$include iris_styles$>
	<link rel="stylesheet" href="<$HttpWebRoot$>resources/ccla/clientservices/clientservices_styles.css" type="text/css">
	
<@end@>

<!-- Global menubar, used on all Iris and CCLA-specific pages. Replaces the standard
	 iris_menubar include. 
	 
	 Cached at session scope for extra speed. -->
<@dynamichtml ccla_menubar@>
	<$if IsDebug$>ccla_menubar<$endif$>

	<script type="text/javascript">
		function glowMenuItem(entry) {
			entry.className="glowMenuItem"
		}

		function fadeMenuItem(entry) {
			entry.className="menuItem"
		}
	</script>

	
	<$menu_events = "class='menuItem' onmouseover='glowMenuItem(this)' onmouseout='fadeMenuItem(this)' "$>
	<$menu_current = "class='glowMenuItem'"$>

	<div class="menuBar">
		
		<$include ccla_menu_links$>
		
		
		<ul class="menuItems">

		<$if IsLoggedIn$>
	
			<$if userCanWrite$>
				
				<li <$menu_events$>>
					
				  <$menu_id           ="ccla_cs_search"$>
				  <$menu_button_text  ="Search"$>
				  <$menu_button_attr  ="class='menuLink' style='cursor:pointer'"$>
				  <$menu_justify      ="bottom left"$>
				  <$menu_style_prefix ="top"$>

				  <!-- Check the include below for action list entries -->
				  <$actionMenu_CustomInclude="ccla_cs_search_menu_popup"$>
				  <$include action_menu$>
					
				</li>
				
				<!-- CCLA report links action menu (toggled using text anchor) -->
				<li <$menu_events$>>

				  <$menu_id           ="ccla_cs_campagin"$>
				  <$menu_button_text  ="Campaign"$>
				  <$menu_button_attr  ="class='menuLink' style='cursor:pointer'"$>
				  <$menu_justify      ="bottom left"$>
				  <$menu_style_prefix ="top"$>

				  <!-- Check the include below for action list entries -->
				  <$actionMenu_CustomInclude="ccla_cs_campaign_menu_popup"$>
				  <$include action_menu$>

				</li>
				
				<!-- CCLA report links action menu (toggled using text anchor) -->
				<li <$menu_events$>>

				  <$menu_id           ="ccla_cs_reports"$>
				  <$menu_button_text  ="Reports"$>
				  <$menu_button_attr  ="class='menuLink' style='cursor:pointer'"$>
				  <$menu_justify      ="bottom left"$>
				  <$menu_style_prefix ="top"$>

				  <!-- Check the include below for action list entries -->
				  <$actionMenu_CustomInclude="ccla_cs_reports_menu_popup"$>
				  <$include action_menu$>

				</li>
				
				<$if userCanWrite$>
					<!-- 	Ensure user has read access on Public security group
								before displaying 'new item' link -->
					<li <$menu_events$> id="addNewDocLi">

						<a class="menuLink" href="<$addNewDocumentLink$>">Add new document</a>
					</li>

				<$endif$>
				
				<$if userHasRole(#env.USER_ROLE_EOD) or userHasRole("admin")$>
					
					<!-- CCLA report links action menu (toggled using text anchor) -->
					<li <$menu_events$>>

					  <$menu_id           ="ccla_cs_eod"$>
					  <$menu_button_text  ="PSDF"$>
					  <$menu_button_attr  ="class='menuLink' style='cursor:pointer'"$>
					  <$menu_justify      ="bottom left"$>
					  <$menu_style_prefix ="top"$>

					  <!-- Check the include below for action list entries -->
					  <$actionMenu_CustomInclude="ccla_cs_psdf_menu_popup"$>
					  <$include action_menu$>

					</li>			

				<$endif$>					
					
				<li <$menu_events$>>
					<a class="menuLink" href="<$userProfileLink$>">User Profile</a>
				</li>

			<$endif$>
			
			<$if userHasRole("admin")$> 
				<$if userHasRole("WF_COO") or userHasRole("WF_Scanning Manager") or userHasRole("admin")$>
								<!-- CCLA admin links action menu (toggled using text anchor) -->
					<li <$menu_events$>>

					  <$menu_id           ="ccla_cs_transbatch"$>
					  <$menu_button_text  ="Transaction Batch"$>
					  <$menu_button_attr  ="class='menuLink' style='cursor:pointer'"$>
					  <$menu_justify      ="bottom left"$>
					  <$menu_style_prefix ="top"$>

					  <!-- Check the include below for action list entries -->
					  <$actionMenu_CustomInclude="ccla_cs_transbatch_menu_popup"$>
					  <$include action_menu$>

					</li>		
				<$endif$>
			<$endif$>
			
			<$if userHasRole("WF_COO") or userHasRole("WF_Scanning Manager") or userHasRole("admin")$>
			
				<!-- CCLA admin links action menu (toggled using text anchor) -->
				<li <$menu_events$>>

				  <$menu_id           ="ccla_cs_admin"$>
				  <$menu_button_text  ="Admin"$>
				  <$menu_button_attr  ="class='menuLink' style='cursor:pointer'"$>
				  <$menu_justify      ="bottom left"$>
				  <$menu_style_prefix ="top"$>

				  <!-- Check the include below for action list entries -->
				  <$actionMenu_CustomInclude="ccla_cs_admin_menu_popup"$>
				  <$include action_menu$>

				</li>			

			<$endif$>

		<$endif$>

		<$if IsLoggedIn$>
			<li <$menu_events$>>

			  <$menu_id           ="ccla_cs_help"$>
			  <$menu_button_text  ="Help"$>
			  <$menu_button_attr  ="class='menuLink' style='cursor:pointer'"$>
			  <$menu_justify      ="bottom left"$>
			  <$menu_style_prefix ="top"$>

			  <!-- Check the include below for action list entries -->
			  <$actionMenu_CustomInclude="ccla_cs_help_menu_popup"$>
			  <$include action_menu$>

			</li>					
		<$endif$>

		</ul>

	</div>

<@end@>

<!-- Stores all top menu links. Cached for speed -->
<@dynamichtml ccla_menu_links@>
	
	<$filingCabinetLink = HttpCgiPath & "?IdcService=IRIS_CLASSIFIED_ITEMS" & inc('add_idc_token_to_url')$>
	<$scannedEnvelopesLink = HttpCgiPath & "?IdcService=DOC_LISTING" & inc('add_idc_token_to_url')$>
	<$addNewDocumentLink = HttpCgiPath & "?IdcService=IRIS_NEW_ITEM" & inc('add_idc_token_to_url')$>
	
	<$processDatesLink = HttpCgiPath & "?IdcService=CCLA_PROCESS_DETAILS_ADMIN" & inc('add_idc_token_to_url')$>
	<$processDatesCalculatorLink = HttpCgiPath & "?IdcService=CCLA_PROCESS_DATE_CALCULATOR" & inc('add_idc_token_to_url')$>
	<$jobPriorityAdminLink = HttpCgiPath & "?IdcService=CCLA_JOB_PRIORITY_ADMIN" & inc('add_idc_token_to_url')$>
	<$publicHolidayAdminLink = HttpCgiPath & "?IdcService=CCLA_PUBLIC_HOLIDAY_ADMIN" & inc('add_idc_token_to_url')$>
	<$workGroupsAdminLink = HttpCgiPath & "?IdcService=CCLA_CP_WORKGROUPS_ADMIN" & inc('add_idc_token_to_url')$>
	<$cdbUserAdminLink = HttpCgiPath & "?IdcService=CCLA_CP_CDB_USER_ADMIN" & inc('add_idc_token_to_url')$>

	<$cacheAdminLink = HttpCgiPath & "?IdcService=CCLA_CACHABLES_ADMIN" & inc('add_idc_token_to_url')$>
	<$elementLockAdminLink = HttpCgiPath & "?IdcService=CCLA_CS_ELEMENT_LOCK_ADMIN" & inc('add_idc_token_to_url')$>

	<$systemConfigVarAdminLink = HttpCgiPath & "?IdcService=CCLA_SYSTEM_CONFIG_VAR_ADMIN" & inc('add_idc_token_to_url')$>
	<$InstructionRuleAdminLink = HttpCgiPath & "?IdcService=CCLA_CS_INSTR_RULE_ADMIN" & inc('add_idc_token_to_url')$>
	<$InstructionPriorityRuleAdminLink = HttpCgiPath & "?IdcService=CCLA_CS_INSTR_RULE_PRIORITY_ADMIN" & inc('add_idc_token_to_url')$>
	
	<$configurationLink = HttpCgiPath & "?IdcService=IRIS_PROFILE_LISTING" & inc('add_idc_token_to_url')$>
	<$routingModuleAdminLink = HttpCgiPath & "?IdcService=CCLA_CP_ROUTING_MODULE_ADMIN" & inc('add_idc_token_to_url')$>
	<$instructionListingAdminLink = HttpCgiPath & "?IdcService=CCLA_CP_INSTRUCTION_LISTING" & inc('add_idc_token_to_url')$>
	<$instructionAuditAdminLink = HttpCgiPath & "?IdcService=CCLA_CP_INSTRUCTION_AUDIT" & inc('add_idc_token_to_url')$>
	<$adminServerLink  = HttpCgiPath & "/cs-admin/pxs?IdcService=GET_ROOT_IDC_ADMIN_PAGE" & inc('add_idc_token_to_url')$>
	
	<$userProfileLink = HttpCgiPath & "?IdcService=IRIS_USER_PROFILE" & inc('add_idc_token_to_url')$>
	
	<$interactionListingLink = HttpCgiPath & "?IdcService=CCLA_CS_INTERACTION_LISTING" & inc('add_idc_token_to_url')$>
	<$processListingLink = HttpCgiPath & "?IdcService=CCLA_CS_PROCESS_LISTING" & inc('add_idc_token_to_url')$>
	<$activityListingLink = HttpCgiPath & "?IdcService=CCLA_CS_ACTIVITY_LISTING" & inc('add_idc_token_to_url')$>
	<$reviewTransferLink = HttpCgiPath & "?IdcService=CCLA_CS_REVIEW_FUND_TRANSFERS" & inc('add_idc_token_to_url')$>
	<$userProfileLink = HttpCgiPath & "?IdcService=IRIS_USER_PROFILE" & inc('add_idc_token_to_url')$>
	
	<$lockedItemsLink	= HttpCgiPath & "?IdcService=CCLA_LOCKED_ITEMS" & inc('add_idc_token_to_url')$>
	<$bankLineReconciliationLink = HttpCgiPath & "?IdcService=CCLA_CP_TRANSBATCH_LISTING" & inc('add_idc_token_to_url')$>
	<$outstandingCondinReconciliationLink = HttpCgiPath & "?IdcService=CCLA_CP_OUTSTANDING_DICONDIN" & inc('add_idc_token_to_url')$>	
	<$iatSweepLink = HttpCgiPath & "?IdcService=CCLA_CP_IAT_SWEEP" & inc('add_idc_token_to_url')$>	
	<$archiveDocsLink = HttpCgiPath & "?IdcService=CCLA_CP_ARCHIVE_DOCS" & inc('add_idc_token_to_url')$>	
	<$helpButtonAdminLink = HttpCgiPath & "?IdcService=CCLA_HELP_ADMIN" & inc('add_idc_token_to_url')$>	
	<$createInstructionLink = HttpCgiPath & "?IdcService=CCLA_CP_NEW_INSTRUCTION" & inc('add_idc_token_to_url')$>	
	<$bulkUpdateAccountFlagsLink = HttpCgiPath & "?IdcService=GET_DOC_PAGE&Action=GetTemplatePage&Page=CCLA_CS_ACCOUNT_FLAGS_BULK_EDIT" & inc('add_idc_token_to_url')$>
	
	<$shareClassDiscrepancyLink = HttpCgiPath & "?IdcService=CCLA_TRANS_SC_DISCREPANCY" & inc('add_idc_token_to_url')$>
	
	
<@end@>

<@dynamichtml ccla_cs_psdf_menu_popup@>
<$if IsDebug$>ccla_cs_psdf_menu_popup<$endif$>
	<tr>
		<td class="<$menu_style_prefix$>PopupLink" nowrap onMouseOver="glowPopupRow(this,'<$menu_style_prefix$>PopupLink_over','<$menu_style_prefix$>PopupLink')"	onMouseOut="fadePopupRow(this,'<$menu_style_prefix$>PopupLink')">
			<a 	title="Start PSDF end of day"
				style="text-decoration: none; font-weight: normal; font-size: 8pt" href="?IdcService=CCLA_TRANS_START_EOD_PRECHECKS<$include add_idc_token_to_url$>">
				Start PSDF end of day
			</a>
		</td>
	</tr>
	<tr>
		<td class="<$menu_style_prefix$>PopupLink" nowrap onMouseOver="glowPopupRow(this,'<$menu_style_prefix$>PopupLink_over','<$menu_style_prefix$>PopupLink')"	onMouseOut="fadePopupRow(this,'<$menu_style_prefix$>PopupLink')">
			<a 	title="Start PSDF end of day with Date Range"
				style="text-decoration: none; font-weight: normal; font-size: 8pt" href="?IdcService=CCLA_TRANS_START_EOD_WITH_DATE<$include add_idc_token_to_url$>">
				Start PSDF end of day with date range
			</a>
		</td>
	</tr>
	<$if UserIsAdmin$>	
	<tr>
		<td class="<$menu_style_prefix$>PopupLink" nowrap onMouseOver="glowPopupRow(this,'<$menu_style_prefix$>PopupLink_over','<$menu_style_prefix$>PopupLink')"	onMouseOut="fadePopupRow(this,'<$menu_style_prefix$>PopupLink')">
			<a 	title="Start PSDF end of day"
				style="text-decoration: none; font-weight: normal; font-size: 8pt" href="?IdcService=CCLA_TRANS_PSDF_END_OF_MONTH_TRANSFERS<$include add_idc_token_to_url$>">
				Generate End of Month Transactions
			</a>
		</td>
	</tr>	
	<$endif$>
	<tr>
		<td class="<$menu_style_prefix$>PopupLink" nowrap onMouseOver="glowPopupRow(this,'<$menu_style_prefix$>PopupLink_over','<$menu_style_prefix$>PopupLink')"	onMouseOut="fadePopupRow(this,'<$menu_style_prefix$>PopupLink')">
			<a 	title="Share Classes"
				style="text-decoration: none; font-weight: normal; font-size: 8pt" href="?IdcService=CCLA_TRANS_SHARE_CLASS_LISTING<$include add_idc_token_to_url$>">
				Share Classes
			</a>
		</td>
	</tr>	
		<tr>
		<td class="<$menu_style_prefix$>PopupLink" nowrap onMouseOver="glowPopupRow(this,'<$menu_style_prefix$>PopupLink_over','<$menu_style_prefix$>PopupLink')"	onMouseOut="fadePopupRow(this,'<$menu_style_prefix$>PopupLink')">
			<a 	title="Share Group Listing"
				style="text-decoration: none; font-weight: normal; font-size: 8pt" href="?IdcService=CCLA_TRANS_SHARE_CLASS_GROUP_LISTING<$include add_idc_token_to_url$>">
				Share Group Listing
			</a>
		</td>
	</tr>
<@end@>

<@dynamichtml ccla_cs_help_menu_popup@>
<$if IsDebug$>ccla_cs_help_menu_popup<$endif$>
	<$if false$>
	[[%removing as it is no longer needed%]]
	<tr>
		<td class="<$menu_style_prefix$>PopupLink" nowrap onMouseOver="glowPopupRow(this,'<$menu_style_prefix$>PopupLink_over','<$menu_style_prefix$>PopupLink')"	onMouseOut="fadePopupRow(this,'<$menu_style_prefix$>PopupLink')">
			<a 	title="Client Services"
				style="text-decoration: none; font-weight: normal; font-size: 8pt" href="<$HttpWebRoot$>resources/ccla/clientservices/UCM Client Services User Guide.pdf">
				User Guide
			</a>
		</td>
	</tr>
	<$endif$>
	
	<tr>
		<td class="<$menu_style_prefix$>PopupLink" nowrap onMouseOver="glowPopupRow(this,'<$menu_style_prefix$>PopupLink_over','<$menu_style_prefix$>PopupLink')"	onMouseOut="fadePopupRow(this,'<$menu_style_prefix$>PopupLink')">
			<a 	title="Iris"
				style="text-decoration: none; font-weight: normal; font-size: 8pt" href="images/iris/IrisUserGuide.pdf">
				Iris User Guide
			</a>
		</td>
	</tr>	
<@end@>

<@dynamichtml ccla_cs_transbatch_menu_popup@>
<$if IsDebug$>ccla_cs_transbatch_menu_popup<$endif$>
	<tr>
		<td class="<$menu_style_prefix$>PopupLink" nowrap onMouseOver="glowPopupRow(this,'<$menu_style_prefix$>PopupLink_over','<$menu_style_prefix$>PopupLink')"	onMouseOut="fadePopupRow(this,'<$menu_style_prefix$>PopupLink')">
			<a 	title="Bankline Reconciliation"
				style="text-decoration: none; font-weight: normal; font-size: 8pt" href="<$bankLineReconciliationLink$>">
				Transaction Batch Processing
			</a>
		</td>
	</tr>	
	<tr>
		<td class="<$menu_style_prefix$>PopupLink" nowrap onMouseOver="glowPopupRow(this,'<$menu_style_prefix$>PopupLink_over','<$menu_style_prefix$>PopupLink')"	onMouseOut="fadePopupRow(this,'<$menu_style_prefix$>PopupLink')">
			<a 	title="IAT Sweep"
				style="text-decoration: none; font-weight: normal; font-size: 8pt" href="<$iatSweepLink$>">
				IAT Sweep
			</a>
		</td>
	</tr>	
	<tr>
		<td class="<$menu_style_prefix$>PopupLink" nowrap onMouseOver="glowPopupRow(this,'<$menu_style_prefix$>PopupLink_over','<$menu_style_prefix$>PopupLink')"	onMouseOut="fadePopupRow(this,'<$menu_style_prefix$>PopupLink')">
			<a 	title="Outstanding (Di/Bnk)Condins Matching"
				style="text-decoration: none; font-weight: normal; font-size: 8pt" href="<$outstandingCondinReconciliationLink$>">
				Outstanding Bank Transactions
		</td>
	</tr>	
<@end@>


<@dynamichtml ccla_cs_admin_menu_popup@>
<$if IsDebug$>ccla_cs_admin_menu_popup<$endif$>

	<$if UserIsAdmin$>
		<tr>
			<td class="<$menu_style_prefix$>PopupLink" nowrap onMouseOver="glowPopupRow(this,'<$menu_style_prefix$>PopupLink_over','<$menu_style_prefix$>PopupLink')"	onMouseOut="fadePopupRow(this,'<$menu_style_prefix$>PopupLink')">
				<a 	title="Admin Server"
					style="text-decoration: none; font-weight: normal; font-size: 8pt" href="<$adminServerLink$>">
					Admin Server
				</a>
			</td>
		</tr>
		
		<tr>
			<td class="<$menu_style_prefix$>PopupLink" nowrap onMouseOver="glowPopupRow(this,'<$menu_style_prefix$>PopupLink_over','<$menu_style_prefix$>PopupLink')"	onMouseOut="fadePopupRow(this,'<$menu_style_prefix$>PopupLink')">
				<a 	title="Admin Server"
					style="text-decoration: none; font-weight: normal; font-size: 8pt" href="?IdcService=GET_ADMIN_PAGE&Action=GetTemplatePage&Page=ADMIN_APPLETS">
					Admin Applets
				</a>
			</td>
		</tr>
	
		<tr>
			<td>
				<hr style="margin: 2px 0px; padding: 0px; height: 1px;"/>
			</td>
		</tr>
		
		<tr>
			<td class="<$menu_style_prefix$>PopupLink" nowrap onMouseOver="glowPopupRow(this,'<$menu_style_prefix$>PopupLink_over','<$menu_style_prefix$>PopupLink')"	onMouseOut="fadePopupRow(this,'<$menu_style_prefix$>PopupLink')">
				<a 	title="Configuration"
					style="text-decoration: none; font-weight: normal; font-size: 8pt" href="<$configurationLink$>">
					Iris Configuration
				</a>
			</td>
		</tr>
		<tr>
			<td class="<$menu_style_prefix$>PopupLink" nowrap onMouseOver="glowPopupRow(this,'<$menu_style_prefix$>PopupLink_over','<$menu_style_prefix$>PopupLink')"	onMouseOut="fadePopupRow(this,'<$menu_style_prefix$>PopupLink')">
				<a 	title="Routing Module Administration"
					style="text-decoration: none; font-weight: normal; font-size: 8pt" href="<$routingModuleAdminLink$>">
					Routing Module Admin
				</a>
			</td>
		</tr>
				<tr>
			<td class="<$menu_style_prefix$>PopupLink" nowrap onMouseOver="glowPopupRow(this,'<$menu_style_prefix$>PopupLink_over','<$menu_style_prefix$>PopupLink')"	onMouseOut="fadePopupRow(this,'<$menu_style_prefix$>PopupLink')">
				<a 	title="Archive Documents Administration"
					style="text-decoration: none; font-weight: normal; font-size: 8pt" href="<$archiveDocsLink$>">
					Archive Documents Admin
				</a>
			</td>
		</tr>
		</tr>
		<tr>
			<td class="<$menu_style_prefix$>PopupLink" nowrap onMouseOver="glowPopupRow(this,'<$menu_style_prefix$>PopupLink_over','<$menu_style_prefix$>PopupLink')"	onMouseOut="fadePopupRow(this,'<$menu_style_prefix$>PopupLink')">
				<a 	title="Create Instruction Administration"
					style="text-decoration: none; font-weight: normal; font-size: 8pt" href="<$createInstructionLink$>">
					Create Instruction Admin
				</a>
			</td>
		</tr>
		<tr>
			<td class="<$menu_style_prefix$>PopupLink" nowrap onMouseOver="glowPopupRow(this,'<$menu_style_prefix$>PopupLink_over','<$menu_style_prefix$>PopupLink')"	onMouseOut="fadePopupRow(this,'<$menu_style_prefix$>PopupLink')">
				<a 	title="Campaign Enrolment Admin"
					style="text-decoration: none; font-weight: normal; font-size: 8pt" href="?IdcService=CCLA_CS_CAMPAIGN_ENROLMENT_ADMIN<$include add_idc_token_to_url$>">
					Campaign Enrolment Admin
				</a>
			</td>
		</tr>
		
		<tr>
			<td>
				<hr style="margin: 2px 0px; padding: 0px; height: 1px;"/>
			</td>
		</tr>
		
	<$endif$>
	
	<$if UserIsAdmin or userHasRole("WF_Scanning Manager") or userHasRole("WF_COO")$>
		<tr>
			<td class="<$menu_style_prefix$>PopupLink" nowrap onMouseOver="glowPopupRow(this,'<$menu_style_prefix$>PopupLink_over','<$menu_style_prefix$>PopupLink')"	onMouseOut="fadePopupRow(this,'<$menu_style_prefix$>PopupLink')">
				<a 	title="CDB User Administrator"
					style="text-decoration: none; font-weight: normal; font-size: 8pt" href="<$cdbUserAdminLink$>">
					Central Database User Administrator
				</a>
			</td>
		</tr>
		<tr>
			<td class="<$menu_style_prefix$>PopupLink" nowrap onMouseOver="glowPopupRow(this,'<$menu_style_prefix$>PopupLink_over','<$menu_style_prefix$>PopupLink')"	onMouseOut="fadePopupRow(this,'<$menu_style_prefix$>PopupLink')">
				<a 	title="Work Group Administrator"
					style="text-decoration: none; font-weight: normal; font-size: 8pt" href="<$workGroupsAdminLink$>">
					Work Groups Administration
				</a>
			</td>
		</tr>
	<$endif$>
	
	<$if UserIsAdmin$>
		<tr>
			<td class="<$menu_style_prefix$>PopupLink" nowrap onMouseOver="glowPopupRow(this,'<$menu_style_prefix$>PopupLink_over','<$menu_style_prefix$>PopupLink')"	onMouseOut="fadePopupRow(this,'<$menu_style_prefix$>PopupLink')">
				<a 	title="Bulk Update Account Flags"
					style="text-decoration: none; font-weight: normal; font-size: 8pt" href="<$bulkUpdateAccountFlagsLink$>">
					Bulk Update Account Flags
				</a>
			</td>
		</tr>
	
		<tr>
			<td class="<$menu_style_prefix$>PopupLink" nowrap onMouseOver="glowPopupRow(this,'<$menu_style_prefix$>PopupLink_over','<$menu_style_prefix$>PopupLink')"	onMouseOut="fadePopupRow(this,'<$menu_style_prefix$>PopupLink')">
				<a 	title="Data Cache Administration"
					style="text-decoration: none; font-weight: normal; font-size: 8pt" href="<$cacheAdminLink$>">
					Data Cache Administration
				</a>
			</td>
		</tr>
		<tr>
			<td class="<$menu_style_prefix$>PopupLink" nowrap onMouseOver="glowPopupRow(this,'<$menu_style_prefix$>PopupLink_over','<$menu_style_prefix$>PopupLink')"	onMouseOut="fadePopupRow(this,'<$menu_style_prefix$>PopupLink')">
				<a 	title="Element Lock Administration"
					style="text-decoration: none; font-weight: normal; font-size: 8pt" href="<$elementLockAdminLink$>">
					Element Lock Administration
				</a>
			</td>
		</tr>
	
		<tr>
			<td class="<$menu_style_prefix$>PopupLink" nowrap onMouseOver="glowPopupRow(this,'<$menu_style_prefix$>PopupLink_over','<$menu_style_prefix$>PopupLink')"	onMouseOut="fadePopupRow(this,'<$menu_style_prefix$>PopupLink')">
				<a 	title="Instruction Audit"
					style="text-decoration: none; font-weight: normal; font-size: 8pt" href="<$instructionAuditAdminLink$>">
					Instruction Audit
				</a>
			</td>
		</tr>
	<$endif$>
	
	<tr>
		<td class="<$menu_style_prefix$>PopupLink" nowrap onMouseOver="glowPopupRow(this,'<$menu_style_prefix$>PopupLink_over','<$menu_style_prefix$>PopupLink')"	onMouseOut="fadePopupRow(this,'<$menu_style_prefix$>PopupLink')">
			<a 	title="Dual Indexing Config"
				style="text-decoration: none; font-weight: normal; font-size: 8pt" href="?IdcService=IRIS_DUAL_INDEX_CONFIGURATION<$include add_idc_token_to_url$>">
				Dual Indexing Configuration
			</a>
		</td>
	</tr>	
	
	<tr>
		<td class="<$menu_style_prefix$>PopupLink" nowrap onMouseOver="glowPopupRow(this,'<$menu_style_prefix$>PopupLink_over','<$menu_style_prefix$>PopupLink')"	onMouseOut="fadePopupRow(this,'<$menu_style_prefix$>PopupLink')">
			<a 	title="Process Dates"
				style="text-decoration: none; font-weight: normal; font-size: 8pt" href="<$processDatesLink$>">
				Process Date Configuration
			</a>
		</td>
	</tr>
	<tr>
		<td class="<$menu_style_prefix$>PopupLink" nowrap onMouseOver="glowPopupRow(this,'<$menu_style_prefix$>PopupLink_over','<$menu_style_prefix$>PopupLink')"	onMouseOut="fadePopupRow(this,'<$menu_style_prefix$>PopupLink')">
			<a 	title="Process Dates Calculator"
				style="text-decoration: none; font-weight: normal; font-size: 8pt" href="<$processDatesCalculatorLink$>">
				Process Date Calculator
			</a>
		</td>
	</tr>
	
	<$if userHasRole("WF_COO") or userHasRole("admin")$>
		<tr>
			<td class="<$menu_style_prefix$>PopupLink" nowrap onMouseOver="glowPopupRow(this,'<$menu_style_prefix$>PopupLink_over','<$menu_style_prefix$>PopupLink')"	onMouseOut="fadePopupRow(this,'<$menu_style_prefix$>PopupLink')">
				<a 	title="Job Priority Rules"
					style="text-decoration: none; font-weight: normal; font-size: 8pt" href="<$jobPriorityAdminLink$>">
					Job Priority Configuration
				</a>
			</td>
		</tr>
	<$endif$>
<!-- 
// Instruction Priority Rules, Currently not used but will supersed the Job Priority once 
// instructions are created right away. 
	<tr>
		<td class="<$menu_style_prefix$>PopupLink" nowrap onMouseOver="glowPopupRow(this,'<$menu_style_prefix$>PopupLink_over','<$menu_style_prefix$>PopupLink')"	onMouseOut="fadePopupRow(this,'<$menu_style_prefix$>PopupLink')">
			<a 	title="Instruction Priority Rules"
				style="text-decoration: none; font-weight: normal; font-size: 8pt" href="<$InstructionPriorityRuleAdminLink$>">
				Instruction Priority Rules Configuration
			</a>
		</td>
	</tr>	
-->
	<tr>
		<td class="<$menu_style_prefix$>PopupLink" nowrap onMouseOver="glowPopupRow(this,'<$menu_style_prefix$>PopupLink_over','<$menu_style_prefix$>PopupLink')"	onMouseOut="fadePopupRow(this,'<$menu_style_prefix$>PopupLink')">
			<a 	title="Parking Lot Bundles"
				style="text-decoration: none; font-weight: normal; font-size: 8pt" href="?IdcService=CCLA_PARKING_LOT_BUNDLES<$include add_idc_token_to_url$>">
				Parking Lot Bundles
			</a>
		</td>
	</tr>	

	<tr>
		<td class="<$menu_style_prefix$>PopupLink" nowrap onMouseOver="glowPopupRow(this,'<$menu_style_prefix$>PopupLink_over','<$menu_style_prefix$>PopupLink')"	onMouseOut="fadePopupRow(this,'<$menu_style_prefix$>PopupLink')">
			<a 	title="Public Holiday Dates Configuration"
				style="text-decoration: none; font-weight: normal; font-size: 8pt" href="<$publicHolidayAdminLink$>">
				Public Holiday Dates Configuration
			</a>
		</td>
	</tr>

	<tr>
		<td class="<$menu_style_prefix$>PopupLink" nowrap onMouseOver="glowPopupRow(this,'<$menu_style_prefix$>PopupLink_over','<$menu_style_prefix$>PopupLink')"	onMouseOut="fadePopupRow(this,'<$menu_style_prefix$>PopupLink')">
			<a 	title="Instruction Rule Admin"
				style="text-decoration: none; font-weight: normal; font-size: 8pt" href="<$InstructionRuleAdminLink$>">
				Instruction Rule Admin
			</a>
		</td>
	</tr>
	
	
	
	<tr>
		<td class="<$menu_style_prefix$>PopupLink" nowrap onMouseOver="glowPopupRow(this,'<$menu_style_prefix$>PopupLink_over','<$menu_style_prefix$>PopupLink')"	onMouseOut="fadePopupRow(this,'<$menu_style_prefix$>PopupLink')">
			<a 	title="System Config Var Configurations"
				style="text-decoration: none; font-weight: normal; font-size: 8pt" href="<$systemConfigVarAdminLink$>">
				System Config Var Configuration
			</a>
		</td>
	</tr>		
	<tr>
		<td class="<$menu_style_prefix$>PopupLink" nowrap onMouseOver="glowPopupRow(this,'<$menu_style_prefix$>PopupLink_over','<$menu_style_prefix$>PopupLink')"	onMouseOut="fadePopupRow(this,'<$menu_style_prefix$>PopupLink')">
			<a 	title="Help Button Administrator"
				style="text-decoration: none; font-weight: normal; font-size: 8pt" href="<$helpButtonAdminLink$>">
				Help Button Administrator
			</a>
		</td>
	</tr>
		
	
<@end@>

<!-- Search menu options: displays links for client/person searches -->
<@dynamichtml ccla_cs_search_menu_popup@>
<$if IsDebug$>ccla_cs_search_menu_popup<$endif$>

		<tr>
			<td class="<$menu_style_prefix$>PopupLink" nowrap onMouseOver="glowPopupRow(this,'<$menu_style_prefix$>PopupLink_over','<$menu_style_prefix$>PopupLink')"	onMouseOut="fadePopupRow(this,'<$menu_style_prefix$>PopupLink')">
				<a 	title="Search All"
					style="text-decoration: none; font-weight: normal; font-size: 8pt" href="<$HttpCgiPath$>?IdcService=CCLA_CS_CONTACT_LOOKUP<$include add_idc_token_to_url$>&searchScope=all">
					Search All
				</a>
			</td>
		</tr>
		
		<tr>
			<td><hr style="margin: 2px 0px; height: 1px; padding: 0px;"/></td>
		</tr>

	
	<$if #env.CCLA_CS_EnableDatabaseViews$>
	
		<tr>
			<td class="<$menu_style_prefix$>PopupLink" nowrap onMouseOver="glowPopupRow(this,'<$menu_style_prefix$>PopupLink_over','<$menu_style_prefix$>PopupLink')"	onMouseOut="fadePopupRow(this,'<$menu_style_prefix$>PopupLink')">
				<a 	title="Search clients"
					style="text-decoration: none; font-weight: normal; font-size: 8pt" href="<$HttpCgiPath$>?IdcService=CCLA_CS_CONTACT_LOOKUP<$include add_idc_token_to_url$>&searchScope=entity">
					Entities
				</a>
			</td>
		</tr>
		
		<tr>
			<td class="<$menu_style_prefix$>PopupLink" nowrap onMouseOver="glowPopupRow(this,'<$menu_style_prefix$>PopupLink_over','<$menu_style_prefix$>PopupLink')"	onMouseOut="fadePopupRow(this,'<$menu_style_prefix$>PopupLink')">
				<a 	title="Search People"
					style="text-decoration: none; font-weight: normal; font-size: 8pt" href="<$HttpCgiPath$>?IdcService=CCLA_CS_CONTACT_LOOKUP<$include add_idc_token_to_url$>&searchScope=person">
					People
				</a>
			</td>
		</tr>
		
		<tr>
			<td class="<$menu_style_prefix$>PopupLink" nowrap onMouseOver="glowPopupRow(this,'<$menu_style_prefix$>PopupLink_over','<$menu_style_prefix$>PopupLink')"	onMouseOut="fadePopupRow(this,'<$menu_style_prefix$>PopupLink')">
				<a 	title="Search Accounts"
					style="text-decoration: none; font-weight: normal; font-size: 8pt" href="<$HttpCgiPath$>?IdcService=CCLA_CS_CONTACT_LOOKUP<$include add_idc_token_to_url$>&searchScope=account">
					Accounts
				</a>
			</td>
		</tr>

		<!--
		<tr>
			<td class="<$menu_style_prefix$>PopupLink" nowrap onMouseOver="glowPopupRow(this,'<$menu_style_prefix$>PopupLink_over','<$menu_style_prefix$>PopupLink')"	onMouseOut="fadePopupRow(this,'<$menu_style_prefix$>PopupLink')">
				<a 	title="Search correspondents, signatories, trustees"
					style="text-decoration: none; font-weight: normal; font-size: 8pt" href="<$HttpCgiPath$>?IdcService=CCLA_CS_CONTACT_LOOKUP<$include add_idc_token_to_url$>&searchScope=other">
					Events
				</a>
			</td>
		</tr>	
		-->
		<tr>
			<td class="<$menu_style_prefix$>PopupLink" nowrap onMouseOver="glowPopupRow(this,'<$menu_style_prefix$>PopupLink_over','<$menu_style_prefix$>PopupLink')"	onMouseOut="fadePopupRow(this,'<$menu_style_prefix$>PopupLink')">
				<a 	title="Search Clients/Entities/People/Accounts"
					style="text-decoration: none; font-weight: normal; font-size: 8pt" href="<$HttpCgiPath$>?IdcService=CCLA_CS_CONTACT_LOOKUP<$include add_idc_token_to_url$>&searchScope=all">
					Entities/People/Accounts
				</a>
			</td>
		</tr>	
		<tr>
			<td><hr style="margin: 2px 0px; height: 1px; padding: 0px;"/></td>
		</tr>
	
	
	<$endif$>
		<tr>
			<td class="<$menu_style_prefix$>PopupLink" nowrap onMouseOver="glowPopupRow(this,'<$menu_style_prefix$>PopupLink_over','<$menu_style_prefix$>PopupLink')"	onMouseOut="fadePopupRow(this,'<$menu_style_prefix$>PopupLink')">
				<a 	title="Search Interaction Listings"
					style="text-decoration: none; font-weight: normal; font-size: 8pt" href="<$interactionListingLink$>">
					Interaction Listing
				</a>
			</td>
		</tr>
		<tr>
			<td><hr style="margin: 2px 0px; height: 1px; padding: 0px;"/></td>
		</tr>	
	<tr>
		<td class="<$menu_style_prefix$>PopupLink" nowrap onMouseOver="glowPopupRow(this,'<$menu_style_prefix$>PopupLink_over','<$menu_style_prefix$>PopupLink')"	onMouseOut="fadePopupRow(this,'<$menu_style_prefix$>PopupLink')">
			<a 	title="Search Scanned Envelopes"
				style="text-decoration: none; font-weight: normal; font-size: 8pt" href="<$scannedEnvelopesLink$>">
				Scanned Envelopes
			</a>
		</td>
	</tr>
	<tr>
		<td class="<$menu_style_prefix$>PopupLink" nowrap onMouseOver="glowPopupRow(this,'<$menu_style_prefix$>PopupLink_over','<$menu_style_prefix$>PopupLink')"	onMouseOut="fadePopupRow(this,'<$menu_style_prefix$>PopupLink')">
			<a 	title="Search Filing Cabinet"
				style="text-decoration: none; font-weight: normal; font-size: 8pt" href="<$filingCabinetLink$>">
				Filing Cabinet
			</a>
		</td>
	</tr>
	
	<$if userHasRole("admin") or userHasRole("WF_Scanning Manager") or userHasRole("WF_COO")$>
		<tr>
			<td class="<$menu_style_prefix$>PopupLink" nowrap onMouseOver="glowPopupRow(this,'<$menu_style_prefix$>PopupLink_over','<$menu_style_prefix$>PopupLink')"	onMouseOut="fadePopupRow(this,'<$menu_style_prefix$>PopupLink')">
				<a 	title="Instruction Listing"
					style="text-decoration: none; font-weight: normal; font-size: 8pt" href="<$instructionListingAdminLink$>">
					Instruction Listing
				</a>
			</td>
		</tr>
		
		<tr>
			<td class="<$menu_style_prefix$>PopupLink" nowrap onMouseOver="glowPopupRow(this,'<$menu_style_prefix$>PopupLink_over','<$menu_style_prefix$>PopupLink')"	onMouseOut="fadePopupRow(this,'<$menu_style_prefix$>PopupLink')">
				<a 	title="Instruction Listing"
					style="text-decoration: none; font-weight: normal; font-size: 8pt" href="<$instructionListingAdminLink$>&isSuspended=1">
					Instruction Listing (Suspended Items)
				</a>
			</td>
		</tr>
	<$endif$>
	
	<tr>
		<td class="<$menu_style_prefix$>PopupLink" nowrap onMouseOver="glowPopupRow(this,'<$menu_style_prefix$>PopupLink_over','<$menu_style_prefix$>PopupLink')"	onMouseOut="fadePopupRow(this,'<$menu_style_prefix$>PopupLink')">
			<a 	title="View Locked Items"
				style="text-decoration: none; font-weight: normal; font-size: 8pt" href="<$lockedItemsLink$>">
				Locked Items
			</a>
		</td>
	</tr>
	
<@end@>

<@dynamichtml ccla_cs_campaign_menu_popup@>

	<tr>
		<td class="<$menu_style_prefix$>PopupLink" nowrap onMouseOver="glowPopupRow(this,'<$menu_style_prefix$>PopupLink_over','<$menu_style_prefix$>PopupLink')"	onMouseOut="fadePopupRow(this,'<$menu_style_prefix$>PopupLink')">
			<a 	title="Add clients and people to campaigns"
				style="text-decoration: none; font-weight: normal; font-size: 8pt" href="<$HttpCgiPath$>?IdcService=CCLA_CS_CAMPAIGN_TARGET_SELECTION<$include add_idc_token_to_url$>">
				Target Selection
			</a>
		</td>
	</tr>
	
	<tr>
		<td class="<$menu_style_prefix$>PopupLink" nowrap onMouseOver="glowPopupRow(this,'<$menu_style_prefix$>PopupLink_over','<$menu_style_prefix$>PopupLink')"	onMouseOut="fadePopupRow(this,'<$menu_style_prefix$>PopupLink')">
			<a 	title="Review active campaign processes"
				style="text-decoration: none; font-weight: normal; font-size: 8pt" href="<$HttpCgiPath$>?IdcService=CCLA_CS_PROCESS_LISTING<$include add_idc_token_to_url$>">
				Process Listing
			</a>
		</td>
	</tr>
	
	<tr>
		<td class="<$menu_style_prefix$>PopupLink" nowrap onMouseOver="glowPopupRow(this,'<$menu_style_prefix$>PopupLink_over','<$menu_style_prefix$>PopupLink')"	onMouseOut="fadePopupRow(this,'<$menu_style_prefix$>PopupLink')">
			<a 	title="Review active campaign enrolments"
				style="text-decoration: none; font-weight: normal; font-size: 8pt" href="<$HttpCgiPath$>?IdcService=CCLA_CS_ENROLMENT_LISTING<$include add_idc_token_to_url$>">
				Enrolment Listing
			</a>
		</td>
	</tr>
	
	<tr>
		<td class="<$menu_style_prefix$>PopupLink" nowrap onMouseOver="glowPopupRow(this,'<$menu_style_prefix$>PopupLink_over','<$menu_style_prefix$>PopupLink')"	onMouseOut="fadePopupRow(this,'<$menu_style_prefix$>PopupLink')">
			<a 	title="Review process activities"
				style="text-decoration: none; font-weight: normal; font-size: 8pt" href="<$HttpCgiPath$>?IdcService=CCLA_CS_ACTIVITY_LISTING<$include add_idc_token_to_url$>">
				Activity Listing
			</a>
		</td>
	</tr>

<@end@>

<@dynamichtml ccla_cs_reports_menu_popup@>
	<$if IsDebug$>ccla_cs_reports_menu_popup<$endif$>
	
		<tr>
			<td class="<$menu_style_prefix$>PopupLink" nowrap onMouseOver="glowPopupRow(this,'<$menu_style_prefix$>PopupLink_over','<$menu_style_prefix$>PopupLink')"	onMouseOut="fadePopupRow(this,'<$menu_style_prefix$>PopupLink')">
				<a 	title="PSDF Summary"
					style="text-decoration: none; font-weight: normal; font-size: 8pt" href="<$HttpCgiPath$>?IdcService=CCLA_CS_PSDF_SUMMARY_REPORT<$include add_idc_token_to_url$>&CAMPAIGN_ID=10">
					PSDF Summary
				</a>
			</td>
		</tr>
	

	
	<$if userHasRole("admin") or userHasRole("WF_COO") or userHasRole("WF_Scanning Manager") or userHasRole("WF_Fund Manager")$>
	
		<tr>
			<td class="<$menu_style_prefix$>PopupLink" nowrap onMouseOver="glowPopupRow(this,'<$menu_style_prefix$>PopupLink_over','<$menu_style_prefix$>PopupLink')"	onMouseOut="fadePopupRow(this,'<$menu_style_prefix$>PopupLink')">
				<a 	title="AML Summary"
					style="text-decoration: none; font-weight: normal; font-size: 8pt" href="<$HttpCgiPath$>?IdcService=CCLA_CS_AML_SUMMARY_REPORT<$include add_idc_token_to_url$>">
					AML Summary
				</a>
			</td>
		</tr>

		<$if false$>
			<tr>
				<td class="<$menu_style_prefix$>PopupLink" nowrap onMouseOver="glowPopupRow(this,'<$menu_style_prefix$>PopupLink_over','<$menu_style_prefix$>PopupLink')"	onMouseOut="fadePopupRow(this,'<$menu_style_prefix$>PopupLink')">
					<a style="text-decoration: none; font-weight: normal; font-size: 8pt" href="<$HttpCgiPath$>?IdcService=CCLA_CS_FUND_XFER_REPORT<$include add_idc_token_to_url$>">
						Fund Transfers
					</a>
				</td>
			</tr>
		<$endif$>
		
	<$endif$>
	
	<tr>
		<td><hr style="margin: 2px 0px; height: 1px; padding: 0px;"/></td>
	</tr>

	<tr>
		<td class="<$menu_style_prefix$>PopupLink" nowrap onMouseOver="glowPopupRow(this,'<$menu_style_prefix$>PopupLink_over','<$menu_style_prefix$>PopupLink')"	onMouseOut="fadePopupRow(this,'<$menu_style_prefix$>PopupLink')">
			<a 	title="Bundle Counter"
				style="text-decoration: none; font-weight: normal; font-size: 8pt" href="#" onclick="window.open('?IdcService=CCLA_GET_ACTIVE_BUNDLE_COUNTS<$include add_idc_token_to_url$>', 'bundleCounter', 'height=330,width=450');">
				Bundle Counter
			</a>
		</td>
	</tr>

	<tr>
		<td class="<$menu_style_prefix$>PopupLink" nowrap onMouseOver="glowPopupRow(this,'<$menu_style_prefix$>PopupLink_over','<$menu_style_prefix$>PopupLink')"	onMouseOut="fadePopupRow(this,'<$menu_style_prefix$>PopupLink')">
			<a style="text-decoration: none; font-weight: normal; font-size: 8pt" href="<$HttpCgiPath$>?IdcService=CCLA_DOCUMENT_VOLUMES_REPORT">
				Document Volumes
			</a>
		</td>
	</tr>
	
	<tr>
		<td class="<$menu_style_prefix$>PopupLink" nowrap onMouseOver="glowPopupRow(this,'<$menu_style_prefix$>PopupLink_over','<$menu_style_prefix$>PopupLink')"	onMouseOut="fadePopupRow(this,'<$menu_style_prefix$>PopupLink')">
			<a style="text-decoration: none; font-weight: normal; font-size: 8pt" href="<$HttpCgiPath$>?IdcService=CCLA_CLIENT_DATA_EXPORT">
				Client Data Export
			</a>
		</td>
	</tr>

	<$if userHasRole("admin") or userHasRole("WF_COO") or userHasRole("WF_Scanning Manager") or userHasRole("WF_Fund Manager")$>
	
		<tr>
			<td class="<$menu_style_prefix$>PopupLink" nowrap onMouseOver="glowPopupRow(this,'<$menu_style_prefix$>PopupLink_over','<$menu_style_prefix$>PopupLink')"	onMouseOut="fadePopupRow(this,'<$menu_style_prefix$>PopupLink')">
				<a style="text-decoration: none; font-weight: normal; font-size: 8pt" href="<$HttpCgiPath$>?IdcService=GET_DOC_PAGE<$include add_idc_token_to_url$>&Action=GetTemplatePage&Page=CCLA_REPORTS">
					Content Reports
				</a>
			</td>
		</tr>
		
		<tr>
			<td class="<$menu_style_prefix$>PopupLink" nowrap onMouseOver="glowPopupRow(this,'<$menu_style_prefix$>PopupLink_over','<$menu_style_prefix$>PopupLink')"	onMouseOut="fadePopupRow(this,'<$menu_style_prefix$>PopupLink')">
				<a style="text-decoration: none; font-weight: normal; font-size: 8pt" href="<$HttpCgiPath$>?IdcService=GET_DOC_PAGE<$include add_idc_token_to_url$>&Action=GetTemplatePage&Page=CCLA_EXTENDED_VIEW_REPORT">
					Ext. Content Report
				</a>
			</td>
		</tr>
		
		<tr>
			<td class="<$menu_style_prefix$>PopupLink" nowrap onMouseOver="glowPopupRow(this,'<$menu_style_prefix$>PopupLink_over','<$menu_style_prefix$>PopupLink')"	onMouseOut="fadePopupRow(this,'<$menu_style_prefix$>PopupLink')">
				<a style="text-decoration: none; font-weight: normal; font-size: 8pt" href="<$HttpCgiPath$>?IdcService=GET_DOC_PAGE<$include add_idc_token_to_url$>&Action=GetTemplatePage&Page=CCLA_EXTENDED_VIEW_REPORT&allDocumentClasses=1&allCompletedStatuses=1&allErrorStatuses=1">
					Ext. Content Report (Completed/Errors)
				</a>
			</td>
		</tr>
		
		
		<tr>
			<td class="<$menu_style_prefix$>PopupLink" nowrap onMouseOver="glowPopupRow(this,'<$menu_style_prefix$>PopupLink_over','<$menu_style_prefix$>PopupLink')"	onMouseOut="fadePopupRow(this,'<$menu_style_prefix$>PopupLink')">
				<a style="text-decoration: none; font-weight: normal; font-size: 8pt" href="<$HttpCgiPath$>?IdcService=GET_DOC_PAGE<$include add_idc_token_to_url$>&Action=GetTemplatePage&Page=CCLA_EXTENDED_VIEW_REPORT&searchMethod=emptyProcessDates&nullProcessDate=1">
					Empty Process Dates
				</a>
			</td>
		</tr>
		
		<tr>
			<td class="<$menu_style_prefix$>PopupLink" nowrap onMouseOver="glowPopupRow(this,'<$menu_style_prefix$>PopupLink_over','<$menu_style_prefix$>PopupLink')"	onMouseOut="fadePopupRow(this,'<$menu_style_prefix$>PopupLink')">
				<a style="text-decoration: none; font-weight: normal; font-size: 8pt" href="<$HttpCgiPath$>?IdcService=GET_DOC_PAGE<$include add_idc_token_to_url$>&Action=GetTemplatePage&Page=CCLA_EXTENDED_VIEW_REPORT&searchMethod=duplicatesOnly">
					Duplicate Report
				</a>
			</td>
		</tr>
		
		<tr>
			<td class="<$menu_style_prefix$>PopupLink" nowrap onMouseOver="glowPopupRow(this,'<$menu_style_prefix$>PopupLink_over','<$menu_style_prefix$>PopupLink')"	onMouseOut="fadePopupRow(this,'<$menu_style_prefix$>PopupLink')">
				<a style="text-decoration: none; font-weight: normal; font-size: 8pt" href="<$HttpCgiPath$>?IdcService=GET_DOC_PAGE<$include add_idc_token_to_url$>&Action=GetTemplatePage&Page=CCLA_EXTENDED_VIEW_REPORT&searchMethod=singleDocumentClass">
					Document Class Report
				</a>
			</td>
		</tr>
		
		<tr>
			<td class="<$menu_style_prefix$>PopupLink" nowrap onMouseOver="glowPopupRow(this,'<$menu_style_prefix$>PopupLink_over','<$menu_style_prefix$>PopupLink')"	onMouseOut="fadePopupRow(this,'<$menu_style_prefix$>PopupLink')">
				<a style="text-decoration: none; font-weight: normal; font-size: 8pt" href="<$HttpCgiPath$>?IdcService=CCLA_IRIS_REPORTS<$include add_idc_token_to_url$>">
					Iris Reports
				</a>
			</td>
		</tr>
		
		<tr>
			<td class="<$menu_style_prefix$>PopupLink" nowrap onMouseOver="glowPopupRow(this,'<$menu_style_prefix$>PopupLink_over','<$menu_style_prefix$>PopupLink')"	onMouseOut="fadePopupRow(this,'<$menu_style_prefix$>PopupLink')">
				<a style="text-decoration: none; font-weight: normal; font-size: 8pt" href="<$HttpCgiPath$>?IdcService=CCLA_FLAGGED_ITEMS_REPORT<$include add_idc_token_to_url$>">
					Flagged Items Report
				</a>
			</td>
		</tr>
		
		<tr>
			<td class="<$menu_style_prefix$>PopupLink" nowrap onMouseOver="glowPopupRow(this,'<$menu_style_prefix$>PopupLink_over','<$menu_style_prefix$>PopupLink')"	onMouseOut="fadePopupRow(this,'<$menu_style_prefix$>PopupLink')">
				<a style="text-decoration: none; font-weight: normal; font-size: 8pt" href="<$getSystemConfigVar('CommunityFirst_RPISurplusDrawdownReport_ADFPageURL')$>">
					RPI Drawdown Report
				</a>
			</td>
		</tr>
		
		<$if userHasRole("admin") or userHasRole("CCLA-Compliance") or userHasRole("CCLA-Static Data")$>
			<$terrorSearchUrl = getSystemConfigVar('TerrorSearch_ReportHome_ADFPageURL')$>
			<$if terrorSearchUrl$>
				<tr>
					<td class="<$menu_style_prefix$>PopupLink" nowrap onMouseOver="glowPopupRow(this,'<$menu_style_prefix$>PopupLink_over','<$menu_style_prefix$>PopupLink')"	onMouseOut="fadePopupRow(this,'<$menu_style_prefix$>PopupLink')">
						<a style="text-decoration: none; font-weight: normal; font-size: 8pt" href="<$terrorSearchUrl$>">
							Terror Search Report
						</a>
					</td>
				</tr>
			<$endif$>
		<$endif$>
		
		<tr>
			<td>
				<hr style="margin: 2px 0px; padding: 0px; height: 1px;"/>
			</td>
		</tr>
		
		<tr>
			<td class="<$menu_style_prefix$>PopupLink" nowrap onMouseOver="glowPopupRow(this,'<$menu_style_prefix$>PopupLink_over','<$menu_style_prefix$>PopupLink')"	onMouseOut="fadePopupRow(this,'<$menu_style_prefix$>PopupLink')">
				<a style="text-decoration: none; font-weight: normal; font-size: 8pt" href="<$HttpCgiPath$>?IdcService=CCLA_ODC_REPORTS<$include add_idc_token_to_url$>">
					ODC Filing Cabinet Report
				</a>
			</td>
		</tr>
		
		<tr>
			<td class="<$menu_style_prefix$>PopupLink" nowrap onMouseOver="glowPopupRow(this,'<$menu_style_prefix$>PopupLink_over','<$menu_style_prefix$>PopupLink')"	onMouseOut="fadePopupRow(this,'<$menu_style_prefix$>PopupLink')">
				<a style="text-decoration: none; font-weight: normal; font-size: 8pt" href="<$HttpCgiPath$>?IdcService=CCLA_ODC_REC_REPORT<$include add_idc_token_to_url$>">
					ODC Reconciliation Report
				</a>
			</td>
		</tr>
	
		<tr>
			<td>
				<hr style="margin: 2px 0px; padding: 0px; height: 1px;"/>
			</td>
		</tr>
		
		<tr>
			<td class="<$menu_style_prefix$>PopupLink" nowrap onMouseOver="glowPopupRow(this,'<$menu_style_prefix$>PopupLink_over','<$menu_style_prefix$>PopupLink')"	onMouseOut="fadePopupRow(this,'<$menu_style_prefix$>PopupLink')">
				<a 	title="View previous PSDF end of day reports"
					style="text-decoration: none; font-weight: normal; font-size: 8pt" href="?IdcService=CCLA_TRANS_EOD_COMPLETED_LISTING<$include add_idc_token_to_url$>">
					PSDF End of Day Reports
				</a>
			</td>
		</tr>

		<tr>
			<td class="<$menu_style_prefix$>PopupLink" nowrap onMouseOver="glowPopupRow(this,'<$menu_style_prefix$>PopupLink_over','<$menu_style_prefix$>PopupLink')"	onMouseOut="fadePopupRow(this,'<$menu_style_prefix$>PopupLink')">
				<a 	title="View share class movement for today"
					style="text-decoration: none; font-weight: normal; font-size: 8pt" href="?IdcService=CCLA_TRANS_EOD_SHARE_CLASS_MOVEMENT_REPORT<$include add_idc_token_to_url$>">
					PSDF Daily Share Class Movement
				</a>
			</td>
		</tr>

	<tr>
		<td class="<$menu_style_prefix$>PopupLink" nowrap onMouseOver="glowPopupRow(this,'<$menu_style_prefix$>PopupLink_over','<$menu_style_prefix$>PopupLink')"	onMouseOut="fadePopupRow(this,'<$menu_style_prefix$>PopupLink')">
			<a 	title="View Share Class Discrepancy"
				style="text-decoration: none; font-weight: normal; font-size: 8pt" href="<$shareClassDiscrepancyLink$>">
				PSDF Share Class Discrepancy Report
			</a>
		</td>
	</tr>	
		
		<tr>
			<td><hr style="margin: 2px 0px; height: 1px; padding: 0px;"/></td>
		</tr>

			
		<tr>
			<td class="<$menu_style_prefix$>PopupLink" nowrap onMouseOver="glowPopupRow(this,'<$menu_style_prefix$>PopupLink_over','<$menu_style_prefix$>PopupLink')"	onMouseOut="fadePopupRow(this,'<$menu_style_prefix$>PopupLink')">
				<a style="text-decoration: none; font-weight: normal; font-size: 8pt" href="<$HttpCgiPath$>?IdcService=WORK_IN_PROGRESS<$include add_idc_token_to_url$>">
					UCM Work In Progress
				</a>
			</td>
		</tr>
		
	<$endif$>
	
<@end@>

<!-- Displays client info, including their registered address.
	 Must be referenced inside a client data ResultSet loop. 
	 
	 Soon to be defunct after new schema deployment.
	 -->
<@dynamichtml ccla_cs_display_client_info@>

	<table class="cs-info-table" width="100%">
		<tr>
			<th width="20%">Name:</th><td width="30%"><$#active.CLIENT_NAME$></td>
			<th width="20%">Company:</th><td><$#active.COMPANY$></td>
		</tr>
		
		<tr>
			<th>Client ID:</th>
			<td>
				<a  <$if strIndexOf(IdcService, "CLIENT_INFO") == -1$>target="_blank"<$endif$>
					href="?IdcService=CCLA_CS_CLIENT_INFO<$include add_idc_token_to_url$>&clientId=<$#active.CLIENT_ID$>&company=<$#active.COMPANY$>"><$strLeftFill(#active.CLIENT_ID,"0",5)$></a>
			</td>
			<th>Correspondent ID:</th>
			<td><a href="?IdcService=CCLA_CS_PERSON_INFO<$include add_idc_token_to_url$>&PERSON_ID=<$#active.PERSON_ID$>"><$strLeftFill(#active.CORRESPONDENT_ID,"0",6)$></a></td>
		</tr>
		
		<tr>
			<th>Date account opened:</th><td><$formatDateOnly(#active.DATE_ACCOUNT_OPENED)$></td>
		</tr>
	</table>
	
	<br/>
	
	<h3 class="ccla_data_panel_header">Contact info</h3>
	
	<$include ccla_cs_display_contact_details$>

<@end@>


<!-- Displays person info, including their registered address.
	 Must be referenced inside a person data ResultSet loop. -->
<@dynamichtml ccla_cs_display_person_info@>
<$if IsDebug$>ccla_cs_display_person_info<$endif$>
	<table class="cs-info-table" width="100%">
		<tr>
			<th width="20%">Full name:</th><td width="30%"><$include ccla_cs_person_name_display$></td>
			<th width="20%">Salutation:</th><td><$#active.SALUTATION$></td>
		</tr>
		
		<tr>
			<th>Auth status:</th>
			<td>
				<$include ccla_cs_person_identity_check_result$>
			</td>
		</tr>
		
		<tr>
			<th>Person Code:</th>
			<td>
				<$if not #active.isCompact OR isUltraCompact$>
				<a <$if strIndexOf(IdcService, "PERSON_INFO") == -1$>target="_blank"<$endif$>
					href="?IdcService=CCLA_CS_PERSON_INFO<$include add_idc_token_to_url$>&PERSON_ID=<$#active.PERSON_ID$>">
				<$endif$>
					<$#active.PERSON_ACCOUNT_CODE$>
				<$if not #active.isCompact$>
				</a>
				<$endif$>
			</td>
			<th>DOB:</th><td><$formatDateOnly(#active.DATE_OF_BIRTH)$></td>
		</tr>
		<$if #active.IS_DECEASED like '1'$>
		<tr>
			<td colspan="2" class="red">
			<strong>DECEASED</strong>
			</td>
		</tr>
		<$endif$>
		<$if #active.DO_NOT_CONTACT_FLAG like '1'$>
		<tr>
			<td colspan="2" class="red">
			<strong>Data Protection</strong>
			</td>
		</tr>
		<$endif$>		
		<$if rsPersonAuroraMap$>
			<$loop rsPersonAuroraMap$>
				<tr>
					<th>Correspondent No:</th>
					<td><$rsPersonAuroraMap.CORR_ID$></td>
					<th>Company:</th>
					<td><$rsPersonAuroraMap.COMPANY_CODE$></td>
				</tr>
			<$endloop$>
		<$endif$>
	</table>
	
	<$if false$>
		<h3 class="ccla_data_panel_header">Contact info</h3>
		
		<$include ccla_cs_display_contact_details$>
	<$endif$>
						
<@end@>		

<@dynamichtml ccla_cs_display_client_campaigns@>
<$if IsDebug$>ccla_cs_display_client_campaigns<$endif$>	
	<$if not rsProcesses and not rsCampaignEnrolments$>
		<p class="no-info">
			This client has not been enrolled to any campaigns.
		</p>
	<$else$>
		
		<table class="accounts-table" cellspacing="0" cellpadding="0" width="100%">
			<tr>
				<th class="first-col" width="15%">Enrolment ID</th>
				<th>Campaign</th>
				<th>Client Status</th>
				<th>Enrolment Status</th>
				<th>Start date</th>
			</tr>
		
		<$loop rsCampaignEnrolments$>
			<tr class="account-details-row">
				<td class="first-col">
					<$if not #local.isCompact$>
						<a href="?IdcService=CCLA_CS_CAMPAIGN_ENROLMENT_INFO<$include add_idc_token_to_url$>&CAMPAIGN_ENROLMENT_ID=<$#active.CAMPAIGN_ENROLMENT_ID$>">
					<$endif$>
						<$#active.CAMPAIGN_ENROLMENT_ID$>
					<$if not #local.isCompact$>
						</a>
					<$endif$>
				</td>
				<td>

					<$#active.CAMPAIGN_NAME$>

				</td>
				<td><$#active.CAMPSUBJECTSTATUS_NAME$></td>
				<td><$#active.ENROLMENT_STATUS_NAME$></td>
				<td><$#active.DATE_ADDED$></td>
			</tr>
		<$endloop$>
		
		</table>
		
		<h3 class="ccla_data_panel_header">Legacy Campaigns</h3>
		
		<$if not rsProcesses$>
			<p class="no-info">
				None
			</p>
		
		<$else$>
			
			<table class="accounts-table" cellspacing="0" cellpadding="0" width="100%">
				<tr>
					<th class="first-col" width="15%">Process ID</th>
					<th>Campaign</th>
					<th>Status</th>
					<th>Start date</th>
				</tr>
		
				<$loop rsProcesses$>
					<tr class="account-details-row">
						<td class="first-col">
							<$if not #local.isCompact$>
							<a href="<$HttpCgiPath$>?IdcService=CCLA_CS_PROCESS_INFO<$include add_idc_token_to_url$>&PROCESS_ID=<$#active.PROCESS_ID$>">
							<$endif$>
								<$#active.PROCESS_ID$>
							<$if not #local.isCompact$>
							</a>
							<$endif$>
						</td>
						<td>
							<$if not #local.isCompact$>
							<a href="<$HttpCgiPath$>?IdcService=CCLA_CS_PROCESS_INFO<$include add_idc_token_to_url$>&PROCESS_ID=<$#active.PROCESS_ID$>">
							<$endif$>
								<$#active.NAME$>
							<$if not #local.isCompact$>
							</a>
							<$endif$>
						</td>
						<td><$#active.PROCESS_STATUS$></td>
						<td><$#active.PROCESS_DATE$></td>
					</tr>
				<$endloop$>
			
			</table>
			
		<$endif$>
		
	<$endif$>
	
<@end@>				

<@dynamichtml ccla_cs_display_start_account_table@>
	<$if IsDebug$>ccla_cs_display_start_account_table<$endif$>
	
	<table 	class="accounts-table" 
			<$if #local.accountTableId$>id="<$accountTableId$>" style="display:none"<$endif$>
			cellspacing="0" cellpadding="0" width="100%" >
		<tr>
			<th class="first-col" width="10%">Account no.</th>
			<th width="5%">Fund</th>
			<th>Subtitle</th>
			<th width="13%">Cash</th>
			<th width="13%">Units</th>
			<th width="5%">Status</th>
			<th width="10%">Date opened</th>
			<th width="13%">Inc. dist. method</th>
			
			<$if enableAccountActions$>
				<th width="3%">&nbsp;</th>
			<$endif$>
		</tr>

<@end@>

<!-- 	Determines CCS class to use for account table row, based on
		its current status. -->
<@dynamichtml ccla_cs_resolve_account_row_css_class@>
	
	<$rowClass = ""$>
		
	
	<$if #active.SHORT_NAME like "OPEN"$>
		<$rowClass = "account-row-open"$>
	<$elseif #active.SHORT_NAME like "CLOS"$>
		<$rowClass = "account-row-closed"$>
	<$elseif #active.SHORT_NAME like "FROZ"$>	
		<$rowClass = "account-row-frozen"$>
	<$elseif #active.SHORT_NAME like "PEND"$>
		<$rowClass = "account-row-pend"$>
	<$elseif strEquals(#active.ACCOUNT_STATUS_ID,"5")$>
		<$rowClass = "account-row-temp"$>
	<$endif$>
	
<@end@>

<!-- Displays any accounts listed in an rsAccounts ResultSet. If an rsAccountCorrespondents
	 ResultSet is also present, correspondent data is used as grouping headers for each
	 set of accounts. -->
<@dynamichtml ccla_cs_display_accounts@>
	<$if IsDebug$>ccla_cs_display_accounts<$endif$>
	
	<script type="text/javascript">
		
		$(document).ready( function() {
			
			$(".account-table-toggle").bind("click", function() {
				// Determine the target account table ID, using the ID of the 
				// clicked toggle button.
				var tableId = $(this).attr("id").substring("accountTableToggle_".length);
				
				$("#"+tableId).slideToggle('fast', function(){
					if($("#"+tableId).css("display") != "none"){
						$("#toggleIcon_"+tableId).removeClass("toggle-button-open").addClass("toggle-button-closed");
					} else {
						$("#toggleIcon_"+tableId).removeClass("toggle-button-closed").addClass("toggle-button-open");
					}
				});

			});
			
		});
		
	</script>
	
	<$lastOrgId=""$>
	<$lastAccountTypeId=""$>
	
	<$loop rsAccounts$>
	
		<$if not (#active.ORGANISATION_ID like lastOrgId)$>
			<$if lastOrgId$>
				</table>
			<$endif$>
				
			<$lastOrgId = #active.ORGANISATION_ID$>
			<$lastAccountTypeId = ""$>
				
			<!-- Show owning Organisation name/ID -->
			<table width="100%" cellspacing="2" cellpadding="0" class="cs-info-table" style="margin: 5px 0px">
				<tr>
					<th width="20%">
						Organisation name:
					</th>
					<td>
						<$#active.ORGANISATION_NAME$>
					</td>
				</tr>
				
				<tr>
					<th>
						Org Account Code:
					</th>
					<td>
						<a href="?IdcService=CCLA_CS_ENTITY_INFO<$include add_idc_token_to_url$>&ORGANISATION_ID=<$#active.ORGANISATION_ID$>"><$#active.ORG_ACCOUNT_CODE$></a>
					</td>
				</tr>
		
			</table>
			
		<$endif$>
		
		<$if not (#active.ACCOUNT_TYPE_ID like lastAccountTypeId)$>
			<!-- Show account type header with toggle button -->
		
			<$if lastAccountTypeId$>
				</table>
			<$endif$>
			
			<$lastAccountTypeId = #active.ACCOUNT_TYPE_ID$>
			
			<$accountTableId = "accountTable_" & #active.ORGANISATION_ID & "_" & #active.ACCOUNT_TYPE_ID$>

			<table 	width="100%" cellspacing="2" cellpadding="0" 
					class="cs-info-table" style="margin: 5px 0px; background-color: #BEDFA7;">
				<tr >
					<th valign="middle" class="account-table-toggle" id="accountTableToggle_<$accountTableId$>">
						<div class="toggle-button-open" id="toggleIcon_<$accountTableId$>"></div>
						<$#active.ACCOUNT_TYPE_NAME$> accounts
						
						<$numAccountsWithType = ""$>
						
						<$loop rsAccountTotals$>
							<$if #active.ORGANISATION_ID like lastOrgId and #active.ACCOUNT_TYPE_ID like lastAccountTypeId$>
								<$numAccountsWithType = #active.NUM_ACCOUNTS$>
							<$endif$>
						<$endloop$>
						
						<$if numAccountsWithType$>
							(<$numAccountsWithType$>)
						<$endif$>
						
					</th>
				</tr>
			</table>
			
			<$displayAccountTableHeader=1$>
			
		<$endif$>
	
		<$if displayAccountTableHeader$>
			<$include ccla_cs_display_start_account_table$>	
			<$displayAccountTableHeader=""$>
		<$endif$>
		
		<$include ccla_cs_resolve_account_row_css_class$>
		
		<tr class="account-details-row<$if rowClass$> <$rowClass$><$endif$>">
			<td class="first-col mono-type">
				<$if not #active.isCompact$>
					<a href="?IdcService=CCLA_CS_ACCOUNT_INFO<$include add_idc_token_to_url$>&ACCOUNT_ID=<$#active.ACCOUNT_ID$>">
				<$endif$>
				
				<$strLeftFill(#active.ACCOUNTNUMBER,"0",8)$>
				
				<$if not #active.isCompact$>
					</a>
				<$endif$>
			</td>
			<td><$#active.FUND_CODE$></td>
			<td><$#active.SUBTITLE$>&nbsp;</td>
			<td align="right" class="mono-type">&nbsp;<$#active.ACC_CASH$></td>
			<td align="right" class="mono-type">&nbsp;<$#active.ACC_UNITS$></td>
			<td><$#active.SHORT_NAME$></td>
			<td><$formatDateOnly(#active.DATE_OPENED)$>&nbsp;</td>
			<td><$#active.INCOME_DISTRIBUTION_METHOD$></td>
			
			<$if enableAccountActions$>
				<td align="center">
					<$menu_style_prefix	= "top"$>
					<$menu_id           = #active.ACCOUNT_ID$>
					<$actionMenu_CustomInclude="ccla_cs_account_actions_menu"$>

					<$include action_menu$>
				</td>
			<$endif$>
		</tr>
	
	<$endloop$>
	
	<$if rsAccounts$>
		</table>
	<$endif$>
	
<@end@>

<!-- this sets the tab link parameters on each page according to the buttonContext that should be set to 'entity', 'person' or 'account'-->
<@dynamichtml ccla_cs_include_tab_parameters@>
<$if IsDebug$>ccla_cs_include_tab_parameters<$endif$>
<$if strEqualsIgnoreCase(buttonContext,"entity")$>
	<$recordService_info = "CCLA_CS_ENTITY_INFO&ORGANISATION_ID=" & #active.ORGANISATION_ID$>
	<$recordService_edit = "CCLA_CS_ENTITY_EDIT&ORGANISATION_ID=" & #active.ORGANISATION_ID$>
	<$recordService_bulkupdate = "CCLA_CS_ENTITY_BULK_EDIT&ORGANISATION_ID=" & #active.ORGANISATION_ID$>
	<$recordService_edit_Label="Edit"$>
<$elseif strEqualsIgnoreCase(buttonContext,"person")$>
	<$recordService_info = "CCLA_CS_PERSON_INFO&PERSON_ID=" & #active.PERSON_ID$>
	<$recordService_edit = "CCLA_CS_PERSON_EDIT&PERSON_ID=" & #active.PERSON_ID$>
	<$recordService_edit_Label="Edit"$>
<$elseif strEqualsIgnoreCase(buttonContext,"account")$>
	<$recordService_info = "CCLA_CS_ACCOUNT_INFO&ACCOUNT_ID=" & #active.ACCOUNT_ID$>
	<$recordService_edit = "CCLA_CS_ACCOUNT_EDIT&ACCOUNT_ID=" & #active.ACCOUNT_ID$>
	<$recordService_edit_Label="Edit"$>
<$elseif strEqualsIgnoreCase(buttonContext,"bankaccount")$>
	<$recordService_info = "CCLA_CS_BANK_ACCOUNT_INFO&BANK_ACCOUNT_ID=" & #active.BANK_ACCOUNT_ID$>
	<$recordService_edit = "CCLA_CS_BANK_ACCOUNT_EDIT&BANK_ACCOUNT_ID=" & #active.BANK_ACCOUNT_ID$>
	<$recordService_edit_Label="Edit"$>	
<$endif$>

<@end@>

<!-- Displays a compact table of all accounts listed in an rsAccounts ResultSet. -->
<@dynamichtml ccla_cs_display_accounts_bulk_update@>
	<$if IsDebug$>ccla_cs_display_accounts_bulk_update<$endif$>

	<table class="accounts-table" cellspacing="0" cellpadding="0" width="100%">
		<tr>
			<th class="first-col" width="15%">
				<input 	type="checkbox" 
						name="toggleSelectAccountsCheckbox" 
						id="toggleSelectAccountsCheckbox" 
						onclick="toggleSelectAccounts();"
						<$if #local.toggleSelectAccountsCheckbox$>checked<$endif$>
						>
			</th>
			<th width="40%">Account no.</th>
			<th width="15%">&nbsp;</th>
			<th width="25%">Status</th>
		</tr>

		<$loop rsAccounts$>
			
			[[% Restrict all Loan accounts from display %]]
			<$if 	(#active.ACCOUNT_TYPE_ID == #env.CCLA_CS_AccountTypeId_Unitised)
					or
					(#active.ACCOUNT_TYPE_ID == #env.CCLA_CS_AccountTypeId_Deposit)$>
				<$if accountLinkShowDetail$>
					<$link = "style='cursor:pointer' href=\"javascript:viewAccountDetail('" & #active.ACCOUNT_ID & "', $(this).parent().parent())\""$>
				<$else$>
					<$link = "href='?IdcService=CCLA_CS_ACCOUNT_INFO&ACCOUNT_ID=" & #active.ACCOUNT_ID & "'"$>
				<$endif$>	
				
				<$rowClass = ""$>
				
				<$include ccla_cs_resolve_account_row_css_class$>
				
				<tr class="account-details-row<$if rowClass$> <$rowClass$><$endif$>">
					<td class="first-col" align="center">
						<input type="checkbox" name="chk_<$#active.ACCOUNT_ID$>" id="chk_<$#active.ACCOUNT_ID$>" class="account-checkbox" >
					</td>
					<td>
						<a <$link$> id="link_<$#active.ACCOUNT_ID$>" class="account-select-link" ><$strLeftFill(#active.ACCOUNTNUMBER,"0",8)$></a>
					</td>
					<td><$#active.FUND_CODE$></td>
					<td><$#active.SHORT_NAME$></td>
				</tr>
			
			<$endif$>
			
		<$endloop$>
	
	</table>
	
<@end@>

<!-- Displays any accounts listed in an rsAccounts ResultSet. If an rsAccountCorrespondents
	 ResultSet is also present, correspondent data is used as grouping headers for each
	 set of accounts. -->
<@dynamichtml ccla_cs_display_bank_accounts_bulk_update@>
<$if IsDebug$>ccla_cs_display_bank_accounts_bulk_update<$endif$>


	<$loop rsAccounts$>
		<$if accountLinkShowDetail$>
		<$link = "style='cursor:pointer' onclick=\"refreshAccountDetail('" & #active.ACCNUMEXT & "', $(this).parent().parent())\""$>
		<$else$>
		<$link = "href='?IdcService=CCLA_CS_ACCOUNT_INFO" & inc('add_idc_token_to_url') & "&ACCNUMEXT=" & #active.ACCNUMEXT & "'"$>
		<$endif$>	
	
			<$if rsAccounts.#row == 0$>
				<br/>
				<table class="accounts-table" cellspacing="0" cellpadding="0" width="100%">
					<tr>
						<th class="first-col" width="15%"><input type="checkbox" name="check_All" id="check_All" onclick="checkAll();"></th>
						<th width="60%">Ext. Account no.</th>
						<th width="25%">Status</th>
					</tr>
			<$endif$>
		
		<$rowClass = ""$>
		
		<$if #active.SHORT_NAME like "OPEN"$>
			<$rowClass = "account-row-open"$>
		<$elseif #active.SHORT_NAME like "CLOS"$>
			<$rowClass = "account-row-closed"$>
		<$elseif #active.SHORT_NAME like "FROZ"$>	
			<$rowClass = "account-row-frozen"$>
		<$endif$>
			<$if  #active.SHORT_NAME like "OPEN" $>	
		<tr class="account-details-row<$if rowClass$> <$rowClass$><$endif$>">
			<td class="first-col mono-type">
				<input type="checkbox" name="chk_<$#active.ACCOUNT_ID$>" id="chk_<$#active.ACCOUNT_ID$>">
			</td>
			<td>
				<a <$link$>><$#active.ACCNUMEXT$></a>
			</td>
			<td><$#active.SHORT_NAME$></td>
		</tr>
		<$endif$>
	<$endloop$>
	
	</table>
	
<@end@>

<!-- Customized view of ccla_cs_display_accounts include.

	 Adds an extra column with a 'completed' checkbox. This is used to mark off accounts
	 which have passed AML checks. -->
<@dynamichtml ccla_cs_display_aml_accounts@>

	<$if displayAccSummary$>
		<$include ccla_cs_display_account_summary$>
	<$endif$>
	
	<$loop rsAccounts$>
		
		<$if not rsAccountCorrespondents$>
			<$if rsAccounts.#row == 0$>
				<br/>
			
				<table class="accounts-table" cellspacing="0" cellpadding="0" width="100%">
					<tr>
						<th class="first-col" width="15%">Ext. Account no.</th>
						<th width="15%">Cash</th>
						<th width="15%">Units</th>
						<th width="10%">Status</th>
						<th width="15%">Date opened</th>
						<th width="15%">Income dist. method</th>
						<th width="15%">Completed</th>
					</tr>
			<$endif$>
			
		<$elseif not lastCorrCode or not (#local.lastCorrCode like #active.ACC_CORCODE)$>
			
			<$if lastCorrCode$>
				</table>
			<$endif$>
			
			<$loop rsAccountCorrespondents$>
				<$if #active.ACC_CORCODE like #active.PERSON_ID$>
					<$lastCorrCode = #active.ACC_CORCODE$>
					
					<br/>
					
					<table class="cs-info-table" width="100%">
						<tr>
							<th width="20%">Corr. name:</th><td width="30%"><$#active.FULL_NAME$></td>
							<th width="20%">Corr. ID:</th><td><a href="<$HttpCgiPath$>?IdcService=CCLA_CS_PERSON_INFO<$include add_idc_token_to_url$>&PERSON_ID=<$#active.PERSON_ID$>"><$#active.PERSON_ID$></a></td>
						</tr>
						
						<tr>
							<th>Tel:</th><td><$#active.PHONE$></td>
							<th>Mobile:</th><td><$#active.MOBILE$></td>
						</tr>
					</table>
					
				<$endif$>
			<$endloop$>
			
			<br/>
			
			<table class="accounts-table" cellspacing="0" cellpadding="0" width="100%">
				<tr>
					<th class="first-col" width="15%">Ext. Account no.</th>
					<th width="15%">Cash</th>
					<th width="15%">Units</th>
					<th width="10%">Status</th>
					<th width="15%">Date opened</th>
					<th width="15%">Income dist. method</th>
					<th width="15%">Completed</th>
				</tr>
		
		<$endif$>
		
		<$rowClass = ""$>
		
		<$if #active.SHORT_NAME like "OPEN"$>
			<$rowClass = "account-row-open"$>
		<$elseif #active.SHORT_NAME like "CLOS"$>
			<$rowClass = "account-row-closed"$>
		<$elseif #active.SHORT_NAME like "FROZ"$>	
			<$rowClass = "account-row-frozen"$>
		<$endif$>
		
		<tr class="account-details-row<$if rowClass$> <$rowClass$><$endif$>">
			<td class="first-col mono-type">
				
				<$exec rsFirst("rsAMLAccounts")$>
				<$isAMLAccount=""$>
				
				<$loop rsAMLAccounts$>
					<$if (rsAMLAccounts.ACCNUMEXT like rsAccounts.ACCNUMEXT)$>
						<$isAMLAccount=1$>
						<$break$>
					<$endif$>
				<$endloop$>
				
				<$if isAMLAccount$>
					<b>
				<$endif$>
				
				<a href="?IdcService=CCLA_CS_ACCOUNT_INFO<$include add_idc_token_to_url$>&ACCNUMEXT=<$#active.ACCNUMEXT$>"><$#active.ACCNUMEXT$></a>
			
				<$if isAMLAccount$>
					</b>
				<$endif$>
			
			</td>
			<td align="right" class="mono-type"><$#active.ACC_CASH$></td>
			<td align="right" class="mono-type"><$#active.ACC_UNITS$></td>
			<td><$#active.ACCOUNT_STATUS_ID$></td>
			<td><$formatDateOnly(#active.DATE_OPENED)$></td>
			<td><$#active.INCOME_DISTRIBUTION_METHOD$></td>
			<td align="center">
				<$amlChecked = ""$>
				
				<$loop rsAmlChecked$>
					<$if #active.ACCNUMEXT like rsAmlChecked.ACCNUMEXT$>
						<$amlChecked = 1$>
					<$endif$>
				<$endloop$>
				
				<input type="checkbox" class="aml-complete-check" name="amlChecked_<$#active.ACCNUMEXT$>" id="amlChecked_<$#active.ACCNUMEXT$>"
				 <$if amlChecked$>checked<$endif$> />
				
			</td>
		</tr>
		
	<$endloop$>
	
	</table>
	
	<form name="amlCheckForm" id="amlCheckForm" method="POST" >
		<input type="hidden" name="IdcService" value="CCLA_CS_UPDATE_ACCOUNTS_AML_STATUS" />
		<$include add_idc_token_to_form$>
		<input type="hidden" name="RedirectUrl" value="<$HttpCgiPath$>?IdcService=CCLA_CS_PROCESS_INFO<$include add_idc_token_to_url$>&PROCESS_ID=<$#local.PROCESS_ID$>" />

		<$loop rsProcess$>
			<input type="hidden" name="PROCESS_ID" value="<$#active.PROCESS_ID$>" />
			<input type="hidden" name="ORGANISATION_ID"  value="<$#active.ORGANISATION_ID$>" />
		<$endloop$>
		
		<!-- Completed via JavaScript method, based on ticked account checkboxes" -->
		<input type="hidden" name="accounts" value="" />
			
	</form>
	
	<br/>
	
	<div class="message_panel error_icon" id="notifySubmitUpdates" style="display: none;">
		Click the Submit Updates button to apply your changes.
	</div>
	
	<div style="text-align: right">
		<input type="button" value="Submit updates" onclick="submitAMLCheckForm()" />
	</div>
	
	<script type="text/javascript">
		
		var accounts = new Array();
		
		<!-- Build array of listed accounts -->
		<$loop rsAccounts$>
			accounts[<$rsAccounts.#row$>] = "<$#active.ACCNUMEXT$>";
		<$endloop$>
		
		$(".aml-complete-check").bind("click", function() {
			$("#notifySubmitUpdates").css("display","");
		});
		
		function submitAMLCheckForm() {
			var selAccounts = "";
		
			for (var i=0; i<accounts.length; i++) {				
				var isChecked = $("#amlChecked_" + accounts[i]).is(":checked");
			
				if (isChecked) {
					if (selAccounts != "")
					 selAccounts += ",";
				
					selAccounts += accounts[i];
				}
			}
			
			var frm = document.forms['amlCheckForm'];
			frm.elements['accounts'].value = selAccounts;
			
			frm.submit();
		};
		
	</script>
	
<@end@>

<!-- Displays a count of all accounts in the rsAccounts ResultSet, grouped
	 by their status. -->
<@dynamichtml ccla_cs_display_account_summary@>

	<$totalOpen = 0$>
	<$totalClos = 0$>
	<$totalFroz = 0$>
	
	<$loop rsAccounts$>
		<$if #active.SHORT_NAME like "OPEN"$>
			<$totalOpen = totalOpen + 1$>
		<$elseif #active.SHORT_NAME like "CLOS"$>
			<$totalClos = totalClos + 1$>
		<$elseif #active.SHORT_NAME like "FROZ"$>	
			<$totalFroz = totalFroz + 1$>
		<$endif$>
	<$endloop$>
	
	<table class="ccla-table" cellspacing="0">
		<tr>
			<th>Account status</th><th>Count</th>
		</tr>

		<tr>
			<td>Open</td><td><$totalOpen$></td>
		</tr>
		<tr>
			<td>Closed</td><td><$totalClos$></td>
		</tr>
		<tr>
			<td>Frozen</td><td><$totalFroz$></td>
		</tr>
	</table>

<@end@>

<@dynamichtml ccla_cs_display_interactions@>
	<$if IsDebug$>ccla_cs_display_interactions<$endif$>

	<$executeService("CCLA_CS_GET_LEGACY_CAMPAIGNS")$>
	<table class="accounts-table" cellspacing="0" cellpadding="0" width="100%">
		<tr>
			<th class="first-col" width="12%">Type</th>
			
			<$if #local.filter like "person"$>
				<th>Organisation</th>
			<$elseif #local.filter like "client"$>
				<th >Person</th>
			<$endif$>
			
			<th width="15%">Subject</th>
			<th <$if #local.filter$>width="15%"<$else$>width="25%"<$endif$>>Category</th>
			<th width="15%">User</th>
			<th width="10%">Date</th>
		</tr>
			
		<$loop rsInteractions$>
				
			<tr class="account-details-row">
				<td class="first-col">
					<$#active.INTERACTION_TYPE$>
				</td>
				
				<$if #local.filter like "person"$>
					<td>
						<a href="?IdcService=CCLA_CS_ENTITY_INFO<$include add_idc_token_to_url$>&ORGANISATION_ID=<$#active.ORGANISATION_ID$>"><$#active.ORGANISATION_NAME$></a>
					</td>
				<$elseif #local.filter like "client"$>
					<td>
						<a href="?IdcService=CCLA_CS_PERSON_INFO<$include add_idc_token_to_url$>&PERSON_ID=<$#active.PERSON_ID$>"><$include ccla_cs_person_name_display$></a>
					</td>
				<$endif$>
				
				<td>
					<$if #active.SUBJECT$>
						<$#active.SUBJECT$>
					<$else$>
						&nbsp;
					<$endif$>
					
					<$if #active.CAMPAIGN_ID$>
						<$loop rsLegacyCampaign$>
							<$if rsInteractions.CAMPAIGN_ID like rsLegacyCampaign.CAMPAIGN_ID$>
								<br/>
								<span style="font-size: 0.9em; color: #999;"><$rsLegacyCampaign.NAME$></a>
							<$endif$>
						<$endloop$>
					<$endif$>
					
				</td>
				<td>
				<$if #active.CATEGORY$>
						<$#active.CATEGORY	$>
					<$else$>
						&nbsp;
					<$endif$>	
				</td>
				<td><$strReplace(#active.USER_ID,"CCLA\\","")$></td>
				<td><$#active.INTERACTION_DATE$></td>
			</tr>
		
		<$endloop$>
	
	</table>
	
<@end@>

<!-- If an rsAccounts ResultSet is present/non-empty, this include will print
	 out the 'last updated' date from the first account entry. -->
<@dynamichtml ccla_cs_display_accounts_last_update@>
	<$if rsAccounts$>
		<$loop rsAccounts$>
			Last updated: <$formatDateOnly(rsAccounts.LAST_UPDATED)$>
			<$break$>
		<$endloop$>
	<$endif$>
<@end@>

<!-- Displays AML info for current client. -->
<@dynamichtml ccla_cs_aml_process_info@>
	
	<br/>
	<$clientId = rsProcess.CLIENT_ID$>
	<$company  = rsProcess.COMPANY$>
	
	<$ORGANISATION_ID = rsProcess.ORGANISATION_ID$>
	
	<$executeService("CCLA_CS_GET_CLIENT_AML_INFO")$>
	
	<h3 class="ccla_data_panel_header">AML Checklist status</h3>
	
	<$include ccla_cs_client_legacy_aml_status$>
	
	<br/>

	<h3 class="ccla_data_panel_header">
		Accounts 
	</h3>
	
	<$include ccla_cs_display_accounts_last_update$>

	<$if not rsAccounts$>
		
		None
		
	<$else$>
			
			<$if false$>
				<p>
					<$rsAccountCorrespondents.#numRows$> unique account correspondents require an AML chaser.
				</p>
			<$endif$>
			
			<p>
				<$rsAMLAccounts.#numRows$> of <$rsAccounts.#numRows$> accounts require an AML chaser (shown in <b>bold</b>)
			</p>
			
			<$include ccla_cs_display_aml_accounts$>
	
	<$endif$>
<@end@>

<!-- Displays Seg. Client enrolment info for current client.

	 Relies on presence of ccla_cs_enrolment_attributes_js include -->
<@dynamichtml ccla_cs_seg_client_process_info@>

	<br/>

	<script type="text/javascript">
		
		// Customized display include.
		enrolmentAttributesIncName = "ccla_cs_seg_client_enrolment_attributes_display";
		
		// Applicable Enrolment Attribute ID for the Bank Account field
		var bankAccountAttrId = 1;
	
		// Applicable Enrolment Attribute ID for the Number of Authorising Sigs field
		var numSigsAttrId = 2;
		
		// Opens a Bank Account selector pop-up, with a reference to the
		// Bank Account Enrolment Attribute field for call-back.
		function selectNominatedBankAccount() {
			openPopup("?IdcService=CCLA_CS_BANK_ACCOUNT_RELATION_ADD<$include add_idc_token_to_url$>" 
			 + "&APPLENROLATTR_ID=" + bankAccountAttrId
			 + "&parentRef=APPLENROLATTR_ID_" + bankAccountAttrId);
		}
		
		// Removes the currently-mapped bank account attribute
		function removeNominatedBankAccount() {
			if (confirm("Are you sure you wish to remove the nominated bank account?"))
				updateEnrolmentAttribute(bankAccountAttrId, "");
		}
		
		function updateSingleEnrolmentAttribute(applEnrolmentAttrId) {
			updateEnrolmentAttribute(applEnrolmentAttrId, 
			 $("#ATTRIBUTE_VALUE_" + applEnrolmentAttrId).val());
		}
		
		// Callback function used by generic pop-up windows, to send information
		// back to this page.
		function doSelectCallback(ref, vars) {
			
			if (ref == ("APPLENROLATTR_ID_" + bankAccountAttrId)) {
				// Bank Account has been selected.
				var selBankAccountId = vars['BANK_ACCOUNT_ID'];
				
				$("#ATTRIBUTE_VALUE_" + bankAccountAttrId).val(vars['BANK_ACCOUNT_ID']);
				
				// Update the attribute in DB
				updateEnrolmentAttribute(bankAccountAttrId, selBankAccountId);
			}
		}
		
	</script>
	
	<div id="enrolmentAttributeDisplay">
		
		<$executeService("CCLA_CS_GET_CLIENT_ENROLMENT_ATTRIBUTE_INFO")$>
	
		<$include ccla_cs_seg_client_enrolment_attributes_display$>
	</div>
	
<@end@>

<!-- Displays Community First enrolment info for current client.

	 Relies on presence of ccla_cs_enrolment_attributes_js include -->
<@dynamichtml ccla_cs_comm_first_process_info@>
	
	<script type="text/javascript">
		
		var donationAccountId = "<$loop rsDonationAccount$><$#active.ACCOUNT_ID$><$endloop$>";
		var donationAccountStatusId = "<$loop rsDonationAccount$><$#active.ACCOUNT_STATUS_ID$><$endloop$>";
		
		// Opens the Add New Subscription screen.
		function addNewSubscription() {
			if (donationAccountStatusId != "1") {
				// Donation account isn't open.
				alert("You cannot make new Subscriptions against this Organisation " +
				 "- the donation account is inactive.\n\n" +
				 "Please use the active LCF Organisation record instead.");
				return;
			}
		
			window.open("?IdcService=CCLA_CS_SUBSCRIPTION_NEW" +
			 "<$include add_idc_token_to_url$>&ACCOUNT_ID=" + donationAccountId + 
			 "&PRODUCT_ID=<$#env.CCLA_CS_ProductId_CommunityFirst$>");
		}
		
		// Submits the Apply Custom Action form, which sends a request to generate the
		// singleton Donation Account.
		function generateDonationAccount() {
			$("#generateDonationAccountForm").submit();
		}
		
	</script>
	
	<br/>
	
	[[% Display list of investments linked to the Community First donations account,
		providing there is a donation account. %]]
	
	<$exec rsFirst("rsDonationAccount")$>
	
	<h3 class="ccla_data_panel_header">
		Donation Account
	</h3>
	
	<$if not rsDonationAccount$>
		
		<p>
			No Donation account for this Community First client. You can't set up Investments/Donations
			until the account has been generated.
		</p>
		
		<p>
			<a href="javascript:generateDonationAccount();">Click here</a> to generate the Donation Account.
		</p>
		
		<form name="generateDonationAccountForm" id="generateDonationAccountForm">
			<input type="hidden" name="IdcService" 				value="CCLA_CS_APPLY_ENROLMENT_ACTION" />
			<$include add_idc_token_to_form$>
			<input type="hidden" name="RedirectUrl" 			value="<$HttpCgiPath$>?IdcService=CCLA_CS_CAMPAIGN_ENROLMENT_INFO<$include add_idc_token_to_url$>&CAMPAIGN_ENROLMENT_ID=<$#local.CAMPAIGN_ENROLMENT_ID$>&ORGANISATION_ID=<$#active.ORGANISATION_ID$>&PERSON_ID=<$#active.PERSON_ID$>" />
			
			<input type="hidden" name="CAMPAIGN_ENROLMENT_ID" 	value="<$#active.CAMPAIGN_ENROLMENT_ID$>" />
			<input type="hidden" name="ACTION_ID" 				value="1" />
			<input type="hidden" name="isCustomAction" 			value="1" />
			
		</form>
		
	<$else$>
		
		<$ORGANISATION_ID=#active.ORGANISATION_ID$>
		<$filterType = "FUND"$>
		<$FUND_CODE = #env.CCLA_CS_CommFirst_DonationAccount_FundCode$>

		<$executeService("CCLA_CS_GET_CLIENT_ACCOUNTS")$>
		
		<$displayInvestmentIntentionFields=""$>
		<$enrolmentAccountCurrency = "cash"$>

		<$include ccla_cs_display_enrolment_accounts$>
		
		</br><br/>
	
		<div id="investmentsDisplay">
			
			<h3 class="ccla_data_panel_header">
				Subscriptions
			</h3>
			
			<$include ccla_cs_account_subscriptions_display$>
			
			<br/>
			
			<$donorAccountStatusId = ""$>
			
			<div align="right">
			
				<input 	type="button" 
						name="addSubscriptionButton"
						id="addSubscriptionButton"
						value="Add new subscription..."
						onclick="addNewSubscription()"
					/>
			</div>
			
		</div>
		
	<$endif$>

	<script type="text/javascript">
		
		// Customized display include.
		enrolmentAttributesIncName = "ccla_cs_comm_first_enrolment_attributes_display";
		
		// Applicable Enrolment Attribute ID for the Bank Account field
		var bankAccountAttrId = 5;

		// Opens a Bank Account selector pop-up, with a reference to the
		// Bank Account Enrolment Attribute field for call-back.
		function selectNominatedBankAccount() {
			openPopup("?IdcService=CCLA_CS_BANK_ACCOUNT_RELATION_ADD<$include add_idc_token_to_url$>" 
			 + "&APPLENROLATTR_ID=" + bankAccountAttrId
			 + "&parentRef=APPLENROLATTR_ID_" + bankAccountAttrId);
		}
		
		// Removes the currently-mapped bank account attribute
		function removeNominatedBankAccount() {
			if (confirm("Are you sure you wish to remove the nominated bank account?"))
				updateEnrolmentAttribute(bankAccountAttrId, "");
		}
		
		function updateSingleEnrolmentAttribute(applEnrolmentAttrId) {
			updateEnrolmentAttribute(applEnrolmentAttrId, 
			 $("#ATTRIBUTE_VALUE_" + applEnrolmentAttrId).val());
		}
		
		// Callback function used by generic pop-up windows, to send information
		// back to this page.
		function doSelectCallback(ref, vars) {
			
			if (ref == ("APPLENROLATTR_ID_" + bankAccountAttrId)) {
				// Bank Account has been selected.
				var selBankAccountId = vars['BANK_ACCOUNT_ID'];
				
				$("#ATTRIBUTE_VALUE_" + bankAccountAttrId).val(vars['BANK_ACCOUNT_ID']);
				
				// Update the attribute in DB
				updateEnrolmentAttribute(bankAccountAttrId, selBankAccountId);
			}
		}
		
	</script>
	
	<div id="enrolmentAttributeDisplay">
		
		<$executeService("CCLA_CS_GET_CLIENT_ENROLMENT_ATTRIBUTE_INFO")$>
	
		<$include ccla_cs_comm_first_enrolment_attributes_display$>
	</div>
	
<@end@>

<!-- Displays Seg. Client enrolment info for current client. -->
<@dynamichtml ccla_cs_seg_client_enrolment_attributes_display@>
	
	<$if isAjax$>
		<div class="message_panel info_icon">
			Enrolment attributes updated
		</div>
	
		<$executeService("CCLA_CS_GET_CLIENT_ENROLMENT_ATTRIBUTE_INFO")$>
	<$endif$>
	
	<h3 class="ccla_data_panel_header">
		Nominated Bank Account
	</h3>
	
	<p>Choose the bank account that will be printed on the Application form.</p>
	
	<div id="nominatedbankAccount">

		<$if rsRelatedBankAccounts$>
			<$include ccla_cs_related_bank_accounts_display$>
		<$endif$>
		
		<$loop rsEnrolmentAttributesApplied$>
			<$if #active.APPLENROLATTR_ID == 1$>
				<$thisAttribValue = #active.ATTRIBUTE_VALUE$>
			<$endif$>
		<$endloop$>
		
		<input type="button" onclick="selectNominatedBankAccount()" value="Select..." />
		
		<$if rsRelatedBankAccounts$>
			<input type="button" onclick="removeNominatedBankAccount()" value="Remove" />
		<$endif$>

	</div>
	
	<br/>
	
	<h3 class="ccla_data_panel_header">
		Minimum Number of Directors/Controller entries
	</h3>
	
	<p>Choose the number of Director/Controller entries that will be printed on the Application form.</p>
	
	<div id="numAuthSigsPanel">

		<$thisAttribValue = ""$>
		
		<$loop rsEnrolmentAttributesApplied$>
			<$if #active.APPLENROLATTR_ID == 3$>
				<$thisAttribValue = #active.ATTRIBUTE_VALUE$>
			<$endif$>
		<$endloop$>
		
		<input type="text" name="ATTRIBUTE_VALUE_3" id="ATTRIBUTE_VALUE_3" value="<$#local.thisAttribValue$>" />
		
		<input type="button" size="3" onclick="updateSingleEnrolmentAttribute(3)" value="Update" />
		
	</div>
	
	<br/>
	
	<h3 class="ccla_data_panel_header">
		Minimum Number of Other Signatories entries
	</h3>
	
	<p>Choose the number of Other Signatory entries that will be printed on the Application form.</p>
	
	<div id="numAuthSigsPanel">

		<$thisAttribValue = ""$>
		
		<$loop rsEnrolmentAttributesApplied$>
			<$if #active.APPLENROLATTR_ID == 4$>
				<$thisAttribValue = #active.ATTRIBUTE_VALUE$>
			<$endif$>
		<$endloop$>
		
		<input type="text" name="ATTRIBUTE_VALUE_4" id="ATTRIBUTE_VALUE_4" value="<$#local.thisAttribValue$>" />
		
		<input type="button" size="3" onclick="updateSingleEnrolmentAttribute(4)" value="Update" />
		
	</div>
	
	<br/>
	
	<h3 class="ccla_data_panel_header">
		Number of required signatures
	</h3>
	
	<p>Choose the number of signature boxes that appear at the end of the form (default is 2, must be between 1 and 3)</p>
	
	<div id="numAuthSigsPanel">

		<$thisAttribValue = ""$>
		
		<$loop rsEnrolmentAttributesApplied$>
			<$if #active.APPLENROLATTR_ID == 2$>
				<$thisAttribValue = #active.ATTRIBUTE_VALUE$>
			<$endif$>
		<$endloop$>
		
		<input type="text" name="ATTRIBUTE_VALUE_2" id="ATTRIBUTE_VALUE_2" value="<$#local.thisAttribValue$>" />
		
		<input type="button" size="3" onclick="updateSingleEnrolmentAttribute(2)" value="Update" />
		
	</div>
	
	<br/>

<@end@>

<!-- Displays Seg. Client enrolment info for current client. -->
<@dynamichtml ccla_cs_comm_first_enrolment_attributes_display@>
	
	<$if isAjax$>
		<div class="message_panel info_icon">
			Enrolment attributes updated
		</div>
	
		<$executeService("CCLA_CS_GET_CLIENT_ENROLMENT_ATTRIBUTE_INFO")$>
	<$endif$>
	
	<h3 class="ccla_data_panel_header">
		Nominated Bank Account
	</h3>
	
	<p>Choose the bank account that will be printed on the Application form.</p>
	
	<div id="nominatedbankAccount">

		<$if rsRelatedBankAccounts$>
			<$include ccla_cs_related_bank_accounts_display$>
		<$endif$>
		
		<$loop rsEnrolmentAttributesApplied$>
			<$if #active.APPLENROLATTR_ID == 5$>
				<$thisAttribValue = #active.ATTRIBUTE_VALUE$>
			<$endif$>
		<$endloop$>
		
		<input type="button" onclick="selectNominatedBankAccount()" value="Select..." />
		
		<$if rsRelatedBankAccounts$>
			<input type="button" onclick="removeNominatedBankAccount()" value="Remove" />
		<$endif$>

	</div>
	
	<br/>
	
	<h3 class="ccla_data_panel_header">
		Minimum Number of Directors/Controller entries
	</h3>
	
	<p>Choose the number of Director/Controller entries that will be printed on the Application form.</p>
	
	<div id="numAuthSigsPanel">

		<$thisAttribValue = ""$>
		
		<$loop rsEnrolmentAttributesApplied$>
			<$if #active.APPLENROLATTR_ID == 6$>
				<$thisAttribValue = #active.ATTRIBUTE_VALUE$>
			<$endif$>
		<$endloop$>
		
		<input type="text" name="ATTRIBUTE_VALUE_6" id="ATTRIBUTE_VALUE_6" value="<$#local.thisAttribValue$>" />
		
		<input type="button" size="3" onclick="updateSingleEnrolmentAttribute(6)" value="Update" />
		
	</div>
	
	<br/>
	
	<h3 class="ccla_data_panel_header">
		Minimum Number of Other Signatories entries
	</h3>
	
	<p>Choose the number of Other Signatory entries that will be printed on the Application form.</p>
	
	<div id="numAuthSigsPanel">

		<$thisAttribValue = ""$>
		
		<$loop rsEnrolmentAttributesApplied$>
			<$if #active.APPLENROLATTR_ID == 7$>
				<$thisAttribValue = #active.ATTRIBUTE_VALUE$>
			<$endif$>
		<$endloop$>
		
		<input type="text" name="ATTRIBUTE_VALUE_7" id="ATTRIBUTE_VALUE_7" value="<$#local.thisAttribValue$>" />
		
		<input type="button" size="3" onclick="updateSingleEnrolmentAttribute(7)" value="Update" />
		
	</div>
	
	<br/>

<@end@>

<!-- Displays PSDF enrolment info for current client.

	 Allows new 'account intentions' to be added. This will generate
     a PC/PI account pair and display the PC account in a table, along with
     an intention amount and confidence

	 Beneath the account intentions is a Required Details checklist. All
	 these checkboxes must be set before a reg. form can be generated. -->
<@dynamichtml ccla_cs_psdf_reg_process_info@>

	<$FUND_CODE="PC"$>
	<$ORGANISATION_ID=#active.ORGANISATION_ID$>
	
	<br/>
	
	[[% Used for submission of actions on accounts, e.g. form generation %]]
	<form name="enrolmentAccountForm" id="enrolmentAccountForm">
		<input type="hidden" name="IdcService" value="" />
		<$include add_idc_token_to_form$>
		<input type="hidden" name="RedirectUrl" 
				value="?IdcService=CCLA_CS_CAMPAIGN_ENROLMENT_INFO<$include add_idc_token_to_url$>&CAMPAIGN_ENROLMENT_ID=<$#local.CAMPAIGN_ENROLMENT_ID$>&ORGANISATION_ID=<$#local.ORGANISATION_ID$>&PERSON_ID=<$#local.PERSON_ID$>" />
		
		<input type="hidden" name="CAMPAIGN_ENROLMENT_ID" value="<$#local.CAMPAIGN_ENROLMENT_ID$>" />
		<input type="hidden" name="ACCOUNT_ID" value="" />
		
		<input type="hidden" name="BANK_ACCOUNT_ID" value="" />
	</form>
	
	<script type="text/javascript">
		
		var enrolmentAccountForm = document.forms["enrolmentAccountForm"];
		
		function applyAccountAction(actionName, accountId) {
			
			var idcService;
			
			if (actionName == "genWelcomePack") {
				idcService = "CCLA_CS_GENERATE_PSDF_WELCOME_PACK";
				
				if (!confirm("Are you sure you want to generate a " +
				 "Welcome Pack for this account?"))
					return;
				
			} else if (actionName == "genAdditionalAccountForm") {
				idcService = "CCLA_CS_GENERATE_PSDF_ADDITIONAL_ACCOUNT_FORM";
				
				if (!confirm("Are you sure you want to generate an " +
				"Additional Account opening form for this account?"))
					return;
			
			} else if (actionName == "genChangeOfDividendPaymentForm") {
				idcService = "CCLA_CS_GEN_PSDF_CHANGE_OF_DIVIDEND_PAYMENT_FORM";
				
				if (!confirm("Are you sure you want to generate a " +
				"Change of Dividend Payment form for this account?"))
					return;
			} else if (actionName == "genAdditionalWithdrawalBankAccountForm") {
				idcService = "CCLA_CS_GEN_PSDF_ADDITIONAL_BANK_ACCOUNT_FORM";
				
				if (!confirm("Are you sure you want to generate an " +
				"Additional Withdrawal Bank Account form for this account?"))
					return;
			}
			
			enrolmentAccountForm.IdcService.value = idcService;
			enrolmentAccountForm.ACCOUNT_ID.value = accountId;
			
			enrolmentAccountForm.submit();
		}
		
	</script>
	
	<h3 class="ccla_data_panel_header">
		Client PC Accounts
	</h3>
	
	<$filterType = "FUND"$>
	<$FUND_CODE = #env.CCLA_CS_PSDF_Capital_FundCode$>

	<$executeService("CCLA_CS_GET_CLIENT_ACCOUNTS")$>
	
	<$displayInvestmentIntentionFields=1$>
	<$enrolmentAccountType = "unitized"$>
	<$enrolmentAccountCurrency = "units"$>
	<$enrolmentAccountMenuInclude = "ccla_cs_enrolment_psdf_reg_account_menu"$>
	
	<$include ccla_cs_display_enrolment_accounts$>
		
	<br/>
	
	<div style="float:right">
		<label for="INVINTENTSTATUS_ID">Confidence: </label>
		<select name="INVINTENTSTATUS_ID" id="NEW_INVINTENTSTATUS_ID">
			<$loop rsIntentionStatus$>
				<option value="<$#active.INVINTENTSTATUS_ID$>" <$if strEquals(#active.INVINTENTSTATUS_ID,currentStatus)$>selected<$endif$> ><$#active.INVINTENTSTATUS_NAME$></option>
			<$endloop$>
		</select>
		<label for="UNITS">Amount:</label>
		<input type="text" size="12" name="UNITS" id="NEW_UNITS" />
		
		<input type="button" value="Create account template" onclick="javascript:checkApplyAction('createNewAccountTemp');">
	</div>
	
	<br/>	
	<br/>
	
	<$include ccla_cs_display_psdf_reg_required_details_checklist$>
	
<@end@>

<@dynamichtml ccla_cs_display_psdf_reg_required_details_checklist@>

	<$if IsDebug$>ccla_cs_display_psdf_reg_required_details_checklist<$endif$>
	
	<h3 class="ccla_data_panel_header">Required Details Checklist</h3>

	<div>To be able to generate forms please ensure the following information has been set:</div>
	<br>
	
	<ul id="requiredDetailsUL">
		<li>
		<input id="required_Correspondant" disabled="true" <$if #active.PERSON_ID$>checked=checked<$endif$> type="checkbox"/>
		<label for="required_Correspondant" class="shiftUp">Campaign Recipient<$if not #active.PERSON_ID$> - <a target="_blank" href="?IdcService=CCLA_CS_ENTITY_EDIT<$include add_idc_token_to_url$>&ORGANISATION_ID=<$#active.ORGANISATION_ID$>">(assign a campaign recipient) </a><$endif$></label>
		</li>
		
		<li>
		<input id="required_Address" disabled="true" <$if #active.CONTACT_ADDRESS_VALID$>checked=checked<$endif$> type="checkbox"/>
		<label for="required_Address" class="shiftUp">Preferred Contact Address<$if not #active.CONTACT_ADDRESS_VALID$> - <a target="_blank" href="?IdcService=CCLA_CS_ENTITY_EDIT<$include add_idc_token_to_url$>&ORGANISATION_ID=<$#active.ORGANISATION_ID$>">(add an address) </a><$endif$></label>
		</li>
		
		<li>
		<$loop rsSelectedCategories$>
			<$if #active.BASE_CAT_NAME$>
				<$validCategory=1$>
			<$else$>
				<$validCategory=0$>
			<$endif$>
		<$endloop$>
		<input id="required_Category" disabled="true" <$if validCategory==1$>checked=checked<$endif$>  type="checkbox"/>
		<label for="required_Category" class="shiftUp">Organisation Category<$if #active.validCategory==0$> - <a target="_blank" href="?IdcService=CCLA_CS_ENTITY_EDIT<$include add_idc_token_to_url$>&ORGANISATION_ID=<$#active.ORGANISATION_ID$>">(assign an organisation category) </a><$endif$></label>
		</li>
		
		<li>
		<input id="required_Intention" disabled="true" <$if rsAccounts$>checked=checked<$endif$> type="checkbox"/>
		<label for="required_Intention" class="shiftUp">Investment Intention</label>
		</li>

		<li>
		<input id="required_AccountTemplates" disabled="true" <$if isTrue(HAS_TEMP_ACCOUNTS)$>checked=checked<$endif$> type="checkbox"/>
		<label for="required_AccountTemplates" class="shiftUp">Account Templates<$if not isTrue(HAS_TEMP_ACCOUNTS)$> - <a target="_blank" style="cursor:pointer" onclick="checkApplyAction('Create account template(s)');">(add account template) </a><$endif$></label>
		</li>
		
		<li>
		<input id="required_ClientInterested" disabled="true" <$if isTrue(CLIENT_IS_INTERESTED)$>checked=checked<$endif$> type="checkbox"/>
		<label for="required_ClientInterested" class="shiftUp">Client Interested<$if not isTrue(CLIENT_IS_INTERESTED)$> - (change client status to interested) <$endif$></label>
		</li>
		
		<li>
		<input id="required_AuroraClientNum" disabled="true" <$if rsAuroraClientMap$>checked=checked<$endif$> type="checkbox"/>
		<label for="required_AuroraClientNum" class="shiftUp">Aurora Client Number<$if not rsAuroraClientMap$> - <a target="_blank" href="?IdcService=CCLA_CS_ENTITY_EDIT<$include add_idc_token_to_url$>&ORGANISATION_ID=<$#active.ORGANISATION_ID$>">(assign an Aurora client number)</a><$endif$></label>
		</li>
		
		<li>
		<input id="required_AccountSubtitles" disabled="true" <$if not missingAccountSubtitle$>checked=checked<$endif$> type="checkbox"/>
		<label for="required_AccountSubtitles" class="shiftUp">Account Name</label>
		</li>
		
		<$if false$>
			<li>
			<input id="required_Sigs" disabled="true" <$if isTrue(HAS_SIGS)$>checked=checked<$endif$> type="checkbox"/>
			<label for="required_Sigs" class="shiftUp">Signatories assigned<$if not isTrue(HAS_SIGS)$> - (add signatories)<$endif$></label>
			</li>
			
			<li>
			<input id="required_AuthPersons" disabled="true" <$if isTrue(HAS_AUTH_PERSONS)$>checked=checked<$endif$> type="checkbox"/>
			<label for="required_AuthPersons" class="shiftUp">Auth persons assigned<$if not isTrue(HAS_AUTH_PERSONS)$> - (add auth persons) <$endif$></label>
			</li>
			
			<li>
			<input id="required_BankAccounts" disabled="true" <$if isTrue(HAS_BANK_ACCOUNTS)$>checked=checked<$endif$> type="checkbox"/>
			<label for="required_BankAccounts" class="shiftUp">Bank accounts assigned<$if not isTrue(HAS_BANK_ACCOUNTS)$> - (add bank accounts) <$endif$></label>
			</li>
		<$endif$>
	</ul>

	<div class="cs-clear-both"></div>
	<br/>

<@end@>

<@dynamichtml ccla_cs_account_intention_psdf_detail_display@>
<$if IsDebug$>ccla_cs_account_intention_psdf_detail_display<$endif$>
	<input type="hidden" name="FUND_CODE" value="PC" />

	<table width="100%">
	<th width="20%"></th><th width="20%"></th><th width="20%"></th><th width="40%"></th>
		<tr>
			<td><label for="contactValue">Amount:</label></td>
			<td><input type="text" size="12" name="UNITS" id="UNITS" value="<$#active.UNITS$>" onchange="showNiceNumberFormat();" autocomplete="off" /></td>
			<td><div class="red" id="unitsFormatted"></div></td>
		</tr>
		<tr>
			<td><label for="contactValue">Confidence:</label></td>
			<td>
				<$currentStatus = rsIntentionDetail.INVINTENTSTATUS_ID$>
				<$if not currentStatus$>
					<$currentStatus = #env.CCLA_CS_DefaultInvestmentIntentionStatusId$>
				<$endif$>
				<select name="INVINTENTSTATUS_ID" id="INVINTENTSTATUS_ID">
					<$loop rsIntentionStatus$>
					<option value="<$#active.INVINTENTSTATUS_ID$>" <$if strEquals(#active.INVINTENTSTATUS_ID,currentStatus)$>selected<$endif$> ><$#active.INVINTENTSTATUS_NAME$></option>
					<$endloop$>
				</select>
			<td></td>
		</tr>

		<tr>
			<td><label for="USER_ID">Added By:</label></td>
			<td>
				<$if #active.USER_ID$><$#active.USER_ID$><$else$><$dUser$><$endif$>
			</td>
			<td>
			</td>
		</tr>
		
		<tr>
			<td><br/></td>
		</tr>
		
		<$if #active.update$>
			<tr>
			<td></td><td></td>
				<td align="right" colspan=2><input type="button" value="Update" onclick="updateIntention('<$#active.INVESTMENT_INTENTION_ID$>');" />
				&nbsp;<input type="button" value="Delete" onclick="removeIntention('<$#active.INVESTMENT_INTENTION_ID$>');" />
				</td>
			</tr>
		<$else$>
			<tr>
				<td align="right" colspan=2><input type="button" value="Add" onclick="addIntention('<$#active.INVESTMENT_INTENTION_ID$>');" /></td>
			</tr>
		<$endif$>
		
	</table>
	
<@end@>

<!-- Displays Dio Loan info for current client.

	 Allows new 'account intentions' to be added. This will generate
     a DioLoan account and display it in a table, along with
     an loan amount and confidence

	 Beneath the account intentions is a Required Details checklist. All
	 these checkboxes must be set before a reg. form can be generated. -->
<@dynamichtml ccla_cs_dioloan_process_info@>

	<$FUND_CODE="D"$>
	<$ORGANISATION_ID=#active.ORGANISATION_ID$>
	
	<br/>
	
	[[% Used for submission of actions on accounts, e.g. form generation %]]
	<form name="enrolmentAccountForm" id="enrolmentAccountForm">
		<input type="hidden" name="IdcService" value="" />
		<$include add_idc_token_to_form$>
		<input type="hidden" name="RedirectUrl" 
				value="?IdcService=CCLA_CS_CAMPAIGN_ENROLMENT_INFO<$include add_idc_token_to_url$>&CAMPAIGN_ENROLMENT_ID=<$#local.CAMPAIGN_ENROLMENT_ID$>&ORGANISATION_ID=<$#local.ORGANISATION_ID$>&PERSON_ID=<$#local.PERSON_ID$>" />
		
		<input type="hidden" name="CAMPAIGN_ENROLMENT_ID" value="<$#local.CAMPAIGN_ENROLMENT_ID$>" />
		<input type="hidden" name="ACCOUNT_ID" value="" />
		
		<input type="hidden" name="BANK_ACCOUNT_ID" value="" />
	</form>
	
	<script type="text/javascript">
		
		var enrolmentAccountForm = document.forms["enrolmentAccountForm"];
		
		function applyAccountAction(actionName, accountId) {
			
			var idcService;
			
			if (actionName == "genWelcomePack") {
				idcService = "CCLA_CS_GENERATE_DIOLOAN_WELCOME_PACK";
				
				if (!confirm("Are you sure you want to generate a " +
				 "Welcome Pack for this account?"))
					return;
				
			} else if (actionName == "genAdditionalAccountForm") {
				idcService = "CCLA_CS_GENERATE_DIOLOAN_ADDITIONAL_ACCOUNT_FORM";
				
				if (!confirm("Are you sure you want to generate an " +
				"Additional Account opening form for this account?"))
					return;
			
			}
			
			enrolmentAccountForm.IdcService.value = idcService;
			enrolmentAccountForm.ACCOUNT_ID.value = accountId;
			
			enrolmentAccountForm.submit();
		}
		
		function generateLoanAccount() {
			if (hasNominatedPersonAndContactAddress()) {
				if ($("#NEW_CASH").val().length == 0 ){
					alert("Please enter a loan amount. If unsure, please enter 0");
					$("#NEW_CASH").focus();
					return false;
				}
				
				if (confirm("Are you sure you wish to create a new Diocesan loan account?\n\n"))
					document.addLoanAccountForm.submit();
						
			} else {
				alert("Please ensure you have saved the nominated correspondent name " +
				 "and address before creating an account");
			}
		}
		
	</script>
	
	<h3 class="ccla_data_panel_header">
		Diocesan Loan Accounts
	</h3>
	
	<$filterType = "FUND_TYPE"$>
	<$FUND_CODE = #env.CCLA_CS_DioLoan_FundCode$>
	<$ACCOUNT_TYPE_ID = #env.CCLA_CS_AccountTypeId_Loan$>
	
	<$executeService("CCLA_CS_GET_CLIENT_ACCOUNTS")$>
	
	<$displayInvestmentIntentionFields=1$>
	<$enrolmentAccountType = "loan"$>
	<$enrolmentAccountCurrency = "cash"$>
	
	[[% Display total request loan amount, including how much they have left to loan. %]]
	
	<$totalLoanRequest = 0$>
	
	<$loop rsAccounts$>
		<$if #active.CASH$>
			<$totalLoanRequest = totalLoanRequest + #active.CASH$>
		<$endif$>
	<$endloop$>
	
	<$remainingLoanAvailable = #env.CCLA_CS_DioLoan_MaxLoanPerDiocese - totalLoanRequest$>
	
	<p>
		Total requested loan amount: £<$formatNumber(totalLoanRequest,2)$> (£<$formatNumber(remainingLoanAvailable,2)$> available)
	</p>
	
	<$include ccla_cs_display_enrolment_accounts$>
		
	<br/>
	<br/>
	
	<h3 class="ccla_data_panel_header">
		Add Loan Account
	</h3>
	
	<div class="ccla_data_panel">
	
		<form name="addLoanAccountForm" method="POST" id="addLoanAccountForm">
	
			<input type="hidden" name="IdcService" 				value="CCLA_CS_APPLY_ENROLMENT_ACTION" />
			<$include add_idc_token_to_form$>
			<input type="hidden" name="CAMPAIGN_ENROLMENT_ID" 	value="<$#local.CAMPAIGN_ENROLMENT_ID$>" />
			<input type="hidden" name="CAMPAIGN_ID" 			value="<$#active.CAMPAIGN_ID$>" />
							
			<!-- New Account field values -->
			<input type="hidden" name="INCOME_DISTRIBUTION_METHOD" 	id="INCOME_DISTRIBUTION_METHOD" value="RETN" />
			<input type="hidden" name="ACCOUNT_TYPE_ID" 			id="ACCOUNT_TYPE_ID" 			value="<$#env.CCLA_CS_AccountTypeId_Loan$>" />

			<input type="hidden" name="RedirectUrl" 			value="<$HttpCgiPath$>?IdcService=CCLA_CS_CAMPAIGN_ENROLMENT_INFO<$include add_idc_token_to_url$>&CAMPAIGN_ENROLMENT_ID=<$#local.CAMPAIGN_ENROLMENT_ID$>&ORGANISATION_ID=<$#active.ORGANISATION_ID$>&PERSON_ID=<$#active.PERSON_ID$>" />
			
			<input type="hidden" id="actionForm_action" 		name="ACTION_ID" value="1" />
			<input type="hidden" id="actionForm_isCustomAction" name="isCustomAction" value="1" />
			
			<div style="float:right; margin-bottom: 10px">
				<label for="INVINTENTSTATUS_ID">Confidence: </label>
				<select name="INVINTENTSTATUS_ID" id="NEW_INVINTENTSTATUS_ID">
					<$loop rsIntentionStatus$>
						<option value="<$#active.INVINTENTSTATUS_ID$>" <$if strEquals(#active.INVINTENTSTATUS_ID,currentStatus)$>selected<$endif$> ><$#active.INVINTENTSTATUS_NAME$></option>
					<$endloop$>
				</select>
				<label for="CASH">Amount:</label>
				<input type="text" size="12" name="CASH" id="NEW_CASH" />
				
				<label for="LOAN_TYPE">Loan Type:</label>
				
				<$include ccla_cs_account_loan_type_select$>
				
				<label for="LOAN_TERM">Term:</label>
				
				<$include ccla_cs_account_loan_term_select$>

			</div>
			
			<br/>
		
			<div style="float:right">
				<input type="button" value="Create loan account template" onclick="generateLoanAccount();">
			</div>
			
			<div style="clear:both"></div>
		
		</form>
		
	</div>
	
	<br/>	

	<a href="groups/public/documents/system/ccla_dioloan_guide.pdf" target="_blank">Help with client on-boarding</a>
	
	<br/>
	
	<$include ccla_cs_display_dioloan_required_details_checklist$>
	
<@end@>

<@dynamichtml ccla_cs_client_legacy_aml_status@>
	
	<$if not rsAMLInfo$>
		<p>
			Client was not part of original AML tracking.
		</p>
	<$endif$>
	
	<$loop rsAMLInfo$>
		
		<p>
			Legacy data taken from old AML tracker.
		</p>
		
		<table width="60%" class="cs-info-table">
			<tr>
				<th>Checks completed:</th><td><$#active.CORRESPONDENT_RESPONDED$></td>
				<th>Responded:</th><td><$#active.CORRESPONDENT_RESPONSE_TYPE$></td>
			</tr>
			
			<tr>
				<th>BAU in:</th><td><$#active.CORRESPONDENT_OVERRIDE$></td>
				<th>BAU out:</th><td><$#active.CORRESPONDENT_REQUESTED$></td>
				<th>On hold:</th><td><$#active.CORRESPONDENT_ONHOLD$></td>
			</tr>
			
			<tr>
				<th>QRS client:</th><td><$#active.CORRESPONDENT_QRS_CLIENT$></td>
				<th>IVS pre-Dec 07:</th><td><$#active.CORRESPONDENT_IVS_PRE1207$></td>
				<th>Account closed:</th><td><$#active.CORRESPONDENT_ACCOUNT_CLOSED$></td>
			</tr>
		</table>
		
	<$endloop$>
	
<@end@>

<!-- Displays a list of available process actions. -->
<@dynamichtml ccla_cs_process_actions_panel@>
<$if IsDebug$>ccla_cs_process_actions_panel<$endif$>
<$exec rsFirst("rsProcess")$>
	<$include orangeContainer_top$>

		<div class='ccla_cs_panel_header'>
			Actions
		</div>
		
		<div class='ccla_cs_panel_content'>
			
			<$processStatus = rsProcess.PROCESS_STATUS$>
			
			<script type="text/javascript">
				
				function applyAction(action) {
					<$if strEquals(#active.IdcService,"CCLA_CS_PROCESS_INFO")$>
						if (action=="Generate forms"){
							var validAddress = document.getElementById("required_Address").checked;
							var validCategory = document.getElementById("required_Category").checked;
							var validCorrespondant = document.getElementById("required_Correspondant").checked;

							var alertText = "Please fix the following: \n\n";
							
							
							if(!validAddress)
								alertText += "- Please assign a valid contact address \n"; 
							if(!validCategory)
								alertText += "- Please assign a valid organisation category \n";
							if(!validCorrespondant)
								alertText += "- Please assign a valid nominated correspondant\n";
							if(!validAddress || !validCategory || !validCorrespondant){
								alert(alertText);
								return;
							}

						}
					<$endif$>
				
					var c = confirm("Are you sure you wish to apply the process action:\n\n" +
					 "'" + action + "'?");
					
					if (!c)
						return;
				
					var frm = document.forms['actionForm'];
					
					frm.elements['action'].value = action;
					frm.submit();
				}
	
				function checkApplyAction(action) {
				
					var frm = document.forms['recipientForm'];
					if (frm.elements['HAS_PERSON'].value == '1' && frm.elements['HAS_ADDRESS'])
						applyAction(action)
					else
						alert('Please ensure you have saved the nominated correspondent name and address before creating an account');
					
				}
	
			</script>
			
			<table width="100%">
				<tr>
					<td width="50%">
			
						<form name="actionForm" method="POST">
							<input type="hidden" name="IdcService" 	value="CCLA_CS_APPLY_PROCESS_ACTION" /><$include add_idc_token_to_form$>
							<input type="hidden" name="PROCESS_ID" 	value="<$#local.PROCESS_ID$>" />
							
							<input type="hidden" name="RedirectUrl" value="<$HttpCgiPath$>?IdcService=CCLA_CS_PROCESS_INFO<$include add_idc_token_to_url$>&PROCESS_ID=<$#local.PROCESS_ID$>&ORGANISATION_ID=<$#active.ORGANISATION_ID$>&PERSON_ID=<$#active.PERSON_ID$>" />
							
							<input type="hidden" name="action" 		value="" />
						</form>
					
						
						<ul>
							<$if userHasRole("admin") and processStatus like "Excluded"$>
								<li>
									<a href="javascript:applyAction('Enroll');">Enroll</a>
								</li>
							<$else$>
						
								<$loop rsActions$>
									<$if #active.ACTION like "Cancel"$>
										<$if userHasRole("admin")$>
											<li>
												<a href="javascript:applyAction('<$#active.ACTION$>');"><$#active.ACTION$></a>
											</li>
										<$endif$>
									<$elseif #active.ACTION like "Create account template(s)"$>	
									<!-- hide this action (for psdf fund launch)-->
									<$else$>
										<li>
											<a href="javascript:applyAction('<$#active.ACTION$>');"><$#active.ACTION$></a>
										</li>
									<$endif$>
								<$endloop$>
								
								<$if userHasRole("admin")$>
									<li>
										<a href="javascript:applyAction('Exclude');">Exclude</a>
									</li>
								<$endif$>
								
							<$endif$>
						</ul>
					
					</td>
					
					<td>
						<b>Add new process note:</b>
						<br/>
						<form method="POST">
							<input type="hidden" name="IdcService" 	value="CCLA_CS_ADD_PROCESS_NOTE" /><$include add_idc_token_to_form$>
							<input type="hidden" name="PROCESS_ID" 	value="<$#local.PROCESS_ID$>" />
							
							<input type="hidden" name="RedirectUrl" value="<$HttpCgiPath$>?IdcService=CCLA_CS_PROCESS_INFO<$include add_idc_token_to_url$>&PROCESS_ID=<$#local.PROCESS_ID$>&ORGANISATION_ID=<$#active.ORGANISATION_ID$>&PERSON_ID=<$#active.PERSON_ID$>" />
						
							<textarea name="NOTE" style="width: 350px; height: 5em;"></textarea>
							<br/>
							<input type="submit" value="Submit" />
						</form>
					</td>
					
				</tr>
			</table>
				
		</div>

	<$include orangeContainer_bottom$>
	
<@end@>

<@dynamichtml ccla_cs_display_correspondent_details@>
	
	<h3 class="ccla_data_panel_header">Correspondent details</h3>
	
	<$if not rsCorrespondent$>
		<$correspondentId = personId$>
		<$methodName="GetCorrespondentByCorrespondentCode"$>
		<$executeService("CCLA_CALL_AURORA_WEB_SERVICE")$>
	<$endif$>
	
	<table width="100%" cellpadding=0 cellspacing=2>
	
		<$loop rsCorrespondent$>
			<tr>
				<td width="15%" valign="top"><b>ID</b></td>
				<td width="35%" valign="top">
					<$#local.correspondentId$>
					<$globalCorrespondentId = #local.correspondentId$>
				</td>
				<td valign="top" width="20%"><b>Address</b></td>
				<td width="30%" rowspan=3 valign="top">
					<$include ccla_cs_display_aurora_address$>
				</td>
			</tr>
			<tr>
				<td valign="top"><b>Name</b></td>
				<td valign="top">
					<$#active.name$>
					<$correspondentName = #active.name$>
				</td>
			</tr>
			<tr>
				<td valign="top"><b>Salutation</b></td>
				<td valign="top">
					<$#active.salutation$>
				</td>
			</tr>
		<$endloop$>
		
	</table>
					
<@end@>

<@dynamichtml ccla_cs_display_process_details@>
	
	<h3 class="ccla_data_panel_header">Process details</h3>
		
	<table width="100%" cellpadding=0 cellspacing=2>
	
		<$loop rsPersonProcesses$>
			<$if #active.CAMPAIGN_ID like campaignId$>
						
				<tr>
					<td width="15%" valign="top"><b>ID</b></td>
					<td width="35%" valign="top">
						<$#active.PROCESS_ID$>
					</td>
					<td valign="top" width="20%"><b>Name</b></td>
					<td width="30%" valign="top">
						<$#active.CAMPAIGN_NAME$>
					</td>
				</tr>
				<tr>
					<td valign="top"><b>Status</b></td>
					<td valign="top">
						<$#active.PROCESS_STATUS$>
					</td>
					
					<$if not print$>
						<td valign="top"><b>Actions</b></td>
						<td valign="top">
							
							<!-- Work out how many accounts have been marked for transfer -->
							<$numAccountsForTransfer = 0$>
							<$loop rsFundTransfers$>
								<$if #active.TRANSFER_TYPE like "amount|all|undecided"$>
									<$numAccountsForTransfer = numAccountsForTransfer + 1$>
								<$endif$>
							<$endloop$>
							
							<$if numAccountsForTransfer > 0$>
								<form method="POST">
									<input type="submit" value="Generate Transfer Form" />
									
									<input type="hidden" name="IdcService" value="CCLA_CS_CREATE_ETHICAL_FUND_TRANSFER_FORM" /><$include add_idc_token_to_form$>
									<input type="hidden" name="processId"  value="<$#active.PROCESS_ID$>" />
									
									<input type="hidden" name="RedirectUrl" value="<$HttpCgiPath$>?IdcService=CCLA_CS_REVIEW_FUND_TRANSFERS<$include add_idc_token_to_url$>&personId=<$#local.personId$>&processName=<$#local.processName$>&company=<$#local.company$>" />
								</form>

								<$if #env.AURORA_EnableFormPrinting$>
									<br/>
								
									<$QueryText = "dDocName <matches> `CS_" & #active.PROCESS_ID & "`"$>
									<$executeService("GET_SEARCH_RESULTS")$>
									
									<$if SearchResults$>
										<form method="POST">
											<input type="submit" value="Print Transfer Form" />
											
											<input type="hidden" name="processId"  value="<$#active.PROCESS_ID$>" />
											
											<input type="hidden" name="IdcService" value="CCLA_CS_PRINT_ETHICAL_FUND_FORM" /><$include add_idc_token_to_form$>
											<input type="hidden" name="formDocName"  value="<$#active.dDocName$>" />
											
											<input type="hidden" name="RedirectUrl" value="<$HttpCgiPath$>?IdcService=CCLA_CS_REVIEW_FUND_TRANSFERS<$include add_idc_token_to_url$>&personId=<$#local.personId$>&processName=<$#local.processName$>&company=<$#local.company$>" />
										</form>
									<$endif$>
									
								<$endif$>
								
							<$endif$>
							
						</td>
					<$endif$>
				</tr>
			<$endif$>
		<$endloop$>
		
	</table>
					
<@end@>


<@dynamichtml ccla_cs_entity_process_list@>
<$if IsDebug$>ccla_cs_entity_process_list<$endif$>
				<$include orangeContainer_top$>
				
					<div class='ccla_cs_panel_header'>
						Process Activities
					</div>
					
					<div class='ccla_cs_panel_content'>
						<$if not rsActivities$>
				
							<p>No previous activities logged to this process.</p>
							
						<$else$>
							
							<$include ccla_cs_display_activity_listing$>
						
						<$endif$>
					</div>
			
				<$include orangeContainer_bottom$>


<@end@>

<@dynamichtml ccla_cs_display_activity_listing@>
	<$if IsDebug$>ccla_cs_display_activity_listing<$endif$>	
	<table width="100%" cellpadding=0 cellspacing=0 class="accounts-table">
		<tr>
			<th class="first-col" width="120">User</th>
			<th width="80">Date</th>
			<th width="100">Activity type</th>
			<th width="">Action</th>
		</tr>
	
		<$loop rsActivities$>
			<$if not (#active.ACTIVITY_ID like #local.activityId)$>
				<tr class="account-details-row">
					<td class="first-col"><$#active.USER_ID$></td>
					<td><$#active.ACTIVITY_DATE$></td>
					<td><$#active.ACTIVITY_TYPE$></td>
					<td>
						<$if #active.ACTIVITY_ACTION$><$#active.ACTIVITY_ACTION$><$else$>&nbsp;<$endif$>												
					</td>
				</tr>
				
				<$if #active.NOTE_CONTENT$>
					
					<tr class="account-details-row">
						<td class="ccla-note-cell" colspan=4>
							<div class="ccla-note-connecter">
								&nbsp;
							</div>
							<div class="ccla-note">
								<pre><$#active.NOTE_CONTENT$></pre>
							</div>
						</td>
					</tr>
				
				<$endif$>
				
			<$endif$>
		<$endloop$>
	</table>
	
<@end@>

<!-- Lists the most recent documents from the UCM repository, for the current client. -->
<@dynamichtml ccla_cs_display_document_listing@>
	<$if IsDebug$>ccla_cs_display_document_listing<$endif$>	

	<$if not #local.ORGANISATION_ID$>
		<p class="no-info">No organisation/client info for document lookup</p>	
	<$else$>
		
		<$if not rsAuroraClientMap$>
			<$executeService("CCLA_CS_GET_AURORA_CLIENT_MAP")$>
		<$endif$>
		
		<$if not rsAuroraClientMap$>
		
			<p class="no-info">This organisation doesn't have any associated Aurora Client Numbers.</p>
		
		<$elseif not rsOrganisationCompanies$>
			
			<p class="no-info">This organisation doesn't have a Client Number to perform lookups against.</p>

		<$else$>
			
			<$exec rsFirst("rsAuroraClientMap")$>
			
			<$loop rsAuroraClientMap$>
				
				[[% Prepare doc fetch query for this Client Number/Company combo. %]]
				
				<$exec rsRemove("rsOrganisationDocs")$>
			
				<$numItems=15$>
				
				<$orgDocFetchMethod = "CLIENT_NUMBER_AND_COMPANY"$>
				<$CLIENT_NUMBER = rsAuroraClientMap.CLIENT_NUMBER$>
				<$CLIENT_NUMBER_PADDED = strLeftFill(CLIENT_NUMBER,"0",#active.CLIENT_NUMBER_PADDING)$>
				<$COMPANY_CODE = #active.COMPANY_CODE$>
				
				<$executeService("CCLA_CS_GET_RECENT_ORG_DOCS")$>
				
				<table class="cs-info-table" width="100%">
					<tr>
						<th width="15%">Client number:</th><td width="35%"><$#local.CLIENT_NUMBER_PADDED$></td>
						<th width="15%">Company:</th><td width="35%"><$#active.COMPANY_CODE$></td>
					</tr>
				</table>
				
				<br/>

				<$if not rsOrganisationDocs$>
					
					<p class="no-info">No documents found for this Client Number/Company</p>
				
				<$else$>
					
					<table width="100%" cellpadding=0 cellspacing=0 class="accounts-table">
						<tr>
							<th class="first-col" width="70">Date</th>
							<th width="110">Content ID</th>
							<th width="80">Source</th>
							<th width="90">Doc class</th>
							<th width="80">Acc. no.</th>
							<th>Cash</th>
							<th>Units</th>
							<th>Workflow ID</th>
							<th width=100>Status</th>
						</tr>
					
						<$loop rsOrganisationDocs$>
							
							<tr class="account-details-row">
								<td class="first-col"><$#active.dInDate$></td>
								<td>
									<$if not #active.isCompact$>
									<a target="_blank" href="?IdcService=DOC_APPROVAL<$include add_idc_token_to_url$>&dDocName=<$#active.dDocName$>">
									<$endif$>
									
									<$#active.dDocName$>
									
									<$if not #active.isCompact$>
									</a>
									<$endif$>
								</td>
								<td><$#active.xSource$>&nbsp;</td>
								<td><$#active.xDocumentClass$></td>
								<td><$if #active.xAccountNumber$><$#active.xAccountNumber$><$else$>&nbsp;<$endif$></td>
								
								<td>
									<$if #active.xAmount$><$#active.xAmount$><$else$>&nbsp;<$endif$>
								</td>
								
								<td>
									<$if #active.xUnits$><$#active.xUnits$><$else$>&nbsp;<$endif$>
								</td>
								
								<td>
									<$if #active.xBatchNumber > 0$>
										<$if not #active.isCompact$>
											<a target="_blank" href="?IdcService=IRIS_CLASSIFIED_ITEMS<$include add_idc_token_to_url$>&wfid=<$#active.xBatchNumber$>">
										<$endif$>
										
										<$#active.xBatchNumber$>
										
										<$if not #active.isCompact$>
										</a>
										<$endif$>
									<$else$>
										&nbsp;
									<$endif$>
								</td>
								<td>
									<$if #active.xStatus$>
										<$#active.xStatus$>
									<$else$>
										&nbsp;
									<$endif$>
								</td>
							</tr>
							
						<$endloop$>
					</table>
					
					<$if not #active.isCompact$>
						<$maxDocResultsMsg = ""$>
						
						<$if rsOrganisationDocs.#numRows >= numItems$>
							<$maxDocResultsMsg = " (only the first " & numItems & " are shown)"$>
						<$endif$>
					
						<p>
							<a target="_blank" href="?IdcService=IRIS_CLASSIFIED_ITEMS&adv=true&clientno=<$#local.CLIENT_NUMBER_PADDED$>&company=<$COMPANY_CODE$>">View full <$#active.COMPANY_CODE$> document list in Iris<$maxDocResultsMsg$></a>
						</p>
					<$endif$>
					
				<$endif$>
				
				<br/>

			<$endloop$>			
			
		<$endif$>
	<$endif$>
	
<@end@>

<!-- Lists the most recent documents from the UCM repository, for the current client. -->
<@dynamichtml ccla_cs_display_invoice_document_listing@>
	<$if IsDebug$>ccla_cs_display_invoice_document_listing<$endif$>	
	
	<$if not #local.ORGANISATION_ID$>
		<p class="no-info">No organisation ID for document lookup</p>	
	<$elseif not #local.ORG_ACCOUNT_CODE$>
		<p class="no-info">No Org Account Code for document lookup</p>		
	<$else$>
		
		<$exec rsRemove("rsOrganisationDocs")$>
		
		[[% Prepare doc fetch query for this Client Number/Company combo. %]]
				
		<$numItems=15$>
		
		<$orgDocFetchMethod = "ORG_ACCOUNT_CODE"$>
		<$invoiceDocsOnly = 1$>
		<$executeService("CCLA_CS_GET_RECENT_ORG_DOCS")$>
				
		<$if not rsOrganisationDocs$>
			
			<p class="no-info">No invoice documents found for this organisation</p>
		
		<$else$>
			
			<table width="100%" cellpadding=0 cellspacing=0 class="accounts-table">
				<tr>
					<th class="first-col" width="70">Date</th>
					<th width="90">Content ID</th>
					<th width="80">Source</th>
					<th>Doc class</th>
					<th width="120">Invoice Number</th>
					<th width="80">Gross Amount</th>
					<th>Workflow ID</th>
					<th width=100>Status</th>
				</tr>
			
				<$loop rsOrganisationDocs$>
					
					<tr class="account-details-row">
						<td class="first-col"><$#active.dInDate$></td>
						<td>
							<$if not #active.isCompact$>
								<a target="_blank" href="?IdcService=DOC_APPROVAL&dDocName=<$#active.dDocName$>">
							<$endif$>
							
							<$#active.dDocName$>
							
							<$if not #active.isCompact$>
							</a>
							<$endif$>
						</td>
						<td><$#active.xSource$>&nbsp;</td>
						<td><$#active.xDocumentClass$></td>
						
						<td>
							<$if #active.xUnits$><$#active.xUnits$><$else$>&nbsp;<$endif$>
						</td>						
						
						<td>
							<$if #active.xAmount$><$#active.xAmount$><$else$>&nbsp;<$endif$>
						</td>
						
						<td>
							<$if #active.xBatchNumber > 0$>
								<$if not #active.isCompact$>
									<a target="_blank" href="?IdcService=IRIS_CLASSIFIED_ITEMS<$include add_idc_token_to_url$>&wfid=<$#active.xBatchNumber$>">
								<$endif$>
								
								<$#active.xBatchNumber$>
								
								<$if not #active.isCompact$>
								</a>
								<$endif$>
							<$else$>
								&nbsp;
							<$endif$>
						</td>
						<td>
							<$if #active.xStatus$>
								<$#active.xStatus$>
							<$else$>
								&nbsp;
							<$endif$>
						</td>
					</tr>
					
				<$endloop$>
			</table>
			
			<$if not #active.isCompact$>
				<p>
					<a target="_blank" href="?IdcService=IRIS_CLASSIFIED_ITEMS<$include add_idc_token_to_url$>&adv=true&orgcode=<$#active.ORG_ACCOUNT_CODE$>">View full document list in Iris</a>
				</p>
			<$endif$>
			
		<$endif$>
		
		<br/>

	<$endif$>			
	
<@end@>

<!-- Lists the most recent instructions for the current organisation. -->
<@dynamichtml ccla_cs_display_instruction_listing@>
	<$if IsDebug$>ccla_cs_display_instruction_listing<$endif$>	
	
	<$if isAjax$>
		<!-- Load in instruction data from DB -->
		<$fetchElements="instructions"$>
		
		<$if ORGANISATION_ID$>
			<$executeService("CCLA_CS_GET_ENTITY_DATA")$>
		<$elseif ACCOUNT_ID$>
			<$executeService("CCLA_CS_GET_ACCOUNT_DATA")$>
		<$endif$>
	<$endif$>
	
	<$if not rsInstructions$>
	
		<p class="no-info">None</p>
	
	<$else$>

		<table width="100%" cellpadding=0 cellspacing=0 class="accounts-table">
			<tr>
				<th class="first-col" width="60">ID</th>
				<th>Created</th>
				<th width=120>Type</th>
				<th>Source</th>
				<th width=110>Doc ID</th>
				<th>Acc. no.</th>
				<th width="50">Fund</th>
				<th width="60">WF ID</th>
				<th width=100>Status</th>
			</tr>
		
			<$loop rsInstructions$>
				
				<tr class="account-details-row">
					<td class="first-col">
						<a href="?IdcService=CCLA_CP_INSTRUCTION_INFO<$include add_idc_token_to_url$>&INSTRUCTION_ID=<$#active.INSTRUCTION_ID$>"><$#active.INSTRUCTION_ID$></a>
					</td>
					<td>
						<$#active.DATE_ADDED$>
					</td>
					<td>
						<$#active.INSTRUCTION_TYPE_NAME$>
					</td>
					<td><$#active.COMM_SOURCE_NAME$>&nbsp;</td>
					<td>
						<$thisInstructionDocName = ""$>
						
						<$if #active.DOC_NAME$>
							<$thisInstructionDocName = #active.DOC_NAME$>
						<$elseif #active.INSTRUCTION_DOC_GUID$>	
							<$thisInstructionDocName = strSubstring(#active.INSTRUCTION_DOC_GUID, 0, strIndexOf(#active.INSTRUCTION_DOC_GUID, ":"))$>		
						<$endif$>
							
						<$if thisInstructionDocName$>
							<a href="?IdcService=DOC_APPROVAL<$include add_idc_token_to_url$>&dDocName=<$thisInstructionDocName$>"><$thisInstructionDocName$></a>
						<$endif$>

						&nbsp;
					</td>

					<td>
						<$if #active.ACCOUNT_ID$>
							<$thisAccNum = strLeftFill(#active.ACCOUNTNUMBER, "0", 8)$>
						
							<a href="?IdcService=CCLA_CS_ACCOUNT_INFO<$include add_idc_token_to_url$>&ACCOUNT_ID=<$#active.ACCOUNT_ID$>"><$#local.thisAccNum$></a>
						<$else$>
							&nbsp;
						<$endif$>
					</td>
					
					<td>
						<$if #active.ACCOUNT_ID$>
							<$#active.FUND_CODE$>
						<$else$>
							&nbsp;
						<$endif$>
					</td>

					<td>
						<$if #active.SPP_BATCH_REF$>
							<a href="?IdcService=IRIS_CLASSIFIED_ITEMS<$include add_idc_token_to_url$>&wfid=<$#active.SPP_BATCH_REF$>"><$#active.SPP_BATCH_REF$></a>
						<$else$>
							&nbsp;
						<$endif$>
					</td>
					<td>
						<$#active.INSTRUCTION_STATUS_NAME$>&nbsp;
					</td>
				</tr>
				
			<$endloop$>
		</table>
	
	<$endif$>
	
	<br/>

	<$if rsInstructions and (rsInstructions.#numRows >= CCLA_CS_MaxInstructionResults)$>
		<$if ORGANISATION_ID$>
			<br/>
			<a href="?IdcService=CCLA_CP_INSTRUCTION_LISTING<$include add_idc_token_to_url$>&orgCode=<$#local.ORG_ACCOUNT_CODE$>">View all instructions for this organisation</a>
			<br/>
		<$endif$>
			
		<$if ACCOUNT_ID$>
			<br/>
			<a href="?IdcService=CCLA_CP_INSTRUCTION_LISTING<$include add_idc_token_to_url$>&clientNumber=<$#local.clientNumber$>&fundCode=<$#local.fundCode$>&accNo=<$#local.accountNumber$>">View all instructions for this account</a>
			<br/>
		<$endif$>
	<$endif$>

<@end@>

<@dynamichtml ccla_cs_add_question_link@>
	
	<$if IdcService like "CCLA_CS_CLIENT_LOOKUP"$>
		
		<div style="text-align: right">
			<a 	href="#" 
				onclick="addCorrespondentQuestion()">Record questions...</a>
		</div>
		
		<script type="text/javascript">
			
			function addCorrespondentQuestion() {
				
				var processId 		= "<$#local.processId$>";
				var personId		= "<$#local.personId$>";
				var company			= "<$#local.company$>";
				
				if (personId == "") {
					// assume this is the first page, and a correspondent hasn't been selected yet.
					personId = getSelectedCorrespondent();
					
					if (personId == "") {
						alert("Please select a correspondent before recording a question.");
						return;
					}
				}
				
				// Open the Add Question popup
				window.open("<$HttpCgiPath$>?IdcService=CCLA_CS_ADD_CORRESPONDENT_QUESTION<$include add_idc_token_to_url$>&processId=" 
				 + processId + "&company=" + company + "&correspondentId=" + personId,
				 "questionWindow","toolbar=0,location=0,menubar=0,height=340,width=530");
			}
			
		</script>
		
	<$else$>
	
		<div style="text-align: right">
			<a 	href="#" 
				onclick="window.open('<$HttpCgiPath$>?IdcService=CCLA_CS_ADD_CORRESPONDENT_QUESTION<$include add_idc_token_to_url$>&processId=<$#local.processId$><$if personId$>&company=COIF&personId=<$#local.personId$><$endif$>','questionWindow','toolbar=0,location=0,menubar=0,height=340,width=530');">Record questions...</a>
		</div>
		
	<$endif$>
	
<@end@>

<@dynamichtml ccla_cs_display_listed_correspondent_query_details@>
	
	<$#active.COR_Code$>

	<br/>
	<b><$#active.COR_Name$></b>
		<$personId = #active.COR_Code$>
		<$executeService("CCLA_CS_GET_ACTIVITIES_BY_PERSON")$>
		<$if rsPersonActivities$>
			<br/>
			
			<$numActivities = getValue("rsPersonActivities","#numRows")$>
			
			<$if numActivities == 1$>
				<a href=""><$numActivities$> previous activity</a>
			<$else$>
				<a href=""><$numActivities$> previous activities</a>
			<$endif$>
		<$endif$>
	<br/>
	<br/>
	<$include ccla_cs_display_query_address$>
	
<@end@>
	
<@dynamichtml ccla_cs_display_listed_correspondent_details@>
	
	<$#active.code$>
	
	<br/>
	<b><$#active.name$></b>
	
	<$curPersonId = #local.personId$>
	
	<$personId = #active.code$>
	<$executeService("CCLA_CS_GET_ACTIVITIES_BY_PERSON")$>
	<br/>
	
	<$if rsPersonActivities$>
		<$numActivities = getValue("rsPersonActivities","#numRows")$>
		<$prevActivitiesLink = 	"window.open('" 
								& HttpCgiPath & "?IdcService=CCLA_CS_REVIEW_PERSON_ACTIVITIES" & inc('add_idc_token_to_url') & "&personId=" & personId & "&company=COIF"
								& "','prevActivities','width=730,height=400,toolbar=no,address=no');return false;"$>
		
		<$if numActivities == 1$>
			<a href="#" onclick="<$prevActivitiesLink$>"><$numActivities$> previous activity</a>
		<$else$>
			<a href="#" onclick="<$prevActivitiesLink$>"><$numActivities$> previous activities</a>
		<$endif$>
		
		|
	<$endif$>
	
	<a target="_blank" href="<$HttpCgiPath$>?IdcService=CCLA_CS_REVIEW_FUND_TRANSFERS<$include add_idc_token_to_url$>&personId=<$personId$>&company=COIF&processName=COIF New Fund Launch">Review transfers</a>
	<br/>
	<br/>
	
	<$include ccla_cs_display_aurora_address$>
	
	<$personId = curPersonId$>
	
<@end@>


<@dynamichtml ccla_cs_display_listed_person_details@>
	
	<a 	href="<$HttpCgiPath$>?IdcService=CCLA_CS_PERSON_INFO<$include add_idc_token_to_url$>&personId=<$#active.PERSON_ID$>"
		title="Click to view full person info (opens in new window)"
		target="_blank"><$#active.PERSON_ID$></a>
	
	<br/>
	<b><$if #active.FULL_NAME$>
			<$#active.FULL_NAME$>
		<$else$>
			<$#active.KNOWNAS$>
		<$endif$>
		</b>
	
	<br/><br/>
	
	<$if false$>
		<$curPersonId = #local.personId$>
		
		<$personId = #active.code$>
		<$executeService("CCLA_CS_GET_ACTIVITIES_BY_PERSON")$>
		
		<br/>
		
		<$if rsPersonActivities$>
			<$numActivities = getValue("rsPersonActivities","#numRows")$>
			<$prevActivitiesLink = 	"window.open('" 
									& HttpCgiPath & "?IdcService=CCLA_CS_REVIEW_PERSON_ACTIVITIES" & inc('add_idc_token_to_url') & "&personId=" & personId & "&company=COIF"
									& "','prevActivities','width=730,height=400,toolbar=no,address=no');return false;"$>
			
			<$if numActivities == 1$>
				<a href="#" onclick="<$prevActivitiesLink$>"><$numActivities$> previous activity</a>
			<$else$>
				<a href="#" onclick="<$prevActivitiesLink$>"><$numActivities$> previous activities</a>
			<$endif$>

		<$endif$>
		<$personId = curPersonId$>
	<$endif$>
	
	<$include ccla_cs_display_listed_contact_details$>
		
	
	
<@end@>

<!-- Displays the Aurora address fields for the current row of the active
	 ResultSet.
	 This include must be placed inside a loop statement for the ResultSet
	 you wish to display. -->
<@dynamichtml ccla_cs_display_aurora_address@>
	
	<$addressFields = "organisation,building,thoroughFare,street,town,locality,county,country,postCode,telephone,email,fax"$>
	<$exec rsMakeFromString("rsAddressFields",addressFields,"fieldName")$>
									
	<$loop rsAddressFields$>
		<$thisValue = getValue("#active",#active.fieldName)$>
		
		<$if #active.fieldName like "telephone"$>
			<br/>
		<$endif$>
		
		<$if thisValue$>
			<$if #active.fieldName like "telephone"$>
				<b>Tel:</b> 
			<$elseif #active.fieldName like "fax"$>
				<b>Fax:</b>
			<$elseif #active.fieldName like "email"$>
				<b>Email:</b>
			<$endif$>
			
			<$thisValue$><br/>
		<$endif$>
		
	<$endloop$>
	
<@end@>

<!-- Displays the address fields for the current row of the active
	 ResultSet.
	 This include must be placed inside a loop statement for the ResultSet
	 you wish to display. -->
<@dynamichtml ccla_cs_display_contact_details@>
<$if IsDebug$>ccla_cs_display_contact_details<$endif$>
	<table class="cs-info-table" width="100%">
		<tr>
			<th width="20%" rowspan=2>Address:</th>
			<td width="30%" rowspan=2>
				<$include ccla_cs_display_address$>
			</td>
			
			<th>Tel:</th>
			<td><$#active.ADDR_PHONE$></td>
			
		</tr>
		<tr>
			<th>Fax:</th>
			<td><$#active.ADDR_FAX$></td>
		</tr>

	</table>
	
<@end@>

<@dynamichtml ccla_cs_display_listed_contact_details@>

	<$include ccla_cs_display_address$>
	<br/>
	
	<b>Tel:</b> <$#active.ADDR_PHONE$>
	<br/>
	<b>Fax:</b> <$#active.ADDR_FAX$>

	
<@end@>

<!-- Displays an address from the AuroraCOIF provider. -->
<@dynamichtml ccla_cs_display_query_address@>
	
	<$addressFieldSuffixes = "Organisation,Building,Thoroughfare,Depdendent_Locality,PostTown,County,PostCode,Country"$>
	<$exec rsMakeFromString("rsAddressFields",addressFieldSuffixes,"fieldName")$>
									
	<$loop rsAddressFields$>
		<$thisValue = getValue("#active","COR_" & #active.fieldName)$>
		
		<$if thisValue$>
			<$thisValue$><br/>
		<$endif$>
		
	<$endloop$>
	
	<br/>
	
	<b>Tel:</b> <$#active.COR_Telephone$>
	<br/>
	<b>Fax:</b> <$#active.COR_FAX$>
	<br/>
	<b>Email:</b> <$#active.COR_Email$>
	
<@end@>

<!--	Used when entering accounts in Manual Data Entry mode.

		Determine the number of submitted accounts by searching for
		client IDs in the form 'clientId_X', where X is an incrementing
		integer. The first time the lookup fails, we can infer that there
		were (X-1) submitted accounts. -->
<@dynamichtml ccla_cs_resolve_num_accounts@>
	
	<$numAccountsToTransfer = 0$>		
			
	<$loopwhile not resolvedNumAccounts$>
		<$thisClient = getValue("#local","clientId_" & (numAccountsToTransfer+1))$>
		
		<$if not thisClient$>
			<$resolvedNumAccounts = 1$>
		<$else$>
			<$numAccountsToTransfer = numAccountsToTransfer + 1$>
		<$endif$>
	<$endloop$>

<@end@>

<!-- Displays details for the current activity/process. -->
<@dynamichtml ccla_cs_activity_details@>

	<$include orangeContainer_top$>

	<div class='ccla_cs_panel_header'>
		Activity details
	</div>

	<script type="text/javascript">
			
		function terminateActivity() {
			var frm = document.forms["terminateActivityForm"];
			
			var outcome = frm.elements["activityOutcome"].value;
			
			if (outcome == "") {
				alert("You must specify a reason for terminating this activity.");
				frm.elements["activityOutcome"].focus();
			} else {
				
				if (confirm("Are you sure you wish to terminate this activity?"))
					frm.submit();
			}
		}
		
	</script>
	
	<div class='ccla_cs_panel_content'>
		<table width="100%" cellpadding=0 cellspacing=2>
			<$loop rsActivity$>
				<tr>
					<td width=15%><b>Activity ID</b></td>
					<td width=35%><$#active.ACTIVITY_ID$></td>
					
					<td width=20%><b>Activity type</b></td>
					<td width=30%><$#active.ACTIVITY_TYPE$></td>
				</tr>
			<$endloop$>
			
			<$loop rsProcess$>
				<tr>
					<td><b>Process ID</b></td>
					<td><$#active.PROCESS_ID$></td>
					
					<td><b>Process status</b></td>
					<td><$#active.PROCESS_STATUS$></td>
				</tr>
				</tr>
				
				<$if IdcService like "CCLA_CS_SET_FUND_TRANSFERS_COMPLETED"$>
					<tr>
						<td><br/></td>
					</tr>
				<$else$>
					<tr>
						<td><b>Terminate</b>
						</td>
						<td colspan=3>
							<form name="terminateActivityForm" id="terminateActivityForm" method="POST">
								<input type="hidden" name="IdcService" 	value="CCLA_CS_RESOLVE_ACTIVITY_SUBMIT" /><$include add_idc_token_to_form$>
								<input type="hidden" name="RedirectUrl"	value="<$HttpCgiPath$>?IdcService=CCLA_CS_CLIENT_LOOKUP<$include add_idc_token_to_url$>&completed=1" />
							
								<input type="hidden" name="processId"	value="<$#active.PROCESS_ID$>" />
								<input type="hidden" name="processName" value="<$#active.PROCESS_NAME$>" />
							
								<input type="hidden" name="activityId" 	value="<$#local.activityId$>" />
								<input type="hidden" name="personId" 	value="<$#local.personId$>" />
								
								<$exec rsMakeFromString("rsOutcomes",#env.CCLA_CS_CompletedActivityOutcomes,"outcome")$>
								
								<select name="activityOutcome" id="terminate-activity">
									<option value=""></option>
									
									<$loop rsOutcomes$>
										<$if not (#active.outcome like "Completed")$>
											<option value="<$#active.outcome$>"><$#active.outcome$></option>
										<$endif$>
									<$endloop$>
								</select>
								
								<input type="button" name="submitType" value="Go" onclick="terminateActivity()" />
							</form>
						</td>
					</tr>

				<$endif$>
				
			<$endloop$>
		</table>
		
		<$include ccla_cs_add_question_link$>
	</div>
	
	<$include orangeContainer_bottom$>
	
	<br/>
	
<@end@>

<!-- Displays questions previously asked by the correspondent -->
<@dynamichtml ccla_cs_correspondent_questions@>
	
	<$executeService("CCLA_CS_GET_CORRESPONDENT_QUESTIONS")$>
	
	<$if rsCorrespondentQuestions or (IdcService like "CCLA_CS_REVIEW_FUND_TRANSFERS")$>
		<$include orangeContainer_top$>

		<div class='ccla_cs_panel_header'>
			Correspondent questions
		</div>

		<div class='ccla_cs_panel_content'>
			
			<$if not rsCorrespondentQuestions$>
				<p>There are no questions logged for this correspondent.</p>
			<$else$>
				<table width="100%" cellpadding=0 cellspacing=0 class="accounts-table">
					<tr>
						<th class="first-col" width="160">Date</th>
						<th>Details</th>
						<th width="160">Outcome</th>
					</tr>
					
					<$loop rsCorrespondentQuestions$>
						<tr class="account-details-row">
							<td valign="top"class="first-col">
								<$#active.QUESTION_DATE$>
							</td>
							<td valign="top">
								<b>Question:</b> <$#active.QUESTION_TEXT$>
								
								<br/>
								<br/>
								
								<b>Answer given:</b> <$if #active.QUESTION_ANSWER$><$#active.QUESTION_ANSWER$><$else$>N/A<$endif$>
								
								<br/>
								<br/>
							</td>
							<td valign="top">
								<$#active.QUESTION_OUTCOME$>
							</td>
						</tr>
					<$endloop$>
				</table>
			<$endif$>
			
		</div>
		
		<$include orangeContainer_bottom$>
		
		<br/>
	<$endif$>
	
<@end@>

<!-- Displays details for previous activities associated with the current process. -->
<@dynamichtml ccla_cs_previous_activity_details@>

	<$executeService("CCLA_CS_GET_ACTIVITIES_BY_PROCESS")$>
	
	<$if (rsProcessActivities and (getValue("rsProcessActivities","#numRows") > 1)) or (IdcService like "CCLA_CS_REVIEW_FUND_TRANSFERS")$>
		<$include orangeContainer_top$>

		<div class='ccla_cs_panel_header'>
			<$if (IdcService like "CCLA_CS_REVIEW_FUND_TRANSFERS")$>
				Correspondent activities
			<$else$>
				Previous correspondent activities
			<$endif$>
		</div>

		<div class='ccla_cs_panel_content'>
		
			<$if not rsActivities$>
				
				<p>No previous activities logged to this process.</p>
				
			<$else$>
			
				<table width="100%" cellpadding=0 cellspacing=0 class="accounts-table">
					<tr>
						<th class="first-col">User</th>
						<th>Activity type</th>
						<th>Date</th>
						<th>Action</th>
						<th>Outcome</th>
					</tr>
				
					<$loop rsActivities$>
						<$if not (#active.ACTIVITY_ID like #local.activityId)$>
							<tr class="account-details-row">
								<td class="first-col"><$#active.USER_ID$></td>
								<td><$#active.ACTIVITY_TYPE$></td>
								<td><$#active.ACTIVITY_DATE$></td>
								<td><$if #active.ACTIVITY_ACTION$><$#active.ACTIVITY_ACTION$><$else$>&nbsp;<$endif$></td>
								<td>
									<$include ccla_cs_display_activity_outcome$>
								</td>
							</tr>
						<$endif$>
					<$endloop$>
				</table>
			
			<$endif$>
			
		</div>
		
		<$include orangeContainer_bottom$>
		
		<br/>
	<$endif$>
	
<@end@>

<!-- Shows a list of the last 10 activities, for all users and correspondents.

	 The correspondent ID links to the Review Transfers page for that correspondent. -->
<@dynamichtml ccla_cs_recent_activities@>

	<$include orangeContainer_top$>

	<div class='ccla_cs_panel_header'>
		Recent activities
	</div>

	<div class='ccla_cs_panel_content'>
		
		<$executeService("CCLA_CS_GET_RECENT_ACTIVITIES")$>
		
		<$if not rsRecentActivities$>
			<p>There has been no recent activity.</p>
		<$else$>
			
			<table width="100%" cellpadding=0 cellspacing=0 class="accounts-table">
				<tr>
					<th class="first-col">Activity type</th>
					<th>Client</th>
					<th>Corr.</th>
					<th>Campaign</th>
					<th>User</th>
					<th>Date</th>
					<th>Action</th>
					<th>Outcome</th>
				</tr>
				
				<$loop rsRecentActivities$>
					<tr class="account-details-row">
						<td class="first-col"><$#active.ACTIVITY_TYPE$></td>
						<td><$if #active.CLIENT_ID$><$strLeftFill(#active.CLIENT_ID,"0",5)$><$endif$></td>
						<td>
							<a 	target="_blank" 
								href="<$HttpCgiPath$>?IdcService=CCLA_CS_REVIEW_FUND_TRANSFERS<$include add_idc_token_to_url$>&personId=<$#active.PERSON_ID$>&processName=<$#active.PROCESS_NAME$>&company=COIF"><$#active.PERSON_ID$></a>
							
						</td>
						<td><$#active.CAMPAIGN_NAME$></td>
						<td><$#active.USER_ID$></td>
						<td><$#active.ACTIVITY_DATE$></td>
						<td><$if #active.ACTIVITY_ACTION$><$#active.ACTIVITY_ACTION$><$else$>&nbsp;<$endif$></td>
						<td><$include ccla_cs_display_activity_outcome$></td>
					</tr>
				<$endloop$>
				
			</table>
			
		<$endif$>
		
	</div>
	
	<$include orangeContainer_bottom$>

<@end@>

<!-- Used to display embedded dDocNames in Activity Outcome text as links to Iris. -->
<@dynamichtml ccla_cs_display_activity_outcome@>

	<$docNameIndex = strIndexOf(#active.ACTIVITY_OUTCOME, "@DOCNAME:")$>
	<$if docNameIndex > -1$>
		<$outcomeBody	= strSubstring(#active.ACTIVITY_OUTCOME, 0, docNameIndex)$>
		
		<$docName 		= strSubstring(#active.ACTIVITY_OUTCOME, (docNameIndex + 9))$>
		<$endOfDocName	= strIndexOf(docName, "@")$>
		
		<$docName		= strSubstring(docName, 0, endOfDocName)$>
		<a href="<$HttpCgiPath$>?IdcService=DOC_APPROVAL<$include add_idc_token_to_url$>&dDocName=<$docName$>"><$outcomeBody$></a>
		
	<$else$>
		<$if #active.ACTIVITY_OUTCOME$><$#active.ACTIVITY_OUTCOME$><$else$>&nbsp;<$endif$>
	<$endif$>

<@end@>

<@dynamichtml ccla_cs_display_activity_type@>
	<$#active.ACTIVITY_ACTION$>
<@end@>

<@dynamichtml ccla_cs_display_client_status@>
	<$#active.CLIENT_STATUS$>
<@end@>

<@dynamichtml ccla_cs_activity_type_filter@>
	<!--
	<input type="text" id="acttype" name="acttype" value="<$#local.acttype$>" >
	
	<select id="acttype" name="acttype" onchange="document.forms['SEARCHFILTER'].submit();" class="sfSelect" title="Last activity filter">
		
		<$exec rsMakeFromString("rsActivityTypes",#env.CCLA_CS_CommActivityTypes & ",Form Generation,Form Print" ,"actType")$>
		
		<option value=""></option>
		
		<$loop rsActivityTypes$>
			<option value="<$#active.actType$>" <$if #local.acttype like #active.actType$>selected="selected"<$endif$>><$#active.actType$></option>
		<$endloop$>
	
	</select>
	-->
<@end@>

<@dynamichtml ccla_cs_review_transfers_link@>

	<a 	title="Click to see full correspondent process info" target="_BLANK"
		href="<$HttpCgiPath$>?IdcService=CCLA_CS_REVIEW_FUND_TRANSFERS<$include add_idc_token_to_url$>&processName=<$#active.CAMPAIGN_NAME$>&personId=<$#active.PERSON_ID$>&company=<$#active.COMPANY$>"><$#active.PERSON_ID$></a>

<@end@>

<@dynamichtml ccla_cs_process_last_action_date_display@>
	
	<$#active.LAST_ACTION$>
	
<@end@>

<@dynamichtml ccla_cs_display_activity_date@>
	
	<$#active.ACTIVITY_DATE$>
	
<@end@>


<!-- List of available process actions on Process Listing screen -->
<@dynamichtml ccla_cs_process_actions@>
	
	<input 	type="button" value="Gen. &amp; print form" <$if not #env.AURORA_EnableFormPrinting$>disabled="disabled"<$endif$>
			onclick='generateAndPrintForm("<$#active.PROCESS_ID$>","<$#active.ACTIVITY_TYPE$>");' />
	
<@end@>

<!--	Builds a list of URL attributes which captures the state of
		the DOC_LISTING page -->
<@dynamichtml ccla_cs_get_sf_url_params@>

	<$exec rsMakeFromString("sfParams","processName,lastAction,lastActivity,SortField,so","param")$>
	<$sfparamstring = ""$>
	
	<$loop sfParams$>
		<$thisValue = getValue("#local",#active.param)$>
		
		<$if thisValue$>
			<$sfparamstring = sfparamstring & "&" & #active.param & "=" & thisValue$>
		<$endif$>
	<$endloop$>

<@end@>

<@dynamichtml ccla_cs_correspondant_communications_panel@>
	<script type="text/javascript">
		
		function addCsComms(correspondantId){
			var objCommText = document.getElementById('commText').value;
			
			var maxLength = 4000;
			
			if(objCommText.length > maxLength){
				var excess = objCommText.length - maxLength;
				alert('There is a maximum of 4000 characters per log. Your text is ' + 
					excess + ' characters over this limit. \n ' + 
					'Please reduce the length of your text, or split your log into 2 logs.');
			}else{
				$.post(
					'<$HttpCgiPath$>'
					, 
					$('#add_cs_comms_form_' + correspondantId).serialize()
					,
					function(data){
						refreshCsComms(correspondantId);
					}
				);
			}
		}
		
		function refreshCsComms(correspondantId){
			var url = '?IdcService=CCLA_CS_GET_INCLUDE<$include add_idc_token_to_url$>&incName=ccla_cs_correspondant_comms_table&CORRESPONDENT_ID=' + correspondantId;
			
			var d = new Date();
			
			$.post(
				url + '&rt=' + d.getTime(),
				function(rtnHtml){
					$('#ccla_cs_comms_panel_' + correspondantId).html(rtnHtml);
			});
		}
	</script>

	<$include orangeContainer_top$>
	
	<div class='ccla_cs_panel_header'>
		Communication Log (<$CORRESPONDENT_ID$><$if strLength(#active.CORRESPONDENT_NAME)>0$> - <$CORRESPONDENT_NAME$><$endif$>)
	</div>
	
	<div class='ccla_cs_panel_content'>
		<div id="ccla_cs_comms_panel_<$CORRESPONDENT_ID$>">
			<$include ccla_cs_correspondant_comms_table$>
		</div>
		
		<$if isTrue(allowLogAdd)$>
		<br/>
		
		<h3 class="ccla_data_panel_header">Add new communication log</h3>
		
		<form method="post" id="add_cs_comms_form_<$CORRESPONDENT_ID$>">
			<input type="hidden" name="IdcService" 			value="CCLA_CS_COMMS_ADD"/><$include add_idc_token_to_form$>
			<input type="hidden" name="CORRESPONDENT_ID"	value="<$CORRESPONDENT_ID$>"/>
			<input type="hidden" name="USER_ID"				value="<$dUser$>"/>
			<input type="hidden" name="COMM_DATE" 			value="<$dateCurrent()$>"/>
			<input type="hidden" name="COMM_TYPE" 			value=""/>
			
			<textarea name="COMM_TEXT" id="commText" style="width:99%;font-family:Arial;" rows="5"></textarea>
			<br/>
			<div style="float:right;">
				(4000 characters maximum per log)&nbsp;
				<input type="button" onclick="addCsComms('<$CORRESPONDENT_ID$>');" value="Add" style="margin-right:10px;"/>
			</div>
			
		</form>
		<br/><br/>
		<$endif$>
	</div>
	
	<$include orangeContainer_bottom$>
<@end@>

<@dynamichtml ccla_cs_correspondant_comms_table@>

	<$executeService("CCLA_CS_COMMS_GET")$>
	<$if rsComms and rsComms.#numRows > 0$>
		
		<table width="100%" cellpadding=0 cellspacing="0" class="accounts-table">
			<tr>
				<th class="first-col">User</th>
				<th>Date Added</th>
				<th>Communication Log (<$rsComms.#numRows$> in total)</th>
			</tr>
			
			<$loop rsComms$>
				<tr class="account-details-row">
					<td class="first-col" width="120px" style="vertical-align:top;"><$rsComms.USER_ID$>&nbsp;</td>
					<td width="115px" style="vertical-align:top;"><$rsComms.COMM_DATE$>&nbsp;</td>
					<td style="vertical-align:top;"><$strReplace(rsComms.COMM_TEXT,"\n", "<br/>")$>&nbsp;</td>
				</tr>
			<$endloop$>
		</table>
	<$else$>
		<strong>No previous communication</strong>
		<br/>
	<$endif$>
		
<@end@>

<!-- Displays the campaign target selection list. This can be a list of clients
	 or people, depending on the value of the campaignTarget variable.
	 -->
<@dynamichtml ccla_cs_campaign_target_selection@>
	
	<$include orangeContainer_top$>
	
		<!-- Title for the user profile: displays the dDocName for this item -->
		<div class='ccla_cs_panel_header'>
			<$if campaignTarget like "client"$>
				Organisation Listing
			<$elseif campaignTarget like "person"$>
				Person Listing
			<$else$>
				[Unknown campaign target: <$#local.campaignTarget$>]
			<$endif$>
		</div>
	
		<div class='ccla_cs_panel_content'>
			
			<$if campaignTarget like "client"$>
				<$include ccla_cs_campaign_client_selection$>
			<$else$>
				Unsupported campaign target: <$#local.campaignTarget$>
			<$endif$>
			
		</div>
	
	<$include orangeContainer_bottom$>

<@end@>

<@dynamichtml ccla_cs_campaign_client_selection@>
	
	<$if campaignId == 2$>
		<$include ccla_cs_aml_campaign_client_selection_pre$>
	<$else$>
		<$include ccla_cs_campaign_client_selection_pre$>
	<$endif$>
	
	<$include ecsSearchAndFilter$>
					
	<script type="text/javascript">
		
		/* Executed after the user clicks the 'Start process for selected clients'
		   button. Informs them how many processes will be started before
		   completing a hidden form and posting it off to generate the new processes.
		*/
		function confirmEntitySelection(action) {
			
			var selCount = 0;
			
			// Count all ticked checkboxes
			$(".sfCheckbox").each( function() {
				if ($(this).attr("checked"))
					selCount++;
			});
			
			if (selCount == 0) {
				alert("Please select some entities using the tickboxes before continuing.");
			} else {
				var exclude = "";
			
				if (action == "enroll") {
					var c = confirm("You are about to start the <$campaignName$> process for " 
					 + selCount + " entities. Continue?");
					 
				} else {
					// assume 'exclude' action.
					var c = confirm("You are about to exclude " + selCount + " entities from the " +
					"<$campaignName$> campaign. Continue?");
					
					exclude = "&exclude=1";
				}
			
				if (c) {
					openPopup("?IdcService=GET_DOC_PAGE&Action=GetTemplatePage&Page=CCLA_CS_ADD_SELECTED_CLIENTS_TO_CAMPAIGN" +
					 "<$include add_idc_token_to_url$>&campaignId=<$#local.campaignId$>" + exclude);
				}
			}
		}
		
		// Returns a comma-separated string of ORGANISATION_ID values, taken
		// from the ID attributes of the ticked checkboxes.
		//
		// This reflects which organisation checkboxes were ticked on the S&F
		// results table.
		function getSelectedEntities() {
			var entityList = "";
			
			$(".sfCheckbox").each( function() {
				if ($(this).attr("checked")) {
					var checkId = $(this).attr("id").substring(4);
					
					if (entityList.length > 0)
						entityList += ",";
					
					entityList += checkId;
				}
			});
					
			return entityList;
		}
		
		// Deprecated, use getSelectedEntities() instead.
		// Returns a comma-separated string with elements of the form:
		// <client ID>_<company>.
		// This reflects which client checkboxes were ticked on the S&F
		// results table.
		function getSelectedClients() {
			var clientList = "";
			
			$(".sfCheckbox").each( function() {
				if ($(this).attr("checked")) {
					var checkId = $(this).attr("id").substring(4);
					
					if (clientList.length > 0)
						clientList += ",";
					
					clientList += checkId;
				}
			});
					
			return clientList;
		}
		
	</script>		

<@end@>

<!-- Default S&F configuration for client campaign enrolment. This is used if the
	 selected campaign doesn't have a custom target selection config. -->
<@dynamichtml ccla_cs_campaign_client_selection_pre@>
	<$SF_UseDatabaseSearch=1$>

	<$SF_QueryTable="CCLA_ENTITY_CAMPAIGN"$>
	
	<$if not sf$>
		<$sf="ORGANISATION_ID"$>
	<$endif$>
	
	<$include iris_sf_sort_images$>

	<$custTableAttrs="class='IssueBlock' cellpadding='4' cellspacing='1' width='100%' border='0' bgcolor='#F6F6F4'"$>
	<$custColumnHeaderEval="<$if columnCounter==0$> class='sfHeader_start' <$elseif columnCounter >= (totalColumns-1)$> class='sfHeader_end' <$else$> class='sfHeader_mid' <$endif$> height=40 cellpadding=1"$>

	<$calendarSelectFields="DATE_ACCOUNT_OPENED_COL,DATE_ACCOUNT_OPENED_ADV_COL"$>
	<$include epoch_calendar_header$>
	
	<$SF_DISPLAYADVSEARCHLINK="Y"$>
	<$moreAdvSearchFieldList=""$>
	
	<$hideInfoLink="Y"$>

	<$displayPagingOptions="N"$>
	<$displayPaginator="Y"$>
	<$SF_CustomPaginator="iris_sf_paginator"$>
	
	<$SF_CaseInsensitive=1$>
	
	<$customIncludeResultsHeader 	= "ccla_cs_campaign_target_selection_sf_header"$>
	
	<$advSearchBackgroundColour="#FFFFFF"$>
	<$advSearchDisplay_pre='ccla_cs_advsearch_pre'$>
	<$advSearchDisplay_after='ccla_cs_advsearch_after'$>

	<$nodeFilterFieldNames	="CHECKBOX,ORGANISATION_ID_COL,ENTITY_NAME_COL,DATE_ACCOUNT_OPENED_COL,PERSON_ID_COL,PERSON_NAME_COL,CAMPAIGN_ENROLLED_COL"$>
	<$nodeFilterFieldWidth	="1,10,10,25,20,15,20,1"$>
	
	<$advSearchFieldList	="DATE_ACCOUNT_OPENED_ADV_COL,GAP,WEBSITE_URL_COL"$>
	
	<$QueryFieldList		="ORGANISATION_ID_COL,ENTITY_NAME_COL,DATE_ACCOUNT_OPENED_COL,DATE_ACCOUNT_OPENED_ADV_COL,PERSON_ID_COL,PERSON_NAME_COL,CAMPAIGN_ID,WEBSITE_URL_COL"$>	
	
	<$hideLineBreak=1$>
	<$suppressSortLinks="CHECKBOX,CAMPAIGN_ACTIONS"$>
	
	<$PARAMETERSLIST = #active.PARAMETERSLIST & ",campaignId,enrolled"$>
	
	<!-- View column name aliasing -->
	<$SF_CAMPAIGN_ID_idcname="CAMPAIGN_ID"$>
	<$SF_PERSON_ID_COL_idcname="CORRESPONDENT_ID"$>
	<$SF_PERSON_NAME_COL_idcname="CORRESPONDENT_NAME"$>
	
	<$SF_CHECKBOX_caption=""$>
	<$SF_CHECKBOX_type="custom"$>
	<$SF_CHECKBOX_shortname=""$>
	<$SF_CHECKBOX_idcname="x"$>
	<$SF_CHECKBOX_list="none"$>
	
	<$SF_CAMPAIGN_ENROLLED_COL_caption="Enrolled"$>
	<$SF_CAMPAIGN_ENROLLED_COL_type="dropdownlist"$>
	<$SF_CAMPAIGN_ENROLLED_COL_shortname="enrolled"$>
	<$SF_CAMPAIGN_ENROLLED_COL_list="none"$>
	<$SF_CAMPAIGN_ENROLLED_COL_listvalues="No,Yes"$>
	<$SF_CAMPAIGN_ENROLLED_COL_search="date"$>
	
	<$CHECKBOX_CustomIncludeScript				= "ccla_cs_display_client_checkbox"$>
	<$CHECKBOX_CustomFilterScript 				= "ccla_cs_checkbox_filter"$>
	<$ORGANISATION_ID_COL_CustomIncludeScript	= "ccla_cs_display_entity_id"$>
	<$CAMPAIGN_ENROLLED_COL_CustomIncludeScript = "ccla_cs_display_campaign_enrolled"$>
	
	<!-- Pre-set filter parameters. Ensures that only 1 campaign ID is 
		 always added to the filter clauses. -->
	<$if false$>
		<$if enrolled$>
			<$if enrolled like "Yes"$>
				<$nodeSearchQuery = "(CAMPAIGN_ID <matches> `" & campaignId & "`)"$>
			<$else$>
				<$nodeSearchQuery = "(CAMPAIGN_ID <matches> ``)"$>
			<$endif$>
		<$else$>
			<$nodeSearchQuery = "(CAMPAIGN_ID <matches> `" & campaignId & "` <or> CAMPAIGN_ID <matches> ``)"$>
		<$endif$>
	<$endif$>

<@end@>

<!-- Search and Filter display for full Client listing -->
<@dynamichtml ccla_cs_client_sf@>
	
	<$if interactionCompleted$>
		<p class="message_panel info_icon">
			The client communication log was saved successfully.
		</p>
	<$endif$>
	
	<$SF_UseDatabaseSearch=1$>
	
	
	<$SF_QueryTable="CCLA_CLIENTS_CORRESPONDENTS"$>
	
	<$if not sf$>
		<$sf="CLIENT_ID"$>
	<$endif$>
	
	<$include iris_sf_sort_images$>

	<$custTableAttrs="class='IssueBlock' cellpadding='4' cellspacing='1' width='100%' border='0' bgcolor='#F6F6F4'"$>
	<$custColumnHeaderEval="<$if columnCounter==0$> class='sfHeader_start' <$elseif columnCounter >= (totalColumns-1)$> class='sfHeader_end' <$else$> class='sfHeader_mid' <$endif$> height=40 cellpadding=1"$>

	<$calendarSelectFields="DATE_ACCOUNT_OPENED_COL,DATE_ACCOUNT_OPENED_ADV_COL"$>
	<$include epoch_calendar_header$>
	
	<$SF_DISPLAYADVSEARCHLINK="Y"$>
	<$moreAdvSearchFieldList=""$>
	
	<$hideInfoLink="Y"$>
		
	<$displayResetButton="Y"$>	
	<$displayPagingOptions="N"$>
	<$displayPaginator="Y"$>
	<$SF_CustomPaginator="iris_sf_paginator"$>
	
	<$SF_CaseInsensitive=1$>
	
	<$advSearchBackgroundColour="#FFFFFF"$>
	<$advSearchDisplay_pre='ccla_cs_advsearch_pre'$>
	<$advSearchDisplay_after='ccla_cs_advsearch_after'$>

	<$nodeFilterFieldNames	="CHECKBOX,CLIENT_ID_COL,COMPANY_COL,CLIENT_NAME_COL,DATE_ACCOUNT_OPENED_COL,NOMINEE_CLIENT_COL,PERSON_ID_COL,PERSON_NAME_COL,ACTIONS"$>
	<$nodeFilterFieldWidth	="1,7,7,25,10,10,10,20,5"$>
	
	<$advSearchFieldList	="CLIENT_ID_COL,COMPANY_COL,CLIENT_NAME_COL,DATE_ACCOUNT_OPENED_ADV_COL,NOMINEE_CLIENT_COL,PERSON_ID_COL,PERSON_NAME_COL,WEBSITE_URL_COL"$>
	
	<$QueryFieldList		="CLIENT_ID_COL,COMPANY_COL,CLIENT_NAME_COL,DATE_ACCOUNT_OPENED_COL,DATE_ACCOUNT_OPENED_ADV_COL,NOMINEE_CLIENT_COL,PERSON_ID_COL,PERSON_NAME_COL,WEBSITE_URL_COL"$>	
	
	<$hideLineBreak=1$>
	<$suppressSortLinks="CHECKBOX,ACTIONS"$>
	
	<$PARAMETERSLIST = #active.PARAMETERSLIST & ",campaignId,enrolled"$>
	
	<!-- View column name aliasing -->
	<$SF_PERSON_ID_COL_idcname="CORRESPONDENT_ID"$>
	<$SF_PERSON_ID_COL_caption="Corr. ID"$>
	<$SF_PERSON_NAME_COL_idcname="CORRESPONDENT_NAME"$>
	
	<$SF_CHECKBOX_caption=""$>
	<$SF_CHECKBOX_type="custom"$>
	<$SF_CHECKBOX_shortname=""$>
	<$SF_CHECKBOX_idcname="x"$>
	<$SF_CHECKBOX_list="none"$>
	
	<$SF_NOMINEE_CLIENT_COL_caption="Nominee"$>
	<$SF_NOMINEE_CLIENT_COL_type="custom"$>
	<$SF_NOMINEE_CLIENT_COL_shortname="nominee"$>
	<$SF_NOMINEE_CLIENT_COL_list="none"$>
	<$SF_NOMINEE_CLIENT_COL_idcname="NOMINEE_CLIENT"$>
	<$SF_NOMINEE_CLIENT_COL_search="numeric"$>
	
	<$SF_ACTIONS_caption=""$>
	<$SF_ACTIONS_type="none"$>
	<$SF_ACTIONS_shortname=""$>
	<$SF_ACTIONS_list="none"$>
	
	<$CHECKBOX_CustomIncludeScript				= "ccla_cs_display_client_checkbox"$>
	<$CHECKBOX_CustomFilterScript 				= "ccla_cs_checkbox_filter"$>
	
	<$CLIENT_ID_COL_CustomIncludeScript			= "ccla_cs_display_client_id"$>
	
	<$NOMINEE_CLIENT_COL_CustomFilterScript=	"ccla_cs_numeric_boolean_filter"$>
	<$NOMINEE_CLIENT_COL_CustomIncludeScript=	"ccla_cs_numeric_boolean_display"$>
	
	<$ACTIONS_CustomIncludeScript				= "ccla_cs_display_client_actions_menu"$>

	<$include ecsSearchAndFilter$>
	
<@end@>

<@dynamichtml ccla_cs_person_sf@>

	<$SF_UseDatabaseSearch=1$>
	<$SF_QueryTable="CCLA_PERSONS_EXT"$>
	
	<$if not sf$>
		<$sf="PERSON_ID"$>
	<$endif$>
	
	<$include iris_sf_sort_images$>

	<$custTableAttrs="class='IssueBlock' cellpadding='4' cellspacing='1' width='100%' border='0' bgcolor='#F6F6F4'"$>
	<$custColumnHeaderEval="<$if columnCounter==0$> class='sfHeader_start' <$elseif columnCounter >= (totalColumns-1)$> class='sfHeader_end' <$else$> class='sfHeader_mid' <$endif$> height=40 cellpadding=1"$>

	<$calendarSelectFields="DOB_COL,DOB_ADV_COL"$>
	<$include epoch_calendar_header$>
	
	<$SF_DISPLAYADVSEARCHLINK="Y"$>
	<$moreAdvSearchFieldList=""$>
	
	<$hideInfoLink="Y"$>
		
	<$displayResetButton="Y"$>	
	<$displayPagingOptions="N"$>
	<$displayPaginator="Y"$>
	<$SF_CustomPaginator="iris_sf_paginator"$>
	
	<$SF_CaseInsensitive=1$>
	
	<$advSearchBackgroundColour="#FFFFFF"$>
	<$advSearchDisplay_pre='ccla_cs_advsearch_pre'$>
	<$advSearchDisplay_after='ccla_cs_advsearch_after'$>

	<$nodeFilterFieldNames	="CHECKBOX,PERSON_ID_COL,COMPANY_COL,PERSON_NAME_COL,NUM_ACTIVE_ACCOUNTS_COL,DOB_COL,POST_CODE_COL"$>
	<$nodeFilterFieldWidth	="1,10,10,40,10,15,15"$>
	
	<$advSearchFieldList	="PERSON_ID_COL,COMPANY_COL,PERSON_NAME_COL,NUM_ACTIVE_ACCOUNTS_COL,DOB_ADV_COL,POST_CODE_COL"$>
	
	<$QueryFieldList		="PERSON_ID_COL,COMPANY_COL,PERSON_NAME_COL,NUM_ACTIVE_ACCOUNTS_COL,DOB_COL,POST_CODE_COL"$>	
	
	<$hideLineBreak=1$>
	<$suppressSortLinks="CHECKBOX,CAMPAIGN_ACTIONS"$>
	
	<$PARAMETERSLIST = #active.PARAMETERSLIST & ",campaignId,enrolled"$>
	
	<!-- View column name aliasing -->
	<$SF_PERSON_ID_COL_idcname="PERSON_ID"$>
	<$SF_PERSON_ID_COL_search="numeric"$>
	
	<$SF_PERSON_NAME_COL_idcname="FULL_NAME"$>
	<$SF_PERSON_NAME_COL_shortname="personFullName"$>
	<$SF_PERSON_NAME_COL_caption="Name"$>
	
	<$SF_CHECKBOX_caption=""$>
	<$SF_CHECKBOX_type="custom"$>
	<$SF_CHECKBOX_shortname=""$>
	<$SF_CHECKBOX_idcname="x"$>
	<$SF_CHECKBOX_list="none"$>
	
	<$SF_NUM_ACTIVE_ACCOUNTS_COL_caption="No. active accounts"$>
	<$SF_NUM_ACTIVE_ACCOUNTS_COL_type="input"$>
	<$SF_NUM_ACTIVE_ACCOUNTS_COL_shortname="numAccounts"$>
	<$SF_NUM_ACTIVE_ACCOUNTS_COL_list="none"$>
	<$SF_NUM_ACTIVE_ACCOUNTS_COL_idcname="NUM_ACTIVE_ACCOUNTS"$>
	<$SF_NUM_ACTIVE_ACCOUNTS_COL_search="numeric"$>
	
	<$SF_DOB_COL_caption="Date of Birth"$>
	<$SF_DOB_COL_type="input"$>
	<$SF_DOB_COL_shortname="dob"$>
	<$SF_DOB_COL_list="none"$>
	<$SF_DOB_COL_idcname="DATE_OF_BIRTH"$>
	<$SF_DOB_COL_search="date"$>
	
	<$SF_DOB_ADV_COL_caption="Date of Birth"$>
	<$SF_DOB_ADV_COL_type="fromto"$>
	<$SF_DOB_ADV_COL_shortname="dob_adv"$>
	<$SF_DOB_ADV_COL_list="none"$>
	<$SF_DOB_ADV_COL_idcname="DATE_OF_BIRTH"$>
	<$SF_DOB_ADV_COL_search="fromtodate"$>
	
	<$CHECKBOX_CustomIncludeScript				= "ccla_cs_display_client_checkbox"$>
	<$CHECKBOX_CustomFilterScript 				= "ccla_cs_checkbox_filter"$>
	
	<$PERSON_ID_COL_CustomIncludeScript			= "ccla_cs_display_person_id"$>
	
	<$include ecsSearchAndFilter$>

<@end@>

<!-- Client selection S&F configuration for the AML 2010 campaign. -->
<@dynamichtml ccla_cs_aml_campaign_client_selection_pre@>
	
	<p>
		The 'no. accounts' column indicates how many active accounts were opened before December 15th, 2007.
	</p>
	
	<$SF_UseDatabaseSearch=1$>
	<$SF_QueryProvider="CCLA_POOL1"$>
	<$SF_QueryTable="V_CLIENTS_AML_CAMPAIGN"$>
	
	<$if not sf$>
		<$sf="CLIENT_ID"$>
	<$endif$>
	
	<$if not amlcompleted and false$>
		<$amlcompleted = 0$>
	<$endif$>
	
	<$include iris_sf_sort_images$>

	<$custTableAttrs="class='IssueBlock' cellpadding='4' cellspacing='1' width='100%' border='0' bgcolor='#F6F6F4'"$>
	<$custColumnHeaderEval="<$if columnCounter==0$> class='sfHeader_start' <$elseif columnCounter >= (totalColumns-1)$> class='sfHeader_end' <$else$> class='sfHeader_mid' <$endif$> height=40 cellpadding=1"$>

	<$calendarSelectFields="DATE_ACCOUNT_OPENED_COL,DATE_ACCOUNT_OPENED_ADV_COL"$>
	<$include epoch_calendar_header$>
	
	<$SF_DISPLAYADVSEARCHLINK="Y"$>
	<$moreAdvSearchFieldList=""$>
	
	<$hideInfoLink="Y"$>

	<$displayPagingOptions="N"$>
	<$displayPaginator="Y"$>
	<$SF_CustomPaginator="iris_sf_paginator"$>
	
	<$SF_CaseInsensitive=1$>
	
	<$customIncludeResultsHeader 	= "ccla_cs_campaign_target_selection_sf_header"$>
	
	<$advSearchBackgroundColour="#FFFFFF"$>
	<$advSearchDisplay_pre='ccla_cs_advsearch_pre'$>
	<$advSearchDisplay_after='ccla_cs_advsearch_after'$>

	<$nodeFilterFieldNames	="CHECKBOX,CLIENT_ID_COL,COMPANY_COL,CLIENT_NAME_COL,DATE_ACCOUNT_OPENED_COL,NUM_AML_ACCOUNTS_COL,IVS_CHECKED_COL,QRS_CLIENT_COL,BAU_IN_COL,BAU_OUT_COL,ON_HOLD_COL,NOMINEE_CLIENT_COL"$>
	<$nodeFilterFieldWidth	="1,7,7,30,15,10,6,6,6,6,6,6,6"$>
	
	<$advSearchFieldList	="CLIENT_ID_COL,COMPANY_COL,CLIENT_NAME_COL,AML_COMPLETED_COL,IVS_CHECKED_COL,QRS_CLIENT_COL,BAU_IN_COL,BAU_OUT_COL,ON_HOLD_COL,NUM_AML_ACCOUNTS_COL,DATE_ACCOUNT_OPENED_ADV_COL,NOMINEE_CLIENT_COL,WEBSITE_URL_COL"$>
	
	<$QueryFieldList		="CLIENT_ID_COL,COMPANY_COL,CLIENT_NAME_COL,DATE_ACCOUNT_OPENED_COL,DATE_ACCOUNT_OPENED_ADV_COL,CAMPAIGN_ID,NUM_AML_ACCOUNTS_COL,IVS_CHECKED_COL,AML_COMPLETED_COL,QRS_CLIENT_COL,BAU_IN_COL,BAU_OUT_COL,ON_HOLD_COL,NOMINEE_CLIENT_COL,WEBSITE_URL_COL"$>	
	
	<$hideLineBreak=1$>
	<$suppressSortLinks="CHECKBOX,CAMPAIGN_ACTIONS,BAU_IN_COL,IVS_CHECKED_COL,BAU_OUT_COL,ON_HOLD_COL,QRS_CLIENT_COL,AML_COMPLETED_COL"$>
	
	<$PARAMETERSLIST = #active.PARAMETERSLIST & ",campaignId,enrolled,amlAccountFilter"$>
	
	<!-- View column name aliasing -->
	<$SF_CAMPAIGN_ID_idcname="CAMPAIGN_ID"$>
	<$SF_PERSON_ID_COL_idcname="CORRESPONDENT_ID"$>
	<$SF_PERSON_NAME_COL_idcname="CORRESPONDENT_NAME"$>
	
	<$SF_CHECKBOX_caption=""$>
	<$SF_CHECKBOX_type="custom"$>
	<$SF_CHECKBOX_shortname=""$>
	<$SF_CHECKBOX_idcname="x"$>
	<$SF_CHECKBOX_list="none"$>
	
	<$SF_IVS_CHECKED_COL_caption="IVS pre-12/07"$>
	<$SF_IVS_CHECKED_COL_type="custom"$>
	<$SF_IVS_CHECKED_COL_shortname="ivschecked"$>
	<$SF_IVS_CHECKED_COL_list="none"$>
	<$SF_IVS_CHECKED_COL_idcname="CORRESPONDENT_IVS_PRE1207"$>
	<$SF_IVS_CHECKED_COL_search="numeric"$>
	
	<$SF_QRS_CLIENT_COL_caption="QRS Client"$>
	<$SF_QRS_CLIENT_COL_type="custom"$>
	<$SF_QRS_CLIENT_COL_shortname="qrsclient"$>
	<$SF_QRS_CLIENT_COL_list="none"$>
	<$SF_QRS_CLIENT_COL_idcname="CORRESPONDENT_QRS_CLIENT"$>
	<$SF_QRS_CLIENT_COL_search="numeric"$>
	
	<$SF_AML_COMPLETED_COL_caption="AML check completed"$>
	<$SF_AML_COMPLETED_COL_type="custom"$>
	<$SF_AML_COMPLETED_COL_shortname="amlcompleted"$>
	<$SF_AML_COMPLETED_COL_list="none"$>
	<$SF_AML_COMPLETED_COL_idcname="CORRESPONDENT_RESPONDED"$>
	<$SF_AML_COMPLETED_COL_search="numeric"$>
	
	<$SF_BAU_IN_COL_caption="BAU In"$>
	<$SF_BAU_IN_COL_type="custom"$>
	<$SF_BAU_IN_COL_shortname="bauin"$>
	<$SF_BAU_IN_COL_list="none"$>
	<$SF_BAU_IN_COL_idcname="CORRESPONDENT_OVERRIDE"$>
	<$SF_BAU_IN_COL_search="numeric"$>
	
	<$SF_BAU_OUT_COL_caption="BAU Out"$>
	<$SF_BAU_OUT_COL_type="custom"$>
	<$SF_BAU_OUT_COL_shortname="bauout"$>
	<$SF_BAU_OUT_COL_list="none"$>
	<$SF_BAU_OUT_COL_idcname="CORRESPONDENT_REQUESTED"$>
	<$SF_BAU_OUT_COL_search="numeric"$>
	
	<$SF_ON_HOLD_COL_caption="On Hold"$>
	<$SF_ON_HOLD_COL_type="custom"$>
	<$SF_ON_HOLD_COL_shortname="onhold"$>
	<$SF_ON_HOLD_COL_list="none"$>
	<$SF_ON_HOLD_COL_idcname="CORRESPONDENT_ONHOLD"$>
	<$SF_ON_HOLD_COL_search="numeric"$>
	
	<$IVS_CHECKED_COL_CustomFilterScript=		"ccla_cs_numeric_boolean_filter"$>
	<$QRS_CLIENT_COL_CustomFilterScript=		"ccla_cs_numeric_boolean_filter"$>
	<$AML_COMPLETED_COL_CustomFilterScript=		"ccla_cs_numeric_boolean_filter"$>
	<$BAU_IN_COL_CustomFilterScript=			"ccla_cs_numeric_boolean_filter"$>
	<$BAU_OUT_COL_CustomFilterScript=			"ccla_cs_numeric_boolean_filter"$>
	<$ON_HOLD_COL_CustomFilterScript=			"ccla_cs_numeric_boolean_filter"$>
	<$NOMINEE_CLIENT_COL_CustomFilterScript=	"ccla_cs_numeric_boolean_filter"$>
	
	<$IVS_CHECKED_COL_CustomIncludeScript=		"ccla_cs_numeric_boolean_display"$>
	<$QRS_CLIENT_COL_CustomIncludeScript=		"ccla_cs_numeric_boolean_display"$>
	<$AML_COMPLETED_COL_CustomIncludeScript=	"ccla_cs_numeric_boolean_display"$>
	<$BAU_IN_COL_CustomIncludeScript=			"ccla_cs_numeric_boolean_display"$>
	<$BAU_OUT_COL_CustomIncludeScript=			"ccla_cs_numeric_boolean_display"$>
	<$ON_HOLD_COL_CustomIncludeScript=			"ccla_cs_numeric_boolean_display"$>
	<$NOMINEE_CLIENT_COL_CustomIncludeScript=	"ccla_cs_numeric_boolean_display"$>
	
	<$SF_NUM_AML_ACCOUNTS_COL_caption="No. accounts"$>
	<$SF_NUM_AML_ACCOUNTS_COL_type="custom"$>
	<$SF_NUM_AML_ACCOUNTS_COL_shortname="numamlacc"$>
	<$SF_NUM_AML_ACCOUNTS_COL_list="none"$>
	<$SF_NUM_AML_ACCOUNTS_COL_idcname="NUM_AML_ACCOUNTS"$>
	<$SF_NUM_AML_ACCOUNTS_COL_search="numeric"$>
	
	<$NUM_AML_ACCOUNTS_COL_CustomFilterScript="ccla_cs_aml_num_accounts_filter"$>
	<$NUM_AML_ACCOUNTS_COL_CustomIncludeScript=	"ccla_cs_aml_num_accounts_display"$>
	
	<$SF_NOMINEE_CLIENT_COL_caption="Nominee"$>
	<$SF_NOMINEE_CLIENT_COL_type="custom"$>
	<$SF_NOMINEE_CLIENT_COL_shortname="nominee"$>
	<$SF_NOMINEE_CLIENT_COL_list="none"$>
	<$SF_NOMINEE_CLIENT_COL_idcname="NOMINEE_CLIENT"$>
	<$SF_NOMINEE_CLIENT_COL_search="numeric"$>
	
	<$SF_CAMPAIGN_ENROLLED_COL_caption="Enrolled"$>
	<$SF_CAMPAIGN_ENROLLED_COL_type="dropdownlist"$>
	<$SF_CAMPAIGN_ENROLLED_COL_shortname="enrolled"$>
	<$SF_CAMPAIGN_ENROLLED_COL_list="none"$>
	<$SF_CAMPAIGN_ENROLLED_COL_listvalues="No,Yes"$>
	<$SF_CAMPAIGN_ENROLLED_COL_search="date"$>
	
	<$CHECKBOX_CustomIncludeScript				= "ccla_cs_display_client_checkbox"$>
	<$CHECKBOX_CustomFilterScript 				= "ccla_cs_checkbox_filter"$>
	<$CLIENT_ID_COL_CustomIncludeScript			= "ccla_cs_display_client_id"$>
	<$CAMPAIGN_ENROLLED_COL_CustomIncludeScript = "ccla_cs_display_campaign_enrolled"$>
	
	<!-- Pre-set filter parameters. Ensures that only 1 campaign ID is 
		 always added to the filter clauses. -->
	<$if false$>
		<$if enrolled$>
			<$if enrolled like "Yes"$>
				<$nodeSearchQuery = "(CAMPAIGN_ID <matches> `" & campaignId & "`)"$>
			<$else$>
				<$nodeSearchQuery = "(CAMPAIGN_ID <matches> ``)"$>
			<$endif$>
		<$else$>
			<$nodeSearchQuery = "(CAMPAIGN_ID <matches> `" & campaignId & "` <or> CAMPAIGN_ID <matches> ``)"$>
		<$endif$>
	<$endif$>
	
	<$if #local.amlAccountFilter$>
	
		<$if amlAccountFilter like "none"$>
			<$nodeSearchQuery = "(NUM_AML_ACCOUNTS <matches> `0`)"$>
		<$elseif amlAccountFilter like "1orMore"$>
			<$nodeSearchQuery = "(NUM_AML_ACCOUNTS > `0`)"$>
		<$elseif amlAccountFilter like "1to20"$>
			<$nodeSearchQuery = "(NUM_AML_ACCOUNTS > `0`) <and> (NUM_AML_ACCOUNTS <= `20`)"$>
		<$elseif amlAccountFilter like "20plus"$>
			<$nodeSearchQuery = "(NUM_AML_ACCOUNTS > `20`)"$>
		<$endif$>
	<$endif$>
	
<@end@>

<@dynamichtml ccla_cs_advsearch_pre@>

	<div style="background-color: #DAE5E6;">

<@end@>

<@dynamichtml ccla_cs_advsearch_after@>

	</div>

<@end@>

<@dynamichtml ccla_cs_display_is_query_flag@>
	<$if #active.IS_QUERY == 1$>
		Y
	<$else$>
		N
	<$endif$>
<@end@>

<@dynamichtml ccla_cs_interaction_date@>
<$INTERACTION_DATE$>
<@end@>

<@dynamichtml ccla_cs_deadline_date@>
<$if DEADLINE$>
<$if (parseDate(dateCurrent()) >= parseDate(DEADLINE))$><span style="color:red"><strong><$DEADLINE$></strong></span><$else$><$DEADLINE$><$endif$>
<$else$>&nbsp;<$endif$>
<@end@>

<@dynamichtml ccla_cs_updated_date@>
<$LAST_UPDATED$>
<@end@>

<@dynamichtml ccla_cs_display_interaction_outcome@>
	<$if rsFindRowPrimary("rsIncompleteOutcomes",#active.OUTCOME)$>
		<$isIncomplete=1$>
	<$endif$>
	
	<$if #active.isIncomplete$>
		<span class="outcome_highlighted">
	<$endif$>
	
	<$#active.OUTCOME$>
	
	<$if #active.isIncomplete$>
		</span>
	<$endif$>
	
	<$isIncomplete=""$>
<@end@>

<@dynamichtml ccla_cs_assignee_filter@>
	<$assigneeShortName = #active.SF_INTERACTION_ASSIGNEE_COL_shortname$>
	<$assigneeCurrSel = eval("<$#active." & assigneeShortName & "$>")$>
	
	<select name="<$assigneeShortName$>" class="sfSelect" <$if autoSearch$>onchange="document.forms['SEARCHFILTER'].submit();"<$endif$>>
		<$aliasName = "CS_Users"$>
		<$executeService("IRIS_GET_ALIAS_MEMBERS")$>
												
		<option value=""></option>
		<option value="<$dUser$>" <$if strEquals(assigneeCurrSel, dUser)$>selected<$endif$>>Me</option>
		<option value="CS Team" <$if strEquals(assigneeCurrSel, "CS Team")$>selected<$endif$>>CS Team</option>

		<$loop rsAliasMembers$>
			<option value="<$#active.dUserName$>" <$if strEquals(assigneeCurrSel, rsAliasMembers.dUserName)$>selected<$endif$>>
				<$strReplace(#active.dUserName,"CCLA\\","")$>
			</option>
		<$endloop$>
	</select>
<@end@>

<@dynamichtml ccla_cs_assignee_display@>
	<$if #active.ASSIGNEE$>
	<$strReplace(#active.ASSIGNEE,"CCLA\\","")$>
	<$else$>
	&nbsp;
	<$endif$>
<@end@>

<@dynamichtml ccla_cs_user_id_display@>
	<$if #active.USER_ID$>
	<$strReplace(#active.USER_ID,"CCLA\\","")$>
	<$else$>
	&nbsp;
	<$endif$>
<@end@>

<@dynamichtml ccla_cs_display_client_id@>
	
	<$if #active.CLIENT_ID$>
		<a 	title="View client info<$if #active.CLIENT_NAME$>: <$#active.CLIENT_NAME$><$endif$>"
			href="<$HttpCgiPath$>?IdcService=CCLA_CS_CLIENT_INFO<$include add_idc_token_to_url$>&clientId=<$#active.CLIENT_ID$>&company=<$#active.COMPANY$>"><$strLeftFill(#active.CLIENT_ID, "0", 5)$></a>
	<$else$>
		&nbsp;
	<$endif$>
		
<@end@>

<@dynamichtml ccla_cs_display_entity_id@>
<$if IsDebug$>	ccla_cs_display_entity_id<$endif$>
	<$if #active.ORGANISATION_ID$>
		<a 	title="View client info<$if #active.ENTITY_NAME$>: <$#active.ENTITY_NAME$><$endif$>"
			href="<$HttpCgiPath$>?IdcService=CCLA_CS_ENTITY_INFO<$include add_idc_token_to_url$>&ORGANISATION_ID=<$#active.ORGANISATION_ID$>"><$#active.ORGANISATION_ID$></a>
	<$else$>
		&nbsp;
	<$endif$>
		
<@end@>

<@dynamichtml ccla_cs_display_org_account_code@>
<$if IsDebug$>	ccla_cs_display_org_account_code<$endif$>
	<$if #active.ORGANISATION_ID$>
		<a 	title="View organisation info<$if #active.ORGANISATION_NAME$>: <$#active.ORGANISATION_NAME$><$endif$>"
			href="<$HttpCgiPath$>?IdcService=CCLA_CS_ENTITY_INFO<$include add_idc_token_to_url$>&ORGANISATION_ID=<$#active.ORGANISATION_ID$>"><$#active.ORG_ACCOUNT_CODE$></a>
	<$else$>
		&nbsp;
	<$endif$>
		
<@end@>
<@dynamichtml ccla_cs_display_category_code@>
<$if IsDebug$>	ccla_cs_display_category_code<$endif$>
	<$if #active.CATEGORY$>
		<$#active.CATEGORY$>
	<$else$>
		&nbsp;
	<$endif$>
		
<@end@>


<@dynamichtml ccla_cs_display_job_id@>
	<$if #active.JOB_ID$>
		<$JOB_ID$>
	<$else$>
		&nbsp;
	<$endif$>
<@end@>

<@dynamichtml ccla_cs_display_person_id@>
	
	<$if #active.PERSON_ID$>
		<a 	title="View person info<$if #active.FULL_NAME$>: <$#active.FULL_NAME$><$endif$>"
			href="<$HttpCgiPath$>?IdcService=CCLA_CS_PERSON_INFO<$include add_idc_token_to_url$>&PERSON_ID=<$#active.PERSON_ID$>"><$#active.PERSON_ID$></a>
	<$else$>
		&nbsp;
	<$endif$>
	
<@end@>
<@dynamichtml ccla_cs_display_org_acc_code@>
	
	<$if #active.ORGANISATION_ID and #active.ORG_ACCOUNT_CODE$>
		<a 	title="View organisation info<$if #active.ORG_ACCOUNT_CODE$>: <$#active.ORG_ACCOUNT_CODE$><$endif$>"
			href="<$HttpCgiPath$>?IdcService=CCLA_CS_ENTITY_INFO<$include add_idc_token_to_url$>&ORGANISATION_ID=<$#active.ORGANISATION_ID$>"><$if #active.ORG_ACCOUNT_CODE$><$#active.ORG_ACCOUNT_CODE$><$else$>Name not specified<$endif$></a>
	<$else$>
		&nbsp;
	<$endif$>
	
<@end@>
<@dynamichtml ccla_cs_display_person_full_name@>
	
	<$if #active.PERSON_ID$>
		<a 	title="View person info<$if #active.FULL_NAME$>: <$#active.FULL_NAME$><$endif$>"
			href="<$HttpCgiPath$>?IdcService=CCLA_CS_PERSON_INFO<$include add_idc_token_to_url$>&PERSON_ID=<$#active.PERSON_ID$>"><$if #active.FULL_NAME$><$#active.FULL_NAME$><$else$>Name not specified<$endif$></a>
	<$else$>
		&nbsp;
	<$endif$>
	
<@end@>

<@dynamichtml ccla_cs_display_person_account_code@>
	
	<$if #active.PERSON_ACCOUNT_CODE$>
		<a 	title="View person info<$if #active.FULL_NAME$>: <$#active.FULL_NAME$><$endif$>"
			href="<$HttpCgiPath$>?IdcService=CCLA_CS_PERSON_INFO<$include add_idc_token_to_url$>&PERSON_ID=<$#active.PERSON_ID$>"><$#active.PERSON_ACCOUNT_CODE$></a>
	<$else$>
		&nbsp;
	<$endif$>
	
<@end@>

<@dynamichtml ccla_cs_display_process_id@>
	
	<$if #active.PROCESS_ID$>
		<a 	<$if openInNewWin$>target="_blank"<$endif$> 
			href="<$HttpCgiPath$>?IdcService=CCLA_CS_PROCESS_INFO<$include add_idc_token_to_url$>&PROCESS_ID=<$#active.PROCESS_ID$>"><$#active.PROCESS_ID$></a>
	<$else$>
		&nbsp;
	<$endif$>
	
<@end@>

<@dynamichtml ccla_cs_display_enrolment_id@>
	
	<$if #active.PROCESS_ID$>
		<a 	<$if openInNewWin$>target="_blank"<$endif$> 
			href="<$HttpCgiPath$>?IdcService=CCLA_CS_CAMPAIGN_ENROLMENT_INFO<$include add_idc_token_to_url$>&CAMPAIGN_ENROLMENT_ID=<$#active.PROCESS_ID$>&ORGANISATION_ID=<$#active.ORGANISATION_ID$>&CAMPAIGN_ID=<$#active.CAMPAIGN_ID$>&PERSON_ID=<$#active.PERSON_ID$>"><$#active.PROCESS_ID$></a>
	<$else$>
		&nbsp;
	<$endif$>
	
<@end@>


<@dynamichtml ccla_cs_display_campaign_enrolled@>

	<$if #active.CAMPAIGN_ID$>
		Yes
	<$else$>
		No
	<$endif$>

<@end@>

<@dynamichtml ccla_cs_campaign_target_selection_sf_header@>
	
	<p>
		<input 	type="button" name="startCampaignForSelected" value="Start campaign for selected clients"
				onclick="confirmClientSelection('enroll')" />
			
		<input 	type="button" name="excludeCampaignForSelected" value="Exclude clients from campaign"
				onclick="confirmClientSelection('exclude')" />
		
		<input 	type="hidden" name="campaignId" value="<$#local.campaignId$>" />
	</p>
	
<@end@>

<@dynamichtml ccla_cs_checkbox_filter@>

	<input type="checkbox" name="checkAllRows" id="checkAllRows" onclick="toggleCheckAllRows()" />
	
	<script type="text/javascript">
		
		function toggleCheckAllRows() {
			if ($("#checkAllRows").attr("checked"))
				$(".sfCheckbox").attr("checked","checked");
			else
				$(".sfCheckbox").removeAttr("checked");
		}
		
	</script>
	
<@end@>

<@dynamichtml ccla_cs_is_query_filter@>
	<$isQueryShortName = #active.SF_IS_QUERY_COL_shortname$>
	<$isQueryCurrSel = eval("<$#active." & isQueryShortName & "$>")$>
	<select name="<$isQueryShortName$>" class="sfSelect" <$if autoSearch$>onchange="document.forms['SEARCHFILTER'].submit();"<$endif$>>
		<option value=""></option>
		<option value="">(none)</option>
		<option value="1" <$if strEquals(isQueryCurrSel, "1")$>selected<$endif$> >Y</option>
		<option value="0" <$if strEquals(isQueryCurrSel, "0")$>selected<$endif$> >N</option>
	</select>
<@end@>

<!-- Displays selectable list of campaign names for use on a SearchAndFilter page.
	 Performs searches against campaign names, rather than IDs -->
<@dynamichtml ccla_cs_campaign_filter@>
	<select name="campaignName" id="campaignName" class="sfSelect" <$if autoSearch$>onchange="document.forms['SEARCHFILTER'].submit();"<$endif$>>
		<option value=""></option>
	
		<$executeService("CCLA_CS_GET_LEGACY_CAMPAIGNS")$>
		<$loop rsLegacyCampaign$>
			<option value="<$rsLegacyCampaign.NAME$>" <$if #local.campaignName like rsLegacyCampaign.NAME$>selected<$endif$> ><$rsLegacyCampaign.NAME$></option>
		<$endloop$>
	</select>
	
<@end@>

<!-- Displays selectable list of campaign names for use on a SearchAndFilter page.
	 Performs searches against campaign names, rather than IDs -->
<@dynamichtml ccla_cs_new_campaign_filter@>
	
	<select name="campaignName" id="campaignName" class="sfSelect" <$if autoSearch$>onchange="document.forms['SEARCHFILTER'].submit();"<$endif$>>
		<option value=""></option>
	
		<$loop rsCampaigns$>
			<option value="<$#active.CAMPAIGN_NAME$>" <$if #local.campaignName like #active.CAMPAIGN_NAME$>selected<$endif$> ><$#active.CAMPAIGN_NAME$></option>
		<$endloop$>
	</select>
	
<@end@>

<!-- Displays selectable list of campaign names for use on a SearchAndFilter page. -->
<@dynamichtml ccla_cs_campaign_id_filter@>
	<select name="campaignId" id="campaignId" class="sfSelect" <$if autoSearch$>onchange="document.forms['SEARCHFILTER'].submit();"<$endif$>>
		<option value=""></option>
	
		<$executeService("CCLA_CS_GET_LEGACY_CAMPAIGNS")$>
		<$loop rsLegacyCampaign$>
			<option value="<$rsLegacyCampaign.CAMPAIGN_ID$>" <$if #local.campaignId like rsLegacyCampaign.CAMPAIGN_ID$>selected<$endif$> ><$rsLegacyCampaign.NAME$></option>
		<$endloop$>
	</select>
	
<@end@>

<@dynamichtml ccla_cs_new_campaign_id_filter@>
	
	<select name="campaignId" id="campaignId" class="sfSelect" <$if autoSearch$>onchange="document.forms['SEARCHFILTER'].submit();"<$endif$>>
		<option value=""></option>
	
		<$loop rsCampaigns$>
			<option value="<$#active.CAMPAIGN_ID$>" <$if #local.campaignId like #active.CAMPAIGN_ID$>selected<$endif$> ><$getValue("rsCampaigns", "CAMPAIGN_NAME")$></option>
		<$endloop$>
	</select>
	
<@end@>
<@dynamichtml ccla_cs_campaign_id_display@>
	<$#active.CAMPAIGN_NAME$>
<@end@>

<!-- Displays special filter for number of client AML accounts. -->
<@dynamichtml ccla_cs_aml_num_accounts_filter@>
	
	<$sfName = "amlAccountFilter"$>
	
	<select name="<$sfName$>" id="<$sfName$>" class="sfSelect" <$if autoSearch$>onchange="document.forms['SEARCHFILTER'].submit();"<$endif$>>
		<option value=""></option>
		
		<option value="None" <$if getValue("#local", sfName) like "none"$>selected<$endif$> >None</option>
		<option value="1orMore" <$if getValue("#local", sfName) like "1orMore"$>selected<$endif$> >1 or more</option>
		<option value="1to20" <$if getValue("#local", sfName) like "1to20"$>selected<$endif$> >1-20</option>
		<option value="20plus" <$if getValue("#local", sfName) like "20plus"$>selected<$endif$> >20+</option>

	</select>

<@end@>

<@dynamichtml ccla_cs_aml_num_accounts_display@>

	<$#active.NUM_AML_ACCOUNTS$>

<@end@>

<!-- Displays Yes/No selectable options, which correspond to 0/1 numeric values -->
<@dynamichtml ccla_cs_numeric_boolean_filter@>
	
	<select name="<$sfName$>" id="<$sfName$>" class="sfSelect" <$if autoSearch$>onchange="document.forms['SEARCHFILTER'].submit();"<$endif$>>
		<option value=""></option>
		
		<option value="0" <$if getValue("#local", sfName) like "0"$>selected<$endif$> >No</option>
		<option value="1" <$if getValue("#local", sfName) like "1"$>selected<$endif$> >Yes</option>

	</select>
	
<@end@>

<@dynamichtml ccla_cs_numeric_boolean_display@>
	
	<$thisVal = getValue("#active",sfIdcName)$>
	
	<$if thisVal like "1"$>
		Yes
	<$elseif thisVal like "0"$>
		No
	<$endif$>
	
<@end@>

<@dynamichtml ccla_cs_display_client_checkbox@>

	<input 	type="checkbox" 
			name="chk_<$#active.CLIENT_ID$>_<$#active.COMPANY$>" 
			id="chk_<$#active.CLIENT_ID$>_<$#active.COMPANY$>" 
			class="sfCheckbox" />

<@end@>

<@dynamichtml ccla_cs_display_last_action@>

	<$if #active.ACTIVITY_ACTION$>
		<$#active.ACTIVITY_ACTION$>
	<$else$>
		&nbsp;
	<$endif$>

<@end@>

<@dynamichtml ccla_cs_category_filter@>
	<select name="<$#active.SF_INTERACTION_CATEGORY_COL_shortname$>" style="width:220px" onChange="document.forms['SEARCHFILTER'].submit();">
		<option value=""></option>

		<$loop rsInteractionSubjectCategories$>
			<option value="<$#active.CATEGORY$>" 
				<$if strEquals(interactionCat,#active.CATEGORY)$> selected<$endif$>>
				<$#active.CATEGORY$>
			</option>
		<$endloop$>
	</select>
<@end@>

<@dynamichtml ccla_cs_interaction_actions_menu@>
	<a href="?IdcService=CCLA_CS_INTERACTION_EDIT<$include add_idc_token_to_url$>&INTERACTION_ID=<$#active.INTERACTION_ID$>&ORGANISATION_ID=<$#active.ORGANISATION_ID$>&PERSON_ID=<$#active.PERSON_ID$>" 
		title="Update Interaction" 
		style="float:right;">
		<img src="images/ccla/form.png" />
	</a>
<@end@>

<!-- Icon set for client actions, displayed on client listing view -->
<@dynamichtml ccla_cs_display_client_actions_menu@>
	
	<a href="?IdcService=CCLA_CS_CLIENT_INFO<$include add_idc_token_to_url$>&clientId=<$#active.CLIENT_ID$>&company=<$#active.COMPANY$>" title="View client info"><img src="images/ccla/case-file.png" /></a>
	<a href="?IdcService=CCLA_CS_RECORD_COMM<$include add_idc_token_to_url$>&clientId=<$#active.CLIENT_ID$>&company=<$#active.COMPANY$>" title="Log activity/communication"><img src="images/ccla/telephone.png" /></a>
	
	<$if false$>
		<$menu_style_prefix="top"$>
		<$menu_id=#active.CLIENT_ID & "_" & #active.COMPANY$>
		<$actionMenu_CustomInclude="ccla_cs_client_actions_menu"$>

		<$include action_menu$>
	<$endif$>

<@end@>

<@dynamichtml ccla_cs_client_actions_menu@>

	<tr>
		<td class="<$menu_style_prefix$>PopupLink" nowrap onMouseOver="glowPopupRow(this,'<$menu_style_prefix$>PopupLink_over','<$menu_style_prefix$>PopupLink')"	onMouseOut="fadePopupRow(this,'<$menu_style_prefix$>PopupLink')">
			<a 	class="menuLink" 
				href="?IdcService=CCLA_CS_RECORD_COMM<$include add_idc_token_to_url$>&clientId=<$#active.CLIENT_ID$>&company=<$#active.COMPANY$>"><span>Log activity/communication</span></a>
		</td>
	</tr>
	
	<tr>
		<td class="<$menu_style_prefix$>PopupLink" nowrap onMouseOver="glowPopupRow(this,'<$menu_style_prefix$>PopupLink_over','<$menu_style_prefix$>PopupLink')"	onMouseOut="fadePopupRow(this,'<$menu_style_prefix$>PopupLink')">
			<a 	class="menuLink" 
				href="?IdcService=CCLA_CS_CLIENT_INFO<$include add_idc_token_to_url$>&clientId=<$#active.CLIENT_ID$>&company=<$#active.COMPANY$>"><span>Client info</span></a>
		</td>
	</tr>

<@end@>


<!-- Overriden from iriscore_resource.
		 Adds a select element to the doc listing screen
		 to control the types of documents being displayed -->
<@dynamichtml ccla_cs_process_listing_inline_header@>

  <div style="margin-top: 10px">
		&nbsp;
		<input type=checkbox name="showExcluded" <$if showExcluded$>checked=true<$endif$> onclick="toggleShowExcluded(this)">Show excluded members
		<input type="submit" class="submitLink" value="Search" style="margin-left: 10px"/>

			<script type="text/javascript">

				// Show/hide documents with 'Released' status
				function toggleShowExcluded(chk)
				{
					document.forms['SEARCHFILTER'].submit();
				}
		
			</script>
		
	</div>

<@end@>

<!-- Basic client/person info displayed on Interaction Logging
	 page. Designed to be dynamically loaded via AJAX call -->
<@dynamichtml ccla_cs_interaction_info_panel@>
	
	<div class="cs-info-panel">
	
		<$executeService("CCLA_CS_GET_INTERACTION_SUBJECT_INFO")$>
		
		<$if rsEntity$>
			<h3 class="ccla_data_panel_header">
				Organisation
			</h3>
			
			<$loop rsEntity$>
				<$include ccla_cs_display_entity_info$>
			<$endloop$>
			
			<br/>
			<hr/>
			<br/>
		<$endif$>
		<$if rsPerson$>
			
			<h3 class="ccla_data_panel_header">
				Person
			</h3>
			
			<$loop rsPerson$>
				<$include ccla_cs_display_person_info$>
			<$endloop$>
		
		<$elseif personName$>
			
			<h3 class="ccla_data_panel_header">
				Person
			</h3>
			
			<table class="cs-info-table" width="100%">
				<tr>
					<th width="20%">Full name:</th><td><$#local.personName$></td>
				</tr>
				<tr>
					<th width="20%">Role:</th><td><$#local.personRole$></td>
				</tr>
			</table>
				
		<$else$>
			Not enough parameters to fetch person info
		<$endif$>
	
	</div>
	
<@end@>

<@dynamichtml ccla_cs_accounts_panel@>
<$if IsDebug$>ccla_cs_accounts_panel<$endif$>	
	<div class="cs-info-panel">
	
		<$if ORGANISATION_ID$>
			<$executeService("CCLA_CS_GET_CLIENT_ACCOUNTS")$>
			
			<$include ccla_cs_display_accounts_last_update$>
				
			<$if rsAccounts$>
				<$displayAccSummary=1$>
				<$include ccla_cs_display_accounts$>
			<$else$>
				<p class="no-info">
					No registered accounts for this client
				</p>
			<$endif$>
			
		<$elseif PERSON_ID$>
		<$executeService("CCLA_CS_PERSON_INFO")$>
			<$include ccla_cs_display_accounts$>
		<$endif$>
	
	</div>

<@end@>

<!-- Client info, designed to be loaded dynamically via AJAX call. -->
<@dynamichtml ccla_cs_campaigns_panel@>
	
	<div class="cs-info-panel">
		
		<$fetchElements="enrolments"$>
		<$executeService("CCLA_CS_GET_ENTITY_DATA")$>

		<$include ccla_cs_display_client_campaigns$>

	</div>
	
<@end@>


<!-- Client info, designed to be loaded dynamically via AJAX call. -->
<@dynamichtml ccla_cs_client_info_panel@>
	
	<div class="cs-info-panel">
	
		<$if clientId and company$>
			<$executeService("CCLA_CS_CLIENT_INFO")$>
			
			<$loop rsClient$>
				<$include ccla_cs_display_client_info$>
			<$endloop$>
			
			<br/>
			<h3 class="ccla_data_panel_header">
				Accounts
			</h3>
			
			<$include ccla_cs_display_accounts_last_update$>
			
			<$if rsAccounts$>
				<$include ccla_cs_display_accounts$>
			<$else$>
				<p class="no-info">
					No registered accounts for this client
				</p>
			<$endif$>
			
		<$else$>
			Not enough parameters to fetch client info
		<$endif$>
	
	</div>
	
<@end@>

<!-- Displays recent documents tagged with the current client ID. -->
<@dynamichtml ccla_cs_client_docs_panel@>
	
	<div class="cs-info-panel">
		
		<$include ccla_cs_display_document_listing$>
		
	</div>
	
<@end@>

<!-- Person info, designed to be loaded dynamically via AJAX call. -->
<@dynamichtml ccla_cs_person_info_panel@>

	<div class="cs-info-panel">

		<$if personId$>
			<$executeService("CCLA_CS_PERSON_INFO")$>
			
			<$loop rsPerson$>
				<$include ccla_cs_display_person_info$>
			<$endloop$>
			
			<br/>
			<h3 class="ccla_data_panel_header">
				Accounts
			</h3>
			
			<$include ccla_cs_display_accounts_last_update$>
			
			<$if rsAccounts$>
				<$include ccla_cs_display_accounts$>
			
			<$else$>
				<p class="no-info">
					No registered accounts for this client
				</p>
			<$endif$>
		
		<$elseif personName$>
			
			<table class="cs-info-table" width="100%">
				<tr>
					<th width="20%">Full name:</th><td><$#local.personName$></td>
				</tr>
				<tr>
					<th width="20%">Role:</th><td><$#local.personRole$></td>
				</tr>
			</table>
			
		<$else$>
			Not enough parameters to fetch person info
		<$endif$>
	
	</div>
	
<@end@>



<!-- Person info, designed to be loaded dynamically via AJAX call. -->
<@dynamichtml ccla_cs_comms_log_panel@>
	
	<div class="cs-info-panel">
		
		<$if (not #local.filter)$>
			<$if PERSON_ID$>
				<$filter = "person"$>
			<$else$>
				<$filter = "client"$>
			<$endif$>
		<$endif$>
		
		<div class="ccla_data_panel">
		
			<form name="filterForm" id="filterForm" method="POST">
				<input type="radio" name="filter" value="person" class="panel-filter" <$if not PERSON_ID$>disabled="disabled"<$endif$>
						<$if filter like "person"$>checked<$endif$> onclick="filterClicked()" /> Person logs
				<br/>
				<input type="radio" name="filter" value="client" class="panel-filter" <$if not ORGANISATION_ID$>disabled="disabled"<$endif$>
						<$if filter like "client"$>checked<$endif$> onclick="filterClicked()" /> Client logs
			</form>
		
		</div>
		
		<script>
			
			// Changes the filter used for displaying comms logs. Reloads the comms log panel.
			filterClicked = function() {
				var selFilter = $("input[name='filter']:checked");			
				var filterParams = "&filter=" + $(selFilter).val();
				
				loadPanelContent(commLogPanel, getBaseParams() + filterParams);
			};
		
		</script>
		
		<br/>
		
		<$if (filter like "person")$>
			<$executeService("CCLA_CS_GET_PERSON_INTERACTIONS")$>
			
			<$if rsInteractions$>
				<$include ccla_cs_display_interactions$>
			
			<$else$>
				<p class="no-info">No interactions logged for this person</p>
			<$endif$>
		
		<$elseif filter like "client" and ORGANISATION_ID$>
			<$executeService("CCLA_CS_GET_ENTITY_INTERACTIONS")$>
			
			<$if rsInteractions$>
				<$include ccla_cs_display_interactions$>
			
			<$else$>
				<p class="no-info">No interactions logged for this client</p>
			<$endif$>
			
		<$else$>
			Not enough parameters to fetch interactions
		<$endif$>
	
	</div>
	
<@end@>


<!-- Person info, designed to be loaded dynamically via AJAX call. -->
<@dynamichtml ccla_cs_activities_panel@>
	<style type="text/css">
		.ccla-note{
			width:477px !important;
		}
	</style>

	<div class="cs-info-panel">
		
		<$if not #local.filter$>
			<$if #active.INTERACTION_ID$>
				<$filter = "interaction"$>
			<$else$>
				<$filter = "person"$>
			<$endif$>
		<$endif$>
		
		<div style="float: left; width: 30%;">
			<div class="ccla_data_panel" style="height:7em;">
				<form name="filterForm" id="filterForm" style="margin-top:10px" method="POST">
					<input type="radio" name="filter" value="interaction" class="panel-filter" <$if not INTERACTION_ID$>disabled="disabled"<$endif$>
							<$if filter like "interaction"$>checked<$endif$> onclick="filterClicked()" /> Interaction activities
					<br/>
					<input type="radio" name="filter" value="person" class="panel-filter" <$if not PERSON_ID$>disabled="disabled"<$endif$>
							<$if filter like "person"$>checked<$endif$> onclick="filterClicked()" /> Person activities
					<br/>
					<input type="radio" name="filter" value="client" class="panel-filter" <$if not ORGANISATION_ID$>disabled="disabled"<$endif$>
							<$if filter like "client"$>checked<$endif$> onclick="filterClicked()" /> Client activities
				</form>
			</div>
		</div>
		
		<div style="float: left; width: 2%;">&nbsp;</div>
		
		<div style="float: left; width: 68%">
				
			<$if false$>
				<div class="ccla_data_panel" style="height:7em;">
					<form id="newNote" method="POST">
						<input type="hidden" name="IdcService" 		value="CCLA_CS_ADD_ACTIVITY_NOTE" /><$include add_idc_token_to_form$>
						<input type="hidden" name="INTERACTION_ID" 	value="<$#local.INTERACTION_ID$>" />				
						<input type="hidden" name="ORGANISATION_ID"		value="<$#active.ORGANISATION_ID$>" />
						<input type="hidden" name="PERSON_ID" 		value="<$#active.PERSON_ID$>" />
						<input type="hidden" name="ACTIVITY_TYPE" 	value="Note" />
						
						<input type="hidden" name="RedirectUrl" 	value="?IdcService=CCLA_CS_INTERACTION_EDIT<$include add_idc_token_to_url$>&INTERACTION_ID=<$INTERACTION_ID$><$commonParams$>"/>
						
						<textarea name="NOTE" style="width: 99%; height: 3.5em;"></textarea>
						<br/>
						<input type="button" value="Add Note" style="float:right;margin-top:3px;" onClick="addNote();" />
					</form>
				</div>
			<$endif$>
			
		</div>
		
		<div style="clear:both"></div>
		
		<script>
			
			// Changes the filter used for displaying comms logs. Reloads the comms log panel.
			filterClicked = function() {
				var selFilter = $("input[name='filter']:checked");			
				var filterParams = "&filter=" + $(selFilter).val();
				
				loadPanelContent(activitiesPanel, getBaseParams() + filterParams);
			};
		
		</script>
		
		<br/>
		
		
		<$if (filter like "interaction")$>
			<$executeService("CCLA_CS_GET_INTERACTION_ACTIVITIES")$>
			
			<$if rsActivities$>
				<$include ccla_cs_display_activity_listing$>
			
			<$else$>
				<p class="no-info">No activities logged for this interaction</p>
			<$endif$>
		
		<$elseif (filter like "person")$>
			<$executeService("CCLA_CS_GET_PERSON_ACTIVITIES")$>
			
			<$if rsActivities$>
				<$include ccla_cs_display_activity_listing$>
			
			<$else$>
				
				<p class="no-info">No activities logged for this person</p>
			<$endif$>
		
		<$elseif (filter like "client") and #active.ORGANISATION_ID$>
			<$executeService("CCLA_CS_GET_ENTITY_ACTIVITIES")$>
			
			<$if rsActivities$>
				<$include ccla_cs_display_activity_listing$>
			
			<$else$>
				<p class="no-info">No activities logged for this client</p>
			<$endif$>
			
		<$else$>
			Not enough parameters to fetch activity
		<$endif$>
	</div>
	
<@end@>

<!-- Displays a list of accounts associated with a form. -->
<@dynamichtml ccla_cs_form_accounts_list@>
	
	<h3 class="ccla_data_panel_header">Accounts</h3>
	
	<div style="border: 1px inset; padding: 2px; width: 200px; height: 120px; overflow-y: scroll;">
		<table class="ccla-table" width="180">			
			<$if not rsFormAccounts$>
				<tr>
					<td>None</td>
				</tr>
			<$endif$>
			
			<$loop rsFormAccounts$>
				<tr>
					<td width="10%"><$rsFormAccounts.#row+1$>:</td><td class="mono-type"><$#active.ACCNUMEXT$></td>
				</tr>
			<$endloop$>
		</table>
	</div>

<@end@>

<!-- Helper functions to support dynamic HTML panel content. -->
<@dynamichtml ccla_cs_ajax_panel_js@>
	
	<script type="text/javascript">
		
		// An object 'panelMapping' must be defined in a subsequent JavaScript
		// resource for this script to work correctly.
		// It should contain a mapping of tab IDs -> IDOC include names.
		// e.g. a tab with ID 'tab_notes' may have a mapping:
		// 	"notes":	"notes_display_ajax_panel"
		
		var entityId		= "<$#local.ORGANISATION_ID$>";
		var personId		= "<$#local.PERSON_ID$>";
		var interactionId	= "<$#local.INTERACTION_ID$>";
		
		// Should be set to the default panel initially.
		var selectedPanel;
		
		function getBaseParams() {
			var baseParams = "";
			
			baseParams += "&enableAccountActions=1";
			
			if (entityId != "") {
				baseParams += "&ORGANISATION_ID=" + entityId;
			}
			
			if (personId != "") {
				baseParams += "&PERSON_ID=" + personId;
			}
			
			if (interactionId != "") {
				baseParams += "&INTERACTION_ID=" + interactionId;
			}
			
			return baseParams;
		}
		
		function switchTab(tab) {
			var tabName = tab.id.substring(4);
			$(".cs-info-tab").removeClass("cs-tabOn").addClass("cs-tabOff");
			$(tab).addClass("cs-tabOn");
			
			switchPanelContent(tabName);
		}
		
		function openTab(tab) {
		
			var tabName = tab.id.substring(4);
			$(".cs-info-tab").removeClass("cs-tabOn").addClass("cs-tabOff");
			$(tab).removeClass("cs-tabOff");
			$(tab).addClass("cs-tabOn");
			
			selectedPanel = panelMapping[tabName];
			loadPanelContent(selectedPanel, getBaseParams(), true);
		}
		
		/* Toggles display of the given switchable panel. */ 
		function switchPanelContent(panelName) {
			
			// First, hide all switchable panels.
			$(".switch-panel").css("display","none");
			
			// Display the selected panel.
			$("#" + panelName).css("display","");
		}
		
		/* Loads new content using an AJAX call. */
		function loadPanelContent(panelIncName, params, openLinksInNewWindow) {
			
			var container = $("#info-container");
			$(container).html("");
			
			$(container).addClass("container-loading");
			
			var urlPrefix = "?IdcService=CCLA_GET_INCLUDE<$include add_idc_token_to_url$>&incName=";
			urlPrefix += panelIncName;
			urlPrefix += params;
			
			var d = new Date();
			
			$.get(urlPrefix + '&rt=' + d.getTime(),
				null, 
				function(data) {
					if (selectedPanel != panelIncName) {
						// Ignore out-of-date panel loads.
						return;
					}
 
					$(container).removeClass("container-loading");
					$(container).html(data);
					
					if(openLinksInNewWindow != null && openLinksInNewWindow == true){
						//Open links in a new window
						$(".cs-info-panel a").each(function() {
							if ($(this).attr("href").substring(0,1) == "?")
								$(this).attr('target','_blank');
						});
					}
				}
			);
		}
		
		/* Returns the selected radio value for the given form
		* and radio button set name. */
		function getSelectedRadioValue(frm, elemName) {
		
			var radios = 
			 frm.elements[elemName];
			
			var selRadio = "";
			
			if (typeof(radios.length) == "undefined") {
				if (radios.checked)
					selRadio = radios.value;
				
			} else {
			
				for (var i=0; i<radios.length; i++) {
					var thisRadio = radios[i];
					
					if (thisRadio.checked)
						selRadio = thisRadio.value;
				}
			}
			
			return selRadio;
		}
	
	</script>
	
<@end@>

<!-- Display a list of all persons related to a particular client.
	 The rsRelatedPersons ResultSet may contain duplicate entries
	 if a particular person has multiple client roles.
	 
	 This listing display will only show a person once, the final
	 columns will indicate any roles they have on the client. -->
<@dynamichtml ccla_cs_client_persons_list@>
	
	<$if rsRelatedPersons$>
		<table class="accounts-table" width="100%" cellpadding="0" cellspacing="0">
			<tr class="account-details-row first-row">
				<th class="first-col" width="40">
					&nbsp;
				</th>
				<th>
					Name
				</th>
				<th>
					Postcode
				</td>
				<th width="40">Corr.</th>
				<th width="40">Sig.</th>
				<th width="40">Trust.</th>
			</tr>
			
			<$exec rsFirst("rsClient")$>
			
			<$loop rsRelatedPersons$>
				<tr class="account-details-row">
					<td class="first-col" align="center"> 
						<input 	type="radio" name="sel_personId" value="<$#active.PERSON_ID$>" 
								<$if #local.personId like #active.PERSON_ID$>checked="checked"<$endif$> />
					</td>
					<td>
						<a 	href="<$HttpCgiPath$>?IdcService=CCLA_CS_PERSON_INFO<$include add_idc_token_to_url$>&PERSON_ID=<$#active.PERSON_ID$>"
							title="Click to view full person info (opens in new window)"
							target="_blank"><$#active.PERSON_ID$></a>
						
						<br/>
						<$if #active.PERSON_ID like rsClient.CORRESPONDENT_ID$>
							<b>
						<$endif$>
							
							<$if #active.FULL_NAME$>
								<$#active.FULL_NAME$>
							<$else$>
								<$#active.KNOWNAS$>
							<$endif$>
						
						<$if #active.PERSON_ID like rsClient.CORRESPONDENT_ID$>
							</b>
							<br/>
							<span class="no-info">Nominated correspondent</span>
						<$endif$>
					</td>
					<td>
						<$if #active.POST_CODE$>
							<$#active.POST_CODE$>
						<$else$>
							&nbsp;
						<$endif$>
					</td>
					<td align="center">
						<$if #active.IS_CORR$>
							<img src="images/ccla/tick.gif" />
						<$else$>
							&nbsp;
						<$endif$>
					</td>
					<td align="center">
						<$if #active.IS_SIGN$>
							<img src="images/ccla/tick.gif" />
						<$else$>
							&nbsp;
						<$endif$>
					</td>
					<td align="center">
						<$if #active.IS_TRUSTEE$>
							<img src="images/ccla/tick.gif" />
						<$else$>
							&nbsp;
						<$endif$>
					</td>
				</tr>
			<$endloop$>
		
		</table>
		
	<$else$>
		<p>No persons associated with this client</p>
	
	<$endif$>

<@end@>


<!-- Display a list of registered correspondents for this client.
	 This starts with the nominated client correspondent. After this,
	 list any account correspondents (but don't repeat the nominated
	 correspondent details) -->
<@dynamichtml ccla_cs_client_correspondents_panel@>
	
	<table class="accounts-table" width="100%" cellpadding="0" cellspacing="0">
		
		<$loop rsClientCorrespondent$>
			<tr class="account-details-row first-row">
				<td class="first-col" width="40" align="center"> 
					<input 	type="radio" name="sel_personId" value="<$#active.PERSON_ID$>" 
							<$if #local.personId like #active.PERSON_ID$>checked="checked"<$endif$> />
				</td>
				<td class="first-row">
					<$include ccla_cs_display_listed_person_details$>
				</td>
			</tr>
		<$endloop$>
		
		<$exec rsFirst("rsClientCorrespondent")$>
		
		<$loop rsAccountCorrespondents$>
		
			<$if not (#active.PERSON_ID like rsClientCorrespondent.PERSON_ID)$>
				<tr class="account-details-row">
					<td class="first-col" width="40" align="center"> 
						<input type="radio" name="sel_personId" value="<$#active.PERSON_ID$>" <$if #local.personId like #active.PERSON_ID$>checked="checked"<$endif$> />
					</td>
					<td class="first-row">
						<$include ccla_cs_display_listed_person_details$>
					</td>
				</tr>
			<$endif$>
			
		<$endloop$>

	</table>	
		
<@end@>

<!-- 	Displays a list of signatories tied to the current client and their
		associated accounts. -->
<@dynamichtml ccla_cs_client_signatories_panel@>
	
	<!-- Account signatories -->
	<table class="accounts-table" width="100%" cellpadding="0" cellspacing="0">
		
		<$firstSign=1$>
		
		<$loop rsAccountPersons$>						
			<$if #active.RELATION_TYPE like "ACC_SIGN"$>
				
				<tr class="account-details-row<$if firstSign == 1$> first-row<$endif$>">
					<td class="first-col" width="40" align="center"> 
						<input type="radio" name="sel_personId" value="<$#active.PERSON_ID$>" <$if #local.personId like #active.PERSON_ID$>checked="checked"<$endif$> />
					</td>
					<td class="first-row">
						<$include ccla_cs_display_listed_person_details$>
					</td>
				</tr>
				
				<$firstSign=0$>
			<$endif$>
		<$endloop$>
		
	</table>
	
	<br/>
	
	<!-- client signatories -->
	<table class="accounts-table" width="100%" cellpadding="0" cellspacing="0">
		
		<$firstSign=1$>
		
		<$loop rsRelatedPersons$>						
			<$if #active.RELATION_TYPE like "CLI_SIGN"$>
				<tr class="account-details-row<$if firstSign == 1$>  first-row<$endif$>">
					<td class="first-col" width="40" align="center"> 
						<input type="radio" name="sel_personId" value="<$#active.PERSON_ID$>" <$if #local.personId like #active.PERSON_ID$>checked="checked"<$endif$> />
					</td>
					<td class="first-row">
						<$include ccla_cs_display_listed_person_details$>
					</td>
				</tr>
				
				<$firstSign=0$>
			<$endif$>
		<$endloop$>
		
	</table>
	
<@end@>	

<!-- 	Displays the inputs for customer details and authenticate forms takes parameter serviceName which sets the service to call from the form -->
<@dynamichtml ccla_cs_experian_details@>

			<$if not searchType or (#local.searchType like "Clients")$>
			
				<div class='ccla_cs_panel_header'>
					Client Information:
				</div>
			
				<div class='ccla_cs_panel_content'>
					
					<br/>
				
					<form name="clientDetails" id="clientDetails" method="POST">
					<input type="hidden" name="PERSON_ID" value="<$#active.PERSON_ID$>" />
						<input type="hidden" name="IdcService" value="<$serviceName$>" /><$include add_idc_token_to_form$>
						
						<table width="100%" cellpadding=0 cellspacing=2>
							<tr>
								<td width="150">Title:</td>
								<td>
									<input type="text" name="NAME_TITLE" value="<$#active.NAME_TITLE$>" /> 
								</td>
								<td></td>
								<td></td>
							</tr>
							<tr>
								<td width="150">First Name:</td>
								<td>
									<input type="text" name="NAME_FORENAME" value="<$#active.NAME_FORENAME$>" /> 
								</td>
							</tr>
							<tr>
								<td>Initials</td>
								<td>
									<input type="text" name="NAME_INITIALS" value="<$#active.INITIALS$>" /> 
								
								</td>
							</tr>							
							<tr>
								<td>Surname:</td>
								<td>
									<input type="text" name="NAME_SURNAME" value="<$#active.NAME_SURNAME$>" /> 
								</td>
							</tr>
							<tr>
								<td>Date of Birth:</td>
								<td>
									<input type="text" name="NAME_DATEOFBIRTH" value="<$#active.DOB$>" /> 
								
								</td>
							</tr>					
						</table>
				
				</div>
				
			<$endif$>
				
			<$if not searchType$>
				<br/>
			<$endif$>
			
			<$if not searchType or (#local.searchType like "People")$>		
				
				<div class='ccla_cs_panel_header'>
					Address:
				</div>
			
				<div class='ccla_cs_panel_content'>
					
					<br/>

						<table width="100%" cellpadding=0 cellspacing=2>
							<tr>
								<td width="150">Flat Number:</td>
								<td>
									<input type="text" name="FLAT" value="<$#active.FLAT$>" /> 
								</td>
							</tr>
							<tr>
								<td>House Name:</td>
								<td>
									<input type="text" name="HOUSENAME" value="<$#active.HOUSENAME$>" /> 
								</td>
							</tr>
							<tr>
								<td>House Number:</td>
								<td>
									<input type="text" name="HOUSENUMBER" value="<$#active.HOUSENUMBER$>" /> 
								</td>
							</tr>	
							<tr>
								<td>Street:</td>
								<td>
									<input type="text" name="STREET" value="<$#active.STREET$>" /> 									
								</td>
							</tr>		
							<tr>
								<td>District:</td>
								<td>
									<input type="text" name="DISTRICT" value="<$#active.DISTRICT$>" /> 								
								</td>
							</tr>
							<tr>
								<td>Town:</td>
								<td>
									<input type="text" name="TOWN" value="<$#active.TOWN$>" /> 									
								</td>
							</tr>
							<tr>
								<td>County:</td>
								<td>
									<input type="text" name="COUNTY" value="<$#active.COUNTY$>" /> 									
								</td>
							</tr>
							<tr>
								<td>Postcode:</td>
								<td>
									<input type="text" name="POSTCODE" value="<$#active.POSTCODE$>" /> 									
									<a href="?IdcService=GET_DOC_PAGE<$include add_idc_token_to_url$>&Action=GetTemplatePage&Page=CCLA_CS_EXPERIAN_ADDRESS_LOOKUP&PERSON_ID=<$#active.PERSON_ID$>">
									Look up address
									</a>
									<div align="right">
										<input type="button" value="Save Details"/>
										<input type="submit" value="Authenticate" onClick="return checkAuthenticate();"/>
									</div>
								</td>
							</tr>					
						</table>
						
					</form>
				
				</div>
			
		<$endif$>
<@end@>	

<!-- Attempt to fetch data using JSON formatting -->
<@dynamichtml ccla_cs_autocomplete_test_JSON@>
	
	<$searchScope="client"$>
	<$executeService("CCLA_CS_CONTACT_LOOKUP_SUBMIT")$>
	
	{
		<$loop rsExistingClient$>
			{ "label": "<$#active.NAME$>", "value": "<$#active.ORGANISATION_ID$>" }<$if getValue("rsExistingClient","#row") < getValue("rsExistingClient","#numRows")$>,<$endif$>
		<$endloop$>
	}
	
<@end@>

<!-- TODO: consolidate with ECS_JavaScript component -->
<@dynamichtml ccla_javascript_autocomplete_include@>
	<link type="text/css" href="<$HttpWebRoot$>resources/ECS_Javascript/jquery/addons/autocomplete/css/jquery.ui.all.css" rel="stylesheet" />
	<script type="text/javascript" src="<$HttpWebRoot$>resources/ECS_Javascript/jquery/addons/autocomplete/js/jquery.ui.core.js"></script>
	<script type="text/javascript" src="<$HttpWebRoot$>resources/ECS_Javascript/jquery/addons/autocomplete/js/jquery.ui.widget.js"></script>
	<script type="text/javascript" src="<$HttpWebRoot$>resources/ECS_Javascript/jquery/addons/autocomplete/js/jquery.ui.position.js"></script>
	<script type="text/javascript" src="<$HttpWebRoot$>resources/ECS_Javascript/jquery/addons/autocomplete/js/jquery.ui.autocomplete.js"></script>
<@end@>




<@dynamichtml ccla_cs_common_params@>
	<$if #local.isForm==1$>
		<input type="hidden" name="isCompact" value="<$#local.isCompact$>" />
		<$isForm=""$>
	<$endif$>
	
	<$commonParams="&isCompact=" & #local.isCompact & "&isFromExpanded=" & #local.isFromExpanded$>
<@end@>

<@dynamichtml ccla_cs_compact_styles@>
	<style type="text/css">
		.cs-page-container{
			width:800px;
		}

		#cs_action_buttons_container{
			display:none;
		}
	</style>
<@end@>

<@dynamichtml ccla_cs_contact_lookup_mini_styles@>
	<style type="text/css">
		.accounts-table{
		}
		
		#contactSearchResults table td{
			border:none !important;
			border-collapse:collapse;
		}
		
		#contactSearchResults{
			height:300px;
			overflow-y:scroll;
			overflow-x:hidden;
			background-color:#EEE;
			border:4px solid #FFF;
			border-top:none;
			border-bottom:none;
		}
		
		#contactSearchResults .account-details-row td{
			border-bottom:1px solid #999999 !important;
			border-right:1px solid #999999 !important;
			border-collapse:separate !important;
		}
	</style>
<@end@>

<@dynamichtml ccla_cs_interaction_assignee_options@>
	<$aliasName = "CS_Users"$>
	<$executeService("IRIS_GET_ALIAS_MEMBERS")$>
											
	<option value=""></option>
	<option value="<$dUser$>" <$if strEquals(dUser, rsInteraction.ASSIGNEE)$>selected<$endif$>>Me</option>
	<option value="CS Team" <$if strEquals(rsInteraction.ASSIGNEE, "CS Team")$>selected<$endif$>>CS Team</option>

	<$loop rsAliasMembers$>
		<option value="<$#active.dUserName$>" <$if strEquals(rsInteraction.ASSIGNEE, #active.dUserName)$>selected<$endif$>>
			<$#active.dUserName$>
		</option>
	<$endloop$>
<@end@>

<@dynamichtml ccla_cs_output_country@>
	<$loop rsCountries$>
		<$if strEquals(rsCountries.COUNTRY_ID,targetCountry)$>
			<$rsCountries.COUNTRY_NAME$>
			<$break$>
		<$endif$>
	<$endloop$>
<@end@>

<@dynamichtml ccla_cs_output_country_options@>
	<option></option>
	<option value="77">United Kingdom</option>
	<$loop rsCountries$>
		<option value="<$rsCountries.COUNTRY_ID$>" 
			<$if strEquals(rsCountries.COUNTRY_ID, selectedCountry)$>selected<$endif$>>
			<$rsCountries.COUNTRY_NAME$>
		</option>	
	<$endloop$>
<@end@>

<@dynamichtml ccla_interaction_listings_inline_header@>
	
	  <div style="float:left;">
					<input type=checkbox name="showCompleted" <$if showCompleted$>checked=true<$endif$> onclick="document.forms['SEARCHFILTER'].submit();">Include completed
					<br style="line-height: 0px; height: 0px"/>
	</div>

<@end@>
<@dynamichtml ccla_cs_campaign_L2_search_results@>

	<$if #local.search_params$>
		<$executeService("CCLA_CS_GET_CAMPAIGN_L2_SEARCH_RESULTS")$>
	<$else$>
		nothing
	<$endif$>
	
	<table width="100%" border="1">	
		<tr>
			<th>Region</th>
			<th>PostCode</th>
			<th>Company Name</th>
			<th>Company Type</th>
			<th>Investment Tot</th>
			<th>Deposit Tot</th>
			<th>Fixed Int Tot</th>
			<th>GLOB Equity Tot</th>
			<th>UK Equity Tot</th>
			<th>Prop Tot</th>
			<th>Ethnical Tot</th>						
		</tr>
	<$loop rsL2SearchResults$>
		<tr>
			<td><$#active.REGION$></td>
			<td><$#active.POSTCODE$></td>
			<td><$#active.ORGANISATION_NAME$></td>
			<td><$#active.COMPANY_CODE$></td>
			<td><$#active.INVESTMENT_TOT$></td>
			<td><$#active.DEPOSIT_TOT$></td>
			<td><$#active.FIXED_INTEREST_TOT$></td>
			<td><$#active.GLOBAL_EQUITY_TOT$></td>
			<td><$#active.UK_EQUITY_TOT$></td>
			<td><$#active.PROPERTY_TOT$></td>
			<td><$#active.ETHNICAL_TOT$></td>
		</tr>
	<$endloop$>
		
	</table>
	
<@end@>

<!-- Displays all accounts in the rsAccounts ResultSet, with extra
	 fields for displaying and editing investment intentions.
     
	 Also displays a set of 'totals' for each account, e.g. how many
	 signatories and bank accounts have been linked, plus an action
	 menu for generating forms etc.
	 -->
<@dynamichtml ccla_cs_display_enrolment_accounts@>
	<$if IsDebug$>ccla_cs_display_enrolment_accounts<$endif$>
	<$lastOrgId=""$>
	
	[[%ORGANISTAION_ID already on binder%]]
	
	<$executeService("CCLA_CS_GET_RELATION_TOTALS")$>
	<$HAS_TEMP_ACCOUNTS=0$>
	<$HAS_SIGS=0$>
	<$HAS_AUTH_PERSONS=0$>
	<$HAS_BANK_ACCOUNTS=0$>
	
	<$missingAccountSubtitle=""$>
	
	<$loop rsAccounts$>

		<$HAS_TEMP_ACCOUNTS=1$>
		
		<$currentAccountId = #active.ACCOUNT_ID$>
		<$if NOT includedTableHeader$>
			<$include ccla_cs_display_enrolment_account_table_header$>	
		<$endif$>
		
		<$if not #active.SUBTITLE$>
			<$missingAccountSubtitle=1$>
		<$endif$>
		
		<$includedTableHeader = 1$>
		<$include ccla_cs_resolve_account_row_css_class$>

		<tr class="account-details-row<$if rowClass$> <$rowClass$><$endif$>">
			<td class="first-col mono-type">
				<$if not #active.isCompact$>
					<a href="?IdcService=CCLA_CS_ACCOUNT_EDIT<$include add_idc_token_to_url$>&ACCOUNT_ID=<$#active.ACCOUNT_ID$>" target="_new">
				<$endif$>
				
				<$strLeftFill(#active.ACCOUNTNUMBER,"0",8)$>
				
				<$if not #active.isCompact$>
					</a>
				<$endif$>
			</td>
			<td><$#active.SUBTITLE$></td>
			
			<$if #local.displayInvestmentIntentionFields$>
				<td>
					<$currentStatus = #active.INVINTENTSTATUS_ID$>
					
					<select style="width:98%" name="INVINTENTSTATUS_ID" id="INVINTENTSTATUS_ID_<$#active.INVESTMENT_INTENTION_ID$>_A">
						<$loop rsIntentionStatus$>
							<option value="<$#active.INVINTENTSTATUS_ID$>" <$if strEquals(#active.INVINTENTSTATUS_ID,currentStatus)$>selected<$endif$> ><$#active.INVINTENTSTATUS_NAME$></option>
						<$endloop$>
					</select>
				</td>
				<td>
					<$if enrolmentAccountCurrency like "units"$>
						<input style="width:98%" type="text" name="UNITS" id="UNITS_<$#active.INVESTMENT_INTENTION_ID$>_A" value="<$#active.UNITS$>" />
					<$else$>
						<input style="width:98%" type="text" name="CASH" id="CASH_<$#active.INVESTMENT_INTENTION_ID$>_A" value="<$#active.CASH$>" />
					<$endif$>
				</td>
			<$endif$>

			<td><$#active.SHORT_NAME$></td>
			<td><$#active.INCOME_DISTRIBUTION_METHOD$></td>
			<td>
				<$if rsRelationTotals$>
					<$loop rsRelationTotals$>
						<$if rsRelationTotals.ACCOUNT_ID==currentAccountId$>
							<$if rsRelationTotals.NUM_SIGS==0$>
								<img title="No signatories for this account" src="images/ccla/cross.png">
							<$else$>
								<$HAS_SIGS=1$>
								<span class="bold"><$rsRelationTotals.NUM_SIGS$></span>
							<$endif$>
						<$endif$>
					<$endloop$>
				<$else$> 
					<img title="No authorised persons for this account" src="images/ccla/cross.png">
				<$endif$>
				
			</td>
			<td>
				<$if rsRelationTotals$>
					<$loop rsRelationTotals$>
						<$if rsRelationTotals.ACCOUNT_ID==currentAccountId$>
							<$if rsRelationTotals.NUM_AUTHS==0$>
								<img title="No authorised persons for this account" src="images/ccla/cross.png">
							<$else$>
								<$HAS_AUTH_PERSONS=1$>
								<span class="bold"><$rsRelationTotals.NUM_AUTHS$></span>
							<$endif$>
						<$endif$>
					<$endloop$>
				<$else$> 
					<img title="No authorised persons for this account" src="images/ccla/cross.png">
				<$endif$>
			</td>
			<td>
				<$if rsRelationTotals$>
					<$loop rsRelationTotals$>
						<$if rsRelationTotals.ACCOUNT_ID==currentAccountId$>
							<$if rsRelationTotals.NUM_BANK_ACCOUNTS==0$>
								<img title="No bank accounts assigned to this account" src="images/ccla/cross.png">
							<$else$>
								<$HAS_BANK_ACCOUNTS=1$>
								<span class="bold"><$rsRelationTotals.NUM_BANK_ACCOUNTS$></span>
							<$endif$>
						<$endif$>
					<$endloop$>
				<$else$> 
					<img title="No bank accounts assigned to this account" src="images/ccla/cross.png">
				<$endif$>
			</td>
			
			<td align="center">
				
				<$menu_style_prefix	= "top"$>
				<$menu_id           = #active.ACCOUNT_ID$>
				
				<$if not #local.enrolmentAccountMenuInclude$>
					<$actionMenu_CustomInclude="ccla_cs_enrolment_account_menu"$>
				<$else$>
					<$actionMenu_CustomInclude=#local.enrolmentAccountMenuInclude$>
				<$endif$>
				
				<$include action_menu$>
			</td>
		</tr>

	<$endloop$>
	
	<$if rsAccounts AND includedTableHeader$>
		</table>
	<$else$>
		None
	<$endif$>
	
<@end@>

<!-- Default menu options for accounts listed on Campaign Enrolment pages.

     Includes standard account actions, plus an 'Update Intention' link. -->
<@dynamichtml ccla_cs_enrolment_account_menu@>
	
	<$include ccla_cs_account_actions_menu$>
	
	<$if #local.displayInvestmentIntentionFields$>
		<tr>
			<td class="<$menu_style_prefix$>PopupLink" nowrap onMouseOver="glowPopupRow(this,'<$menu_style_prefix$>PopupLink_over','<$menu_style_prefix$>PopupLink')"	onMouseOut="fadePopupRow(this,'<$menu_style_prefix$>PopupLink')">
				
				<form name="updateIntentionForm_<$#active.INVESTMENT_INTENTION_ID$>" id="updateIntentionForm_<$#active.INVESTMENT_INTENTION_ID$>" >
					<input type="hidden" name="IdcService" 				value="CCLA_CS_ACCOUNT_INTENTION_UPDATE" /><$include add_idc_token_to_form$>
					<input type="hidden" name="RedirectUrl" 			value="<$HttpCgiPath$>?IdcService=<$#local.IdcService$><$include add_idc_token_to_url$>&CAMPAIGN_ENROLMENT_ID=<$#local.CAMPAIGN_ENROLMENT_ID$>&ORGANISATION_ID=<$#local.ORGANISATION_ID$>&CAMPAIGN_ID=<$#local.CAMPAIGN_ID$>&PERSON_ID=<$#local.PERSON_ID$>" />
						
					<input type="hidden" name="CAMPAIGN_ENROLMENT_ID" 	id="CAMPAIGN_ENROLMENT_ID"  										value="<$#local.CAMPAIGN_ENROLMENT_ID$>" />
					<input type="hidden" name="ACCOUNT_ID" 				id="ACCOUNT_ID"  													value="<$#active.ACCOUNT_ID$>" />
					<input type="hidden" name="INVESTMENT_INTENTION_ID" value="<$#active.INVESTMENT_INTENTION_ID$>" />
					<input type="hidden" name="UNITS" 					id="UNITS_<$#active.INVESTMENT_INTENTION_ID$>_B"  					value="" />
					<input type="hidden" name="CASH" 					id="CASH_<$#active.INVESTMENT_INTENTION_ID$>_B"  					value="" />
					<input type="hidden" name="INVINTENTSTATUS_ID"		id="INVINTENTSTATUS_ID_<$#active.INVESTMENT_INTENTION_ID$>_B"  		value="" />
					<input type="hidden" name="CAMPAIGN_ID" 			value="<$#active.CAMPAIGN_ID$>" />
					<input type="hidden" name="PERSON_ID" 				value="<$#active.PERSON_ID$>" />
					<input type="hidden" name="ORGANISATION_ID" 		value="<$#active.ORGANISATION_ID$>" />
					<input type="hidden" name="FUND_CODE" 				value="<$#active.FUND_CODE$>" />
				
					<a style="text-decoration: none" onclick="submitUpdateIntentionForm('updateIntentionForm_<$#active.INVESTMENT_INTENTION_ID$>', <$#active.INVESTMENT_INTENTION_ID$>)">Update intention</a>	
				</form>
			</td>
		</tr>
	<$endif$>
	
<@end@>

<!-- PSDF Registration account menu. Includes extra link for generating a welcome pack. -->
<@dynamichtml ccla_cs_enrolment_psdf_reg_account_menu@>
	
	<$include ccla_cs_enrolment_account_menu$>
	
	<tr>
		<td class="<$menu_style_prefix$>PopupLink" nowrap onMouseOver="glowPopupRow(this,'<$menu_style_prefix$>PopupLink_over','<$menu_style_prefix$>PopupLink')"	onMouseOut="fadePopupRow(this,'<$menu_style_prefix$>PopupLink')">
			<a style="text-decoration: none" href="javascript:applyAccountAction('genWelcomePack', '<$#active.ACCOUNT_ID$>');">Generate Welcome Pack forms</a>
		</td>
	</tr>
	
	<tr>
		<td class="<$menu_style_prefix$>PopupLink" nowrap onMouseOver="glowPopupRow(this,'<$menu_style_prefix$>PopupLink_over','<$menu_style_prefix$>PopupLink')"	onMouseOut="fadePopupRow(this,'<$menu_style_prefix$>PopupLink')">
			<a style="text-decoration: none" href="javascript:applyAccountAction('genAdditionalAccountForm', '<$#active.ACCOUNT_ID$>');">Generate Additional Account Opening form</a>
		</td>
	</tr>
	
	<tr>
		<td class="<$menu_style_prefix$>PopupLink" nowrap onMouseOver="glowPopupRow(this,'<$menu_style_prefix$>PopupLink_over','<$menu_style_prefix$>PopupLink')"	onMouseOut="fadePopupRow(this,'<$menu_style_prefix$>PopupLink')">
			<a style="text-decoration: none" href="javascript:applyAccountAction('genChangeOfDividendPaymentForm', '<$#active.ACCOUNT_ID$>');">Generate Change of Dividend Payment form</a>
		</td>
	</tr>
	
	<tr>
		<td class="<$menu_style_prefix$>PopupLink" nowrap onMouseOver="glowPopupRow(this,'<$menu_style_prefix$>PopupLink_over','<$menu_style_prefix$>PopupLink')"	onMouseOut="fadePopupRow(this,'<$menu_style_prefix$>PopupLink')">
			<a style="text-decoration: none" href="javascript:applyAccountAction('genAdditionalWithdrawalBankAccountForm', '<$#active.ACCOUNT_ID$>');">Generate Additional Withdrawal Bank Account form</a>
		</td>
	</tr>

<@end@>

<!-- Standard Account actions menu, designed for display on Account rows. -->
<@dynamichtml ccla_cs_account_actions_menu@>
	
	<tr>
		<td class="<$menu_style_prefix$>PopupLink" nowrap onMouseOver="glowPopupRow(this,'<$menu_style_prefix$>PopupLink_over','<$menu_style_prefix$>PopupLink')"	onMouseOut="fadePopupRow(this,'<$menu_style_prefix$>PopupLink')">
			<a style="text-decoration: none" href="?IdcService=CCLA_CS_ACCOUNT_INFO&ACCOUNT_ID=<$#active.ACCOUNT_ID$>" target="_blank" >View info</a>
		</td>
	</tr>
	
	<tr>
		<td class="<$menu_style_prefix$>PopupLink" nowrap onMouseOver="glowPopupRow(this,'<$menu_style_prefix$>PopupLink_over','<$menu_style_prefix$>PopupLink')"	onMouseOut="fadePopupRow(this,'<$menu_style_prefix$>PopupLink')">
			<a style="text-decoration: none" href="?IdcService=CCLA_CS_ACCOUNT_EDIT<$include add_idc_token_to_url$>&ACCOUNT_ID=<$#active.ACCOUNT_ID$>" target="_blank">Update</a>
		</td>
	</tr>
	
	<tr>
		<td class="<$menu_style_prefix$>PopupLink" nowrap onMouseOver="glowPopupRow(this,'<$menu_style_prefix$>PopupLink_over','<$menu_style_prefix$>PopupLink')"	onMouseOut="fadePopupRow(this,'<$menu_style_prefix$>PopupLink')">
			<a style="text-decoration: none" href="#" onclick="openPopup('?IdcService=CCLA_CS_GET_FORM_TYPES_BY_ELEMENT<$include add_idc_token_to_url$>&ELEMENT_ID=<$#active.ACCOUNT_ID$>');">Generate forms...</a>
		</td>
	</tr>
	
<@end@>

<@dynamichtml ccla_cs_display_enrolment_account_table_header@>
	
	<$if IsDebug$>ccla_cs_display_enrolment_account_table_header<$endif$>
	
	<table class="accounts-table" cellspacing="0" cellpadding="0" width="100%">
		<tr>
			<th class="first-col" width="10%">Account no.</th>
			<th>Subtitle</th>
			
			<$if #local.displayInvestmentIntentionFields$>
			
				<th>Confidence</th>
				<th>
					<$if enrolmentAccountType like "loan"$>
						Loan Amount
					<$else$>
						Intention Amount
					<$endif$>
				</th>
			
			<$endif$>
			
			<th width="5%">Status</th>
			<th width="8%">Inc. dist. method</th>
			<th width="5%">Sigs</th>
			<th width="5%">A.Pers</th>
			<th width="5%">Bank Accs.</th>
			<th width="6%">Actions</th>
		</tr>

		
<@end@>
<@dynamichtml ccla_cs_display_helpbutton_js@>
	<script type="text/javascript">
	
		displayHelpDocumentIris = function() {
			var formToUse = document.forms['doc_fields'];
			
			if (formToUse.xDocumentClass.value) {
				displayHelpDocument(formToUse.xDocumentClass.value);
			} else {
				alert('please select a document class to view the help file');
			}
		}
	
		displayHelpDocument = function(helpCode) {
			
			if (helpCode) {
		
				// This AJAX call uses Aurora web services to fetch data.
				$.getJSON('?IdcService=CCLA_DISPLAY_HELP_DOCUMENT<$include add_idc_token_to_url$>', 
					{ 	HELP_CODE: 	helpCode,
						IsJson: 	1,
						ts: 		new Date().getTime()
					}, function(jsonData) {displayHelp(jsonData)} 
				);
			} else {
				alert("Help Code is not set, please contact the administrator");
			}
		}

		displayHelp = function(jsonData) {
			
			if (jsonData == "") {	
				alert("Cannot Open help file");
			} else {	
				var jsonErrorMsg  = getJsonErrorMsg(jsonData);
				
				if (jsonErrorMsg) {
					alert('Error getting help document: '+jsonErrorMsg);
				} else {

					if (jsonData.LocalData.helpDocUrl) {
						window.open(jsonData.LocalData.helpDocUrl,
									'helpWindow',
									'toolbar=0,location=0,menubar=0,height=480,width=820,resizeable=1');								
					} else {
						alert("No help document defined for "+jsonData.LocalData.HELP_CODE+", please contact the administrator");
					}
				}
			}
		}
	</script>
	
	<!--<a href="#" onclick="displayHelpDocument(value);" alt="Help"><img src="<$HttpImagesRoot$>ccla/clientservices/helpIcon_sm.gif" border="0"></a> -->
<@end@>
 
<@dynamichtml ccla_cs_ajax_toggle_panel_js@>
	
	<script type="text/javascript">
		/* Control script for dynamic loading of HTML panel data via
		   AJAX calls to the CCLA_CS_GET_INCLUDE service.
		   
		   Display the Ajax panel DOM elements using the ccla_cs_ajax_panel
		   include. There are a set of Idoc vars that must be specified before
		   calling the display include.
		*/
		
		// Stores the state of any loaded panels.
		var ajaxPanels = new Object();
		
		// Stores ID and state of a single panel.
		function AjaxPanel(id, state, incName, params) {
			this.id = id;
			this.state = state;
			this.incName = incName;
			this.params = params;

			// Performs required CSS changes when a panel changes state.
			this.setState = function(newState) {
				// Grab the toggle button.
				var thisToggleButton = $("#" + this.id + "_toggle .panel-toggle-button");
				
				// Remove all state-specific CSS classes from the button
				$(thisToggleButton)	.removeClass("toggle-button-open")
									.removeClass("toggle-button-closed")
									.removeClass("toggle-button-loading");
				
				if (newState == AjaxPanelState.OPEN) {
					$(thisToggleButton).addClass("toggle-button-closed");
				} else if (newState == AjaxPanelState.CLOSED) {
					$(thisToggleButton).addClass("toggle-button-open");
				} else if (newState == AjaxPanelState.LOADING) {
					$(thisToggleButton).addClass("toggle-button-loading");
				}
				
				// Update the panel's state
				this.state = newState;
			}
		}

		var AjaxPanelState = {
			CLOSED	: 0,
			LOADING : 1,
			OPEN	: 2
		}
		
		/*
		ajaxPanels['instructions_ajax_panel_toggle'] =
			new AjaxPanel(	'instructions_ajax_panel',
							AjaxPanelState.CLOSED,
							'ccla_cs_display_instruction_listing',
							{'ORGANISATION_ID' : '<$#local.ELEMENT_ID$>' }
						);
						
		
		$(document).ready( function() {
			
			for (var ajaxPanel in ajaxPanels) {
				// Bind click events to panel toggle div
				$("#" + ajaxPanel.id + "_toggle .panel-toggle-button").bind("click", function() {
					toggleAjaxDataPanel(ajaxPanel.id, ajaxPanel.incName, ajaxPanel.params);
				});
			}
			
		});
		*/
		
		// Toggles the state of a dynamically-loaded AJAX panel.
		//
		// panelId must be a unique identifier for the panel you want to toggle.
		// It is expected that a DOM container will have this ID set - the
		// loaded HTML content will be placed in here.
		//
		// panelInclude is the name of the IdocScript include that will be
		// passed to the CCLA_CS_GET_INCLUDE service.
		//
		// params is an optional set of extra name-value pairs that will be
		// passed to 
		function toggleAjaxDataPanel(panelId, panelInclude, params) {
		
			var thisAjaxPanel = ajaxPanels[panelId];
			
			if (!thisAjaxPanel) {
				// Assume new Ajax Panel is closed to begin with.
				thisAjaxPanel = new AjaxPanel(panelId, AjaxPanelState.CLOSED);
				ajaxPanels[panelId] = thisAjaxPanel;
			}
			
			if (thisAjaxPanel.state == AjaxPanelState.OPEN) {
				// Panel already open - close it.
				thisAjaxPanel.setState(AjaxPanelState.CLOSED);
				$("#" + thisAjaxPanel.id).slideUp("fast");
				
			} else if (thisAjaxPanel.state == AjaxPanelState.LOADING) {
				// Panel is currently loading content. Do nothing
			} else if (thisAjaxPanel.state == AjaxPanelState.CLOSED) {
				// Load the panel and display its content.
				thisAjaxPanel.setState(AjaxPanelState.LOADING);
				
				// Standard AJAX request parameters. Includes a timestamp to
				// ensure each request will be posted to the server.
				var reqParams = {
					"IdcService"		: "CCLA_CS_GET_INCLUDE",
					"incName"			: panelInclude,
					"isAjax"			: 1,
					"ts"				: new Date().getTime()
				};
				
				// Merge in the passed parameters
				if (params) {
					for (var attr in params) {
						reqParams[attr] = params[attr];
					}
				}
				
				$.ajax({
				  url: "?<$include add_idc_token_to_url$>",
				  data: reqParams,
				  success: function(data) {
						$("#" + thisAjaxPanel.id).html(data);
						$("#" + thisAjaxPanel.id).slideDown("fast");

						thisAjaxPanel.setState(AjaxPanelState.OPEN);
					},
				  error: function(jqHR, textStatus, errorThrown) {
					alert(	"Oh dear - something went wrong loading this panel.\n\n" +
							"Text Status: " + textStatus + "\n" +
							"Error message: " + errorThrown + "\n\n" +
							"Please try again, or contact an administrator.");
							
					thisAjaxPanel.setState(AjaxPanelState.CLOSED);
					$("#" + thisAjaxPanel.id).slideUp("fast");					
				  }
				});
			}
			
		}
		
	</script>
	
<@end@>

<!-- Displays a AJAX panel toggle header and content container. Requires the
	 following Idoc vars set:
	 
	panelToggleLabel
	panelId 	
	panelIncName 
	panelParams 
	
	notAjaxData - If this is = 1 the include specified in panelIncName is loaded into the content
	openByDefault - if this is = 1 the panel is expanded by default
	 -->
<@dynamichtml ccla_cs_ajax_panel_display@>
	
	<$if not panelId$>
		Warning: panelId missing
	<$endif$>
	
	<$if not panelIncName$>
		Warning: panelIncName missing
	<$endif$>
	
	<table 	width="100%" cellspacing="2" cellpadding="0" 
			class="cs-info-table ajax-panel-toggle <$if #local.notAjaxData==1$>nonAjaxButton<$endif$>" style="margin: 5px 0px; background-color: #BEDFA7;"
			id="<$panelId$>_toggle" >
		<tr>
			<th valign="middle" class="ajax-panel-button" <$if #local.notAjaxData==0$> onclick="toggleAjaxDataPanel('<$#local.panelId$>',  '<$#local.panelIncName$>'<$if #local.panelParams$>, <$#local.panelParams$><$endif$>);" <$endif$>>
				<div class="panel-toggle-button <$if #local.openByDefault==1$>toggle-button-closed<$else$>toggle-button-open<$endif$>" id="icon_<$panelId$>"></div>
				<$#local.panelToggleLabel$>
			</th>
		</tr>
	</table>
	
	<div id="<$#local.panelId$>" <$if #local.notAjaxData==1$>class="content_<$#local.panelId$>"<$endif$> <$if #local.openByDefault==1 and #local.notAjaxData==1$><$else$>style="display:none"<$endif$>>
		<$if #local.notAjaxData==1$>
			<$inc(#local.panelIncName)$> 
		<$endif$>
	</div>
	
	<$panelId = ""$>
	<$panelToggleLabel = ""$>
	<$panelIncName = ""$>
	<$panelParams = ""$>
	<$notAjaxData = ""$>
	<$openByDefault=""$>
<@end@>


<@dynamichtml ccla_cs_expandable_region_js@>
	<script type="text/javascript">
	$(document).ready( function() {
		$('.nonAjaxButton').click(function() { 
		var buttonID = $(this).attr("id");

		//remove "_toggle" to get content area id
		contentID = buttonID.substring(0, buttonID.length-7);
		
			$("#"+contentID).slideToggle('fast', function(){
				if($("#"+contentID).css("display") != "none"){
					$("#icon_"+contentID).removeClass("toggle-button-open").addClass("toggle-button-closed");
				} else {
					$("#icon_"+contentID).removeClass("toggle-button-closed").addClass("toggle-button-open");
				}
				
			})
		})
	})
	</script>

<@end@>



<@dynamichtml ccla_cs_error_page_display@>
	
<html>
<head>
	
	<$include iris_jquery_js$>
	<$include ccla_cs_styles$>
	
	<title>
		Content Service Request Failed
	</title>
	
	<script type="text/javascript">
		
		$(document).ready(function() {
			
			$(".toggleStackTrace").click(function () {
				$("#stackTrace").slideToggle("medium");
			});
		});		
		 
	</script>
</head>
	
<body class="popupBody" style="margin:10px;background:#FFFFFF;overflow-y:visible" >
<div id="popupContainingDiv" style="overflow:auto; height:400px;">
	<div>
		<img src="<$HttpImagesRoot$>ccla/logo.gif"/>
		<span class="errorMessage" style="font-size:20px"><$lc("wwContentServerRequestFailed")$></span>
	</div>

	<$if showSlimError$>
	
		<h1 style="font-family:Verdana,Arial,Helvetica,sans-serif;font-size:10pt;font-weight:bold;width:100%;border-bottom:1px solid black;white-space:nowrap;margin-bottom:4px">
			<img src="<$HttpImagesRoot$>stellent/mailheadinglogo.gif" alt="<$stripXml(lc("wwTopBannerLogo"))$>">&nbsp;
			<$lc("wwWelcomeTo", productID)$></h1>

		<br style="line-height:1em">

		<p style="font-family:Verdana,Arial,Helvetica,sans-serif;font-weight:bold;font-size:9pt;padding-left:1em">
			<$StatusMessage$></p>
		
		<p style="font-family:Verdana,Arial,Helvetica,sans-serif;font-weight:bold;font-size:9pt;padding-left:1em">
			Please take a screenshot of this message and send it to an administrator.</p>
		
	<$else$>
		
		<!--Error Message--->
		<table border="0" cellpadding="0" cellspacing="0" summary="" style="background-color: white">
			<tr>
				<td width="600" align="left">
					<table border = "0" width="600" align="left" valign="middle" summary="" style="background-color: white">
						<tr>
							<td width=100%><span class=title>
							<$if errorResourceInclude$><$inc(errorResourceInclude)$>
							<$else$><$StatusMessage$>
							<$endif$></span></td>
						</tr>
						<$if ErrorStackTrace$>
							<tr>
								<td width=100%>[ <a class="toggleStackTrace" style="cursor:pointer; color:993333"><$lc("wwDetails")$></a> ]
								<div id="stackTrace" style="display: none">
								<xmp><$ErrorStackTrace$></xmp></div></td>
								<br/>
							</tr>
						<$endif$>
					</table>
				</td>
			</tr>
		</table>
	
		<p style="font-family:Verdana,Arial,Helvetica,sans-serif;font-weight:bold;font-size:9pt;padding-left:1em">
		Please take a screenshot of this message and send it to an administrator.</p>
		
		<p style="font-family:Verdana,Arial,Helvetica,sans-serif;font-weight:bold;font-size:9pt;padding-left:1em">
		<a href="javascript:history.back()">Click here to try going back</a> and fixing the request data.</p>
	
	
	<$endif$>	
</div>	
</body>
	
<@end@>

<!-- Javascript for handling auto-completion of Bank Account Short Name field. -->
<@dynamichtml ccla_cs_bank_account_short_name_js@>
	
	<script type="text/javascript">
													
		$(document).ready( function() {
			// Attach blur events to the ACCOUNT_NAME and 
			// BUILDING_SOCIETY_ROLL_NUMBER fields
			
			$("#ACCOUNT_NAME, #BUILDING_SOCIETY_ROLL_NUMBER").bind( 
				"blur", function() {
					var accShortNameField = $("#ACCOUNT_SHORT_NAME");
					
					var accShortNameVal = $(this).val();
					
					// Check that:
					// - the blurred field has a non-null value, and
					// - either the current Short Name field value is empty, or
					// - the blurred field is the Building Society Number.
					
					// Building Society Number will ALWAYS overwrite the Short Name
					// if its specified.
					if ((accShortNameVal != "")
						&&
						(($(accShortNameField).val() == "")
						||
						($(this).attr("id") == "BUILDING_SOCIETY_ROLL_NUMBER"))) {
						var accShortNameVal = $(this).val();
						
						// Shorten value if necessary
						if (accShortNameVal.length > 18)
							accShortNameVal = accShortNameVal.substring(0,18);
						
						$(accShortNameField).val(accShortNameVal);
					}
				}
			);
			
		});
		
	</script>
	
<@end@>

<!-- Displays a colour-coded tick graphic with a link to a Relationship Info pop-up.

	 Designed for display in read-only Relation grids, when a relationship is present.
	 
	 The following variables must be pre-calculated:
	 - thisRelationId: current RELATION_ID
	 - relationVerificationStatus: determines the colour/caption to give the tick.
	 - defaultRelation: flag indicating whether this is a default/nominated relationship.
	--> 
<@dynamichtml ccla_cs_relation_tick_display@>
	
	<$popupLink = 	"javascript:openPopup('?IdcService=CCLA_CS_RELATION_INFO" & inc("add_idc_token_to_url") & "&RELATION_ID=" 
					& #local.thisRelationId & "&ELEMENT_ID=" & #local.ELEMENT_ID 
					& "&isEdit=1&ts=' + new Date().getTime());"$>
	
	<$if relationVerificationStatus like "UNKNOWN"$>
		<a 	href="<$popupLink$>"
			title="Unverified relationship. Click for more info"

			><$if defaultRelation$><img src="images/ccla/tick-amber-nom.gif" /><$else$><img src="images/ccla/tick-amber.gif" /><$endif$></a>
	
	<$elseif relationVerificationStatus like "PASSED"$>
		<a 	href="<$popupLink$>"
			title="Relationship has been verified against an external source. Click for more info"
			
			><$if defaultRelation$><img src="images/ccla/tick-green-nom.gif" /><$else$><img src="images/ccla/tick-green.gif" /><$endif$></a>
	
	<$else$>
		<a 	href="<$popupLink$>"
			title="Relationship has failed verification. Click for more info"

			><$if defaultRelation$><img src="images/ccla/tick-red-nom.gif" /><$else$><img src="images/ccla/tick-red.gif" /><$endif$></a>
	
	<$endif$>

<@end@>

<!--Over ride to stop unauthorised users from deleting revisions and causing the indexer to go crazy-->
<@dynamichtml delete_revision_form@>

<script type="text/javascript">

function showDelPopUp(){
	alert("You do not have permission to delete this revision. Please contact a system administrator");
}
</script>
		<$useAmber=""$>
		<div style="display:none;">
		<form name="deleteRevForm_<$dID$>" action="<$HttpCgiPath$>" method="POST">
			<input type="hidden" name="dID" value="<$dID$>">
			<input type="hidden" name="dDocName" value="<$dDocName$>">
			<input type="hidden" name="dDocTitle" value="<$xml(dDocTitle)$>">
			<input type="hidden" name="isForceDelete" value="1">
			<input type="hidden" name="IdcService" value="DELETE_REV"><$include add_idc_token_to_form$>
		<$if ClientControlled$>
			<input type="hidden" name="ClientControlled" value="<$ClientControlled$>">
		<$endif$>
		<$include extra_request_form_fields$>
		</form>
		</div>
		<$if userHasRole("admin")$>
			<a href="javascript:allowRevDelete(document.deleteRevForm_<$dID$>);" class="xuiLinkText2_Sm">
				<$lc("wwDelete")$>
			</a>
		<$else$>
			<a href="javascript:showDelPopUp();" class="xuiLinkText2_Sm">
				<$lc("wwDelete")$>
			</a>
		<$endif$>
			
<@end@>

<!-- Handles AJAX-based batch-update of [Element] -> [Persons] relations, 
	 e.g. Account -> Persons, Org -> Persons. 
-->
<@dynamichtml ccla_cs_relation_ajax_update_js@>
	<script type="text/javascript">
		
		// Flag set after AJAX post of the Element-Persons relations form data.
		// Prevents multiple submissions.
		var isElementPersonRelationsUpdating = false;
		
		var isElementBankAccountRelationsUpdating = false;
		
		var isElementRelationsUpdating = false;
		
		// Relation Scope name strings are added here while they are being processed,
		// to prevent subsequent updates being dispatched from the same Relation
		// panel.
		var relationScopesUpdating = new Object();
		
		// Called after the user clicks the Update button at the bottom of an Element-
		// Persons Relations grid.
		function updateElementPersonRelations() {
			if (isElementPersonRelationsUpdating) {
				alert("A previous update is still processing - please wait for it to finish.");
				return false;
			}
		
			var personRelationsFormData = $("#frmPersonRelations").serialize();

			// Hide success/error messages
			$("#personRelationsSaveErrorMsg, #personRelationsSaveSuccessMsg").hide();
			
			// Display message indicating that an update is occurring.
			$("#personRelationsSavingMsg").show();

			// Do an AJAX POST request with the IsJson flag set,
			// this ensures we'll get a JSON response which can be
			// easily parsed in the callback function.
			isElementPersonRelationsUpdating = true;
			
			$.ajax({
				url: "?" + personRelationsFormData,
				dataType: "json",
				type: "POST",
				data: {"IsJson": 1},
				success: function(data) {
					personRelationsUpdated(data);
				}
			});
		}
		
		// Called after the user clicks the Update button at the bottom of an Element-
		// Persons Relations grid.
		function updateElementPersonRelations() {
			if (isElementPersonRelationsUpdating) {
				alert("A previous update is still processing - please wait for it to finish.");
				return false;
			}
		
			var personRelationsFormData = $("#frmPersonRelations").serialize();

			// Hide success/error messages
			$("#personRelationsSaveErrorMsg, #personRelationsSaveSuccessMsg").hide();
			
			// Display message indicating that an update is occurring.
			$("#personRelationsSavingMsg").show();

			// Do an AJAX POST request with the IsJson flag set,
			// this ensures we'll get a JSON response which can be
			// easily parsed in the callback function.
			isElementPersonRelationsUpdating = true;
			
			$.ajax({
				url: "?" + personRelationsFormData,
				dataType: "json",
				type: "POST",
				data: {"IsJson": 1},
				success: function(data) {
					personRelationsUpdated(data);
				}
			});
		}
		
		// Callback function after AJAX multiple contact data update.
		function personRelationsUpdated(jsonData) {
			$("#personRelationsSavingMsg").hide();
			
			// Could still be an error message in the JSON response.
			var errorMsg = getJsonErrorMsg(jsonData);
			
			if (errorMsg) {// Show the error mesage from the JSON response
				$("#personRelationsSaveErrorMsg").html(errorMsg).show();
			} else { // Show the successfully saved message
				$("#personRelationsSaveSuccessMsg").show();
			}
			
			isElementPersonRelationsUpdating = false;
		}
		
		// Called after the user clicks the Update button at the bottom of an Element-
		// Bank Account Relations grid.
		function updateElementBankAccountRelations() {
			if (isElementBankAccountRelationsUpdating) {
				alert("A previous update is still processing - please wait for it to finish.");
				return false;
			}
		
			var bankAccountRelationsFormData = $("#frmBankAccountRelations").serialize();

			// Hide success/error messages
			$("#bankAccountRelationsSaveErrorMsg, #bankAccountRelationsSaveSuccessMsg").hide();
			
			// Display message indicating that an update is occurring.
			$("#bankAccountRelationsSavingMsg").show();

			// Do an AJAX POST request with the IsJson flag set,
			// this ensures we'll get a JSON response which can be
			// easily parsed in the callback function.
			isElementBankAccountRelationsUpdating = true;
			
			$.ajax({
				url: "?" + bankAccountRelationsFormData,
				dataType: "json",
				type: "POST",
				data: {"IsJson": 1},
				success: function(data) {
					bankAccountRelationsUpdated(data);
				}
			});
		}
		
		// Callback function after AJAX multiple contact data update.
		function bankAccountRelationsUpdated(jsonData) {
			$("#bankAccountRelationsSavingMsg").hide();
			
			// Could still be an error message in the JSON response.
			var errorMsg = getJsonErrorMsg(jsonData);
			
			if (errorMsg) {// Show the error mesage from the JSON response
				$("#bankAccountRelationsSaveErrorMsg").html(errorMsg).show();
			} else { // Show the successfully saved message
				$("#bankAccountRelationsSaveSuccessMsg").show();
			}
			
			isElementBankAccountRelationsUpdating = false;
		}
		
		// Called after the user clicks the Update button at the bottom of an Element-
		// Relations grid.
		function updateElementRelations(relationScope) {
			if (relationScopesUpdating[relationScope]) {
				alert("A previous update is still processing - please wait for it to finish.");
				return false;
			}
		
			var frm = $("#frm" + relationScope + "Relations");
			
			if ($(frm).size() < 1)
				alert("Unable to update Element Relations: no associated form found with ID: " +
				 "#frm" + relationScope + "Relations");
		
			var relationsFormData = $(frm).serialize();
			
			// Hide success/error messages
			$("#" + relationScope + "RelationsSaveErrorMsg, " +
			  "#" + relationScope + "RelationsSaveSuccessMsg").hide();
			
			// Display message indicating that an update is occurring.
			$("#" + relationScope + "RelationsSavingMsg").show();
			
			relationScopesUpdating[relationScope] = true;
			
			// Do an AJAX POST request with the IsJson flag set,
			// this ensures we'll get a JSON response which can be
			// easily parsed in the callback function.
			$.ajax({
				url: "?" + relationsFormData,
				dataType: "json",
				type: "POST",
				data: {"IsJson": 1},
				success: function(data) {
					elementRelationsUpdated(data, relationScope);
				}
			});
		}
		
		// Callback function after AJAX multiple contact data update.
		function elementRelationsUpdated(jsonData, relationScope) {
			$("#" + relationScope + "RelationsSavingMsg").hide();
	
			relationScopesUpdating[relationScope] = false;
			
			// Could still be an error message in the JSON response.
			var errorMsg = getJsonErrorMsg(jsonData);
			
			if (errorMsg) {// Show the error mesage from the JSON response
				$("#" + relationScope + "RelationsSaveErrorMsg").html(errorMsg).show();
			} else { // Show the successfully saved message
				$("#" + relationScope + "RelationsSaveSuccessMsg").show();
			}
		}
		
	</script>
	
	<$if false$>
		<div id="personRelationsSavingMsg" class="message_panel loading_icon hiddenPanel">Updating relationships...</div>
		<div id="personRelationsSaveSuccessMsg" class="message_panel info_icon hiddenPanel">Relationships updated</div>
		<div id="personRelationsSaveErrorMsg" class="message_panel info_icon hiddenPanel">Error updating relationships</div>
	<$endif$>
	
<@end@>

<!-- Designed to work in conjunction with ccla_cs_relation_ajax_update_js
	 include.
	 
	 Should be placed just before any AJAX-enabled relation update grid.
	 
	 Includes three divs - only one will be displayed at any time (or none),
	 depending on the state of the AJAX update call (processing, success, failure).
	 
	 Requires a #local.relationScope variable in the binder - this is used to
	 uniquely identify this header panel on the page, e.g. 'person', 'account', 
	 'bankAccount'.
--> 
<@dynamichtml ccla_cs_relation_ajax_update_header_message_panels@>
	
	<$if not #local.relationScope$>
		WARNING: no relationScope specified in binder
	<$endif$>
	
	<div id="<$#local.relationScope$>RelationUpdateHeaderMessages">
	
		<div 	id="<$#local.relationScope$>RelationsSavingMsg" 
				class="message_panel loading_icon hiddenPanel">Updating relationships...</div>
		<div 	id="<$#local.relationScope$>RelationsSaveSuccessMsg" 
				class="message_panel info_icon hiddenPanel">Relationships updated</div>
		<div 	id="<$#local.relationScope$>RelationsSaveErrorMsg" 
				class="message_panel info_icon hiddenPanel">Error updating relationships</div>
				
	</div>			

<@end@>

<@dynamichtml ccla_cs_get_docname_from_docguid@>
[[% docGuid must be set before calling this include %]]
	<$docName = strSubstring(docGuid,0,strIndexOf(docGuid, ":"))$>
<@end@>

<!-- Sets a flag in the binder (allowChangeDefaultAddress) if the user is allowed to update/change
     the default contact address for a person/org. -->
<@dynamichtml ccla_cs_determine_if_user_permitted_default_address_update@>
	
	[[%Determine whether user is permitted to change default/nominated address. %]]
	<$allowChangeDefaultAddress=""$>
	
	<$exec rsMakeFromString("rsAddressRoles",#env.CCLA_CS_UpdateDefaultAddressRoles,"roleName")$>
	<$loop rsAddressRoles$>
		<$if userHasRole(roleName)$>
			<$allowChangeDefaultAddress=1$>
		<$endif$>
	<$endloop$>
						
<@end@>

<!-- Sets a flag in the binder (allowImportAuroraSignatories) if the user is allowed to 
	 import signatories from Aurora. -->
<@dynamichtml ccla_cs_determine_if_user_permitted_aurora_signatory_import@>
	
	[[%Determine whether user is permitted to change default/nominated address. %]]
	<$allowImportAuroraSignatories=""$>
	
	<$exec rsMakeFromString("rsImportSigRoles",#env.CCLA_CS_ImportAuroraSignatoriesRoles,"roleName")$>
	<$loop rsImportSigRoles$>
		<$if userHasRole(roleName)$>
			<$allowImportAuroraSignatories=1$>
		<$endif$>
	<$endloop$>
						
<@end@>

<!-- Displays detailed Aurora record comparison report for the current company in context. -->
<@dynamichtml ccla_cs_aurora_company_comparison_report@>

	<$rsLatestAmendment_Name = "rsFieldGroupAmendmentDates_CompanyId_" & #active.COMPANY_ID$>

	<table width="850" class="cs-info-table">
		<tr>
			<th width="20%">Comparison Outcome:</th>

			<td width="30%">
				<$companyOutcome = getValue("rsComparisonOutcome_CompanyId_" & #active.COMPANY_ID, "MATCH_OUTCOME")$>
				<$hasComparisonData = getValue("rsComparisonOutcome_CompanyId_" & #active.COMPANY_ID, "HAS_COMPARISON_DATA")$>
			
				<$if companyOutcome like "INVALID_DATA"$>
					<div class="check-status-box red-status-box">&nbsp;</div> &nbsp; INVALID DATA
				<$elseif companyOutcome like "NO_AURORA_DATA"$>
					<div class="check-status-box amber-status-box">&nbsp;</div> &nbsp; NO AURORA RECORD
				<$elseif companyOutcome like "MATCH"$>
					<div class="check-status-box green-status-box">&nbsp;</div> &nbsp; MATCHED
				<$elseif companyOutcome like "MISMATCH"$>
					<div class="check-status-box green-status-box">&nbsp;</div> &nbsp; MATCHED
				<$elseif companyOutcome like "CRITICAL_MISMATCH"$>
					<div class="check-status-box red-status-box">&nbsp;</div> &nbsp; CRITICAL MISMATCH
				<$endif$>
			</td>
			
			<th width="20%">Central DB ID:</th><td width="30%"><$#local.ELEMENT_ID$></td>
		</tr>
		<tr>
			<th>Message:</th>
			
			<td>
				<$getValue("rsComparisonOutcome_CompanyId_" & #active.COMPANY_ID, "ERROR_MESSAGE")$>
			</td>
			
			<th>Field Group Mismatches:</th>
			
			<td>
				<$if hasComparisonData == 1$>
					<$getValue("rsComparisonOutcome_CompanyId_" & #active.COMPANY_ID, "MISMATCHED_GROUP_NAMES")$>
				<$else$>
					N/A
				<$endif$>
			</td>
		</tr>
		
		<tr>
			<th></th>
			
			<td>
				
			</td>
			
			<th>Field Groups updated since <$formatDateOnly(#local.AmendmentLimitDate)$>:</th>
			
			<td>
				<$getValue("#local","AmendedFieldGroups_CompanyId_" & #active.COMPANY_ID)$>
			</td>
		</tr>
	</table>

	<$if hasComparisonData == 1$>	
		<h3>Field Group Comparisons</h3>
	
		<$loop rsFieldGroups$>
			<$rsDetail_Name = "rsComparisonDetail_CompanyId_" & #active.COMPANY_ID & "_FieldGroup_" & #active.FIELDGROUP_NAME$>

			<table width="850" class="cs-info-table">
				<tr>
					<th width="20%">Field Group:</th>
					
					<td width="30%">
						<$#active.FIELDGROUP_NAME$>
					</td>
					
					<th width="20%">Description:</th>
					
					<td width="30%">
						<$#active.FIELDGROUP_LABEL$>
					</td>
				</tr>
				
				<tr>
					<th width="20%">Comparison Outcome:</th>
					
					<td width="30%">
						<$if rsFindRowPrimary("rsMismatchedGroupNames_CompanyId_" & #active.COMPANY_ID,#active.FIELDGROUP_NAME)$>
							<$if #active.FIELDGROUP_ISCRITICAL == 1$>
								<div class="check-status-box red-status-box">&nbsp;</div> &nbsp; MISMATCHED
							<$else$>
								<div class="check-status-box amber-status-box">&nbsp;</div> &nbsp; MISMATCHED
							<$endif$>
						<$else$>
							<div class="check-status-box green-status-box">&nbsp;</div> &nbsp; MATCHED
						<$endif$>
					</td>
					
					<th width="20%">Critical Group:</th>
					
					<td width="30%">
						<$if #active.FIELDGROUP_ISCRITICAL == 1$>
							Yes
						<$else$>
							No
						<$endif$>
					</td>
				</tr>
				
				<tr>
					<th>Last Central DB Update:</th>
					
					<td>
						<$exec rsFirst(rsLatestAmendment_Name)$>
						<$loopwhile getValue(rsLatestAmendment_Name, "#isRowPresent")$>
							<$if getValue(rsLatestAmendment_Name, "FIELDGROUP_NAME") like #active.FIELDGROUP_NAME$>
								<$getValue(rsLatestAmendment_Name, "LATEST_AMENDMENT_DATE")$>
							<$endif$>
							
							<$exec rsNext(rsLatestAmendment_Name)$>
						<$endloop$>
					</td>
				
			</table>
			
			<br/>

			<table class="accounts-table" width="850" cellpadding=0 cellspacing=0>			
				<tr>
					<th class="first-col" width=30%>
						Field Name
					</th>
					
					<th width=30%>
						Central DB Value
					</th>
					
					<th width=30%>
						Aurora Value
					</th>
					
					<th width=10%>
						Match
					</th>
				</tr>

				<$exec rsFirst(rsDetail_Name)$>
				<$loopwhile getValue(rsDetail_Name, "#isRowPresent")$>
					
					<tr class="account-details-row"> 
						<$if getValue(rsDetail_Name,"IS_MISMATCHED") == 1$>
							<$isFieldMatched = "No"$>
						<$else$>
							<$isFieldMatched = "Yes"$>
						<$endif$>
				
						<td class="first-col">
							<$getValue(rsDetail_Name,"FIELD_NAME")$>
						</td>
						
						<td>
							<$getValue(rsDetail_Name,"VALUE_1")$>
						</td>
						
						<td>
							<$getValue(rsDetail_Name,"VALUE_2")$>
						</td>
						
						<td align=center>
							<$if getValue(rsDetail_Name,"IS_MISMATCHED") == 1$>
								<$if #active.FIELDGROUP_ISCRITICAL == 1$>
									<div class="check-status-box red-status-box">&nbsp;</div>
								<$else$>
									<div class="check-status-box amber-status-box">&nbsp;</div>
								<$endif$>
							<$else$>
								<div class="check-status-box green-status-box">&nbsp;</div>
							<$endif$>
						</td>
					</tr>
					
					<$exec rsNext(rsDetail_Name)$>
				<$endloop$>

			</table>
			
			<br/>

		<$endloop$>
	<$endif$>
	
<@end@>

</body></html>