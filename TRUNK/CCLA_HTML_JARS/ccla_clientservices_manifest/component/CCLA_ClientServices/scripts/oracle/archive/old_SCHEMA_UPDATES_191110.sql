
update ref_relation_names set relation='Signatory', short_name='Sig' where relation='Ordinary Signatory';

update ref_relation_names set relation='Trustee', short_name='Trst' where relation='Ordinary Trustee';

/* FIND OUT IF THERE ARE ANY BENEFICIARIES SET, IF SO THEN MAKE A NOTE OF THEM AND THEN REMOVE THEM*/

select * from relations where relation_name_id in (21,85)

update ref_relation_names set relation='Director', short_name='Dir' where relation='Beneficiary';

/* MOVE AUTH SIG TO SIG*/
UPDATE RELATIONS SET RELATION_NAME_ID = 5 WHERE RELATION_NAME_ID=4
UPDATE RELATIONS SET RELATION_NAME_ID =84 WHERE RELATION_NAME_ID=83

/* MAKE SURE THERE ARE NONE LEFT */
SELECT * FROM RELATIONS WHERE RELATION_NAME_ID IN (4,83);

/* REMOVE THEM*/
DELETE FROM REF_RELATION_NAMES WHERE RELATION_NAME_ID IN (4,83);

/* recreate view*/
CREATE OR REPLACE FORCE VIEW "UCMADMIN"."CCLA_CLIENTS_AML_CAMPAIGN" ("CLIENT_NUMBER", "COMPANY_CODE", "ORGANISATION_NAME", "DATE_ENROLLED", "AML_ID", "CORRESPONDENT_STATUS", "PROPOSED_DISTRIBUTION", "DISTRIBUTION_DATE", "DISTRIBUTION_TYPE", "CORRESPONDENT_RESPONSE_TYPE", "CORRESPONDENT_OVERRIDE", "CORRESPONDENT_RESPONDED", "CORRESPONDENT_ONHOLD", "CORRESPONDENT_ONHOLD_DATE", "CORRESPONDENT_IVS_PRE1207", "CORRESPONDENT_IVS_CHECK_DATE", "CORRESPONDENT_QRS_CLIENT", "CORRESPONDENT_REQUESTED", "CORRESPONDENT_ACCOUNT_CLOSED", "NOMINEE_CLIENT")
AS
  SELECT cm.client_number,
    rc.COMPANY_CODE,
    cl.organisation_name,
    cl.date_enrolled,
    aml.AML_ID,
    aml.CORRESPONDENT_STATUS,
    aml.PROPOSED_DISTRIBUTION,
    aml.DISTRIBUTION_DATE,
    aml.DISTRIBUTION_TYPE,
    aml.CORRESPONDENT_RESPONSE_TYPE,
    aml.CORRESPONDENT_OVERRIDE,
    aml.CORRESPONDENT_RESPONDED,
    aml.CORRESPONDENT_ONHOLD,
    aml.CORRESPONDENT_ONHOLD_DATE,
    aml.CORRESPONDENT_IVS_PRE1207,
    aml.CORRESPONDENT_IVS_CHECK_DATE,
    aml.CORRESPONDENT_QRS_CLIENT,
    aml.CORRESPONDENT_REQUESTED,
    aml.CORRESPONDENT_ACCOUNT_CLOSED,
    DECODE(INSTR(UPPER(cl.ORGANISATION_NAME), 'NOMINEE'), 0, 0, 1) NOMINEE_CLIENT
  FROM ORGANISATION cl
  INNER JOIN CLIENT_AURORA_MAP cm
  ON (cm.organisation_id = cl.organisation_id)
  INNER JOIN ref_company rc
  ON (rc.company_id = cm.company_id)
  INNER JOIN CCLA_AML_CHECKLIST aml
  ON (cm.CLIENT_NUMBER = aml.CLIENT_NUMBER
  AND rc.COMPANY_CODE  = aml.COMPANY)
  WHERE NOT EXISTS
    (SELECT cl.organisation_id
    FROM CCLA_PROCESS pr
    WHERE cl.organisation_id = pr.organisation_id
    AND PR.CAMPAIGN_ID       = 2
    );

/* Fetches all PROCESS_ID values which require their status updated to 'Forms returned' */
UPDATE CCLA_PROCESS prs SET prs.PROCESS_STATUS = 'Forms returned'

WHERE prs.PROCESS_ID IN 
  (
    SELECT pr.PROCESS_ID FROM CCLA_PROCESS pr INNER JOIN 
    
      (SELECT frm.* FROM CCLA_FORM frm INNER JOIN
        (SELECT MAX(FORM_ID) AS LATEST_FORM_ID, PROCESS_ID 
        FROM CCLA_FORM GROUP BY PROCESS_ID, BASE_DOCNAME) frmLatest 
        
        ON (frm.FORM_ID = frmLatest.LATEST_FORM_ID)
      ) prFrm
      
      ON (prFrm.PROCESS_ID = pr.PROCESS_ID AND pr.CAMPAIGN_ID=2 AND pr.PROCESS_STATUS = 'Forms printed')
      
    MINUS
    
    SELECT pr.PROCESS_ID FROM CCLA_PROCESS pr INNER JOIN 
    
      (SELECT frm.* FROM CCLA_FORM frm INNER JOIN
        (SELECT MAX(FORM_ID) AS LATEST_FORM_ID, PROCESS_ID 
        FROM CCLA_FORM GROUP BY PROCESS_ID, BASE_DOCNAME) frmLatest 
        
        ON (frm.FORM_ID = frmLatest.LATEST_FORM_ID AND frm.RETURNED = '0')
      ) prFrm
      
      ON (prFrm.PROCESS_ID = pr.PROCESS_ID AND pr.CAMPAIGN_ID=2 AND pr.PROCESS_STATUS = 'Forms printed')
  );
  
/* Create table SYNC */
CREATE TABLE REF_RELATION_NAMES_SYNC (
  RELATION_NAME_SYNC_ID NUMBER(15,0),
  RELATION_NAME_ID1 NUMBER(15,0),
  RELATION_NAME_ID2 NUMBER(15,0),
  SYNC_TYPE VARCHAR2(20 CHAR),
  ACTION VARCHAR2(10 CHAR)
);

REM INSERTING into REF_RELATION_NAMES_SYNC
Insert into REF_RELATION_NAMES_SYNC (RELATION_NAME_SYNC_ID,RELATION_NAME_ID1,RELATION_NAME_ID2,SYNC_TYPE,ACTION) values (1,80,1,'COPY','ADD');
Insert into REF_RELATION_NAMES_SYNC (RELATION_NAME_SYNC_ID,RELATION_NAME_ID1,RELATION_NAME_ID2,SYNC_TYPE,ACTION) values (2,81,2,'COPY','ADD');
Insert into REF_RELATION_NAMES_SYNC (RELATION_NAME_SYNC_ID,RELATION_NAME_ID1,RELATION_NAME_ID2,SYNC_TYPE,ACTION) values (3,82,3,'COPY','ADD');
Insert into REF_RELATION_NAMES_SYNC (RELATION_NAME_SYNC_ID,RELATION_NAME_ID1,RELATION_NAME_ID2,SYNC_TYPE,ACTION) values (4,84,5,'COPY','ADD');
Insert into REF_RELATION_NAMES_SYNC (RELATION_NAME_SYNC_ID,RELATION_NAME_ID1,RELATION_NAME_ID2,SYNC_TYPE,ACTION) values (5,1,80,'DELETE','REMOVE');
Insert into REF_RELATION_NAMES_SYNC (RELATION_NAME_SYNC_ID,RELATION_NAME_ID1,RELATION_NAME_ID2,SYNC_TYPE,ACTION) values (6,2,81,'DELETE','REMOVE');
Insert into REF_RELATION_NAMES_SYNC (RELATION_NAME_SYNC_ID,RELATION_NAME_ID1,RELATION_NAME_ID2,SYNC_TYPE,ACTION) values (7,3,82,'DELETE','REMOVE');
Insert into REF_RELATION_NAMES_SYNC (RELATION_NAME_SYNC_ID,RELATION_NAME_ID1,RELATION_NAME_ID2,SYNC_TYPE,ACTION) values (8,5,84,'DELETE','REMOVE');
Insert into REF_RELATION_NAMES_SYNC (RELATION_NAME_SYNC_ID,RELATION_NAME_ID1,RELATION_NAME_ID2,SYNC_TYPE,ACTION) values (9,86,9,'COPY','ADD');
Insert into REF_RELATION_NAMES_SYNC (RELATION_NAME_SYNC_ID,RELATION_NAME_ID1,RELATION_NAME_ID2,SYNC_TYPE,ACTION) values (10,87,10,'COPY','ADD');
Insert into REF_RELATION_NAMES_SYNC (RELATION_NAME_SYNC_ID,RELATION_NAME_ID1,RELATION_NAME_ID2,SYNC_TYPE,ACTION) values (11,9,86,'DELETE','REMOVE');
Insert into REF_RELATION_NAMES_SYNC (RELATION_NAME_SYNC_ID,RELATION_NAME_ID1,RELATION_NAME_ID2,SYNC_TYPE,ACTION) values (12,10,87,'DELETE','REMOVE');

/* as dbadmin*/
CREATE PUBLIC SYNONYM REF_RELATION_NAMES_SYNC FOR CCLA.REF_RELATION_NAMES_SYNC;
GRANT ALL ON REF_RELATION_NAMES_SYNC TO UCMADMIN;

CREATE PUBLIC SYNONYM DOCMETADEFINITION FOR UCMADMIN.DOCMETADEFINITION;
GRANT ALL ON DOCMETADEFINITION TO UCMADMIN;

CREATE PUBLIC SYNONYM REF_DUAL_INDEX_FIELDS FOR UCMADMIN.REF_DUAL_INDEX_FIELDS;
GRANT ALL ON REF_DUAL_INDEX_FIELDS TO UCMADMIN;

  
  
  