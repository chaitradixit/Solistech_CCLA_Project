CREATE OR REPLACE FORCE VIEW "CCLA"."V_PSDF_ENROLMENT_ACTIVITY_LAST" ("PROCESS_ID", "CAMPAIGN_ACTIVITY_ID", "PERSON_ID", "FULL_NAME", "ORGANISATION_ID", "ORG_ACCOUNT_CODE", "INTENTION_UNITS", "INTENTION_STATUS_ID", "INTENTION_STATUS_NAME", "USER_ID", "ACTIVITY_DATE", "ACTIVITY_TYPE", "ACTIVITY_ACTION", "CLIENT_STATUS", "PROCESS_STATUS", "PROCESS_DATE", "LAST_ACTION", "PROCESS_ENTITY_ID", "CAMPAIGN_ID", "CAMPAIGN_NAME", "ORGANISATION_NAME")
AS
  (SELECT CE.CAMPAIGN_ENROLMENT_ID AS PROCESS_ID,
    CA.CAMPAIGN_ACTIVITY_ID,
    CE.PERSON_ID,
    P.FULL_NAME,
    CE.ORGANISATION_ID,
    ORG.ORG_ACCOUNT_CODE,
    FII.UNITS                   AS INTENTION_UNITS,
    FII.INVINTENTSTATUS_ID      AS INTENTION_STATUS_ID,
    RIIS.INVINTENTSTATUS_NAME	  AS INTENTION_STATUS_NAME,
    CA.LAST_UPDATED_BY          AS USER_ID,
    CA.DATE_ADDED               AS ACTIVITY_DATE,
    RCAT.CAMPAIGN_ACTIVITY_NAME AS ACTIVITY_TYPE,
    CA.ACTIVITY_DESCRIPTION     AS ACTIVITY_ACTION,
    RCSS.CAMPSUBJECTSTATUS_NAME AS CLIENT_STATUS,
    RCE.ENROLMENT_STATUS_NAME   AS PROCESS_STATUS,
    CE.DATE_ADDED               AS PROCESS_DATE,
    CE.LAST_UPDATED             AS LAST_ACTION,
    CE.ORGANISATION_ID          AS PROCESS_ENTITY_ID,
    CE.CAMPAIGN_ID,
    C.CAMPAIGN_NAME,
    org.ORGANISATION_NAME
  FROM CAMPAIGN_ENROLMENT CE
  INNER JOIN REF_CAMPAIGN_ENROLMENT_STATUS RCE
  ON (CE.ENROLMENT_STATUS_ID = RCE.ENROLMENT_STATUS_ID)
  INNER JOIN REF_CAMPAIGN_SUBJECT_STATUS RCSS
  ON (CE.CAMPSUBJECTSTATUS_ID = RCSS.CAMPSUBJECTSTATUS_ID)
  LEFT JOIN CAMPAIGN_ACTIVITY CA
  ON (CE.CAMPAIGN_ENROLMENT_ID=CA.CAMPAIGN_ENROLMENT_ID)
  LEFT JOIN FUND_INVESTMENT_INTENTION FII
  ON (CE.ORGANISATION_ID = FII.ORGANISATION_ID)
  LEFT JOIN (REF_INVESTMENT_INTENT_STATUS RIIS)
  ON (FII.INVINTENTSTATUS_ID = RIIS.INVINTENTSTATUS_ID
  AND FII.CAMPAIGN_ID    =10)
  INNER JOIN REF_CAMPAIGN_ACTIVITY_TYPE RCAT
  ON (CA.CAMPAIGN_ACTIVITY_TYPE_ID = RCAT.CAMPAIGN_ACTIVITY_TYPE_ID)
  INNER JOIN CAMPAIGN C
  ON (CE.CAMPAIGN_ID = C.CAMPAIGN_ID)
  LEFT JOIN PERSON P
  ON (CE.PERSON_ID = P.PERSON_ID)
  LEFT JOIN ORGANISATION org
  ON (CE.ORGANISATION_ID        = org.ORGANISATION_ID)
  WHERE CA.CAMPAIGN_ACTIVITY_ID =
    (SELECT MAX(CAMPAIGN_ACTIVITY_ID)
    FROM CAMPAIGN_ACTIVITY
    WHERE CAMPAIGN_ACTIVITY.CAMPAIGN_ENROLMENT_ID = CE.CAMPAIGN_ENROLMENT_ID
    )
  );
  
  CREATE OR REPLACE PUBLIC SYNONYM V_PSDF_ENROLMENT_ACTIVITY_LAST FOR CCLA.V_PSDF_ENROLMENT_ACTIVITY_LAST;
  
  GRANT ALL ON V_PSDF_ENROLMENT_ACTIVITY_LAST TO UCMADMIN;