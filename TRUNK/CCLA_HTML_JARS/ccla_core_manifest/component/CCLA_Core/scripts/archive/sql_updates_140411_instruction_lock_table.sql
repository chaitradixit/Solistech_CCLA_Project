-- Table INSTRUCTION_LOCK

CREATE TABLE INSTRUCTION_LOCK(
  INSTRUCTION_ID Number(15,0) NOT NULL,
  MODULE_ID Number(15,0) CONSTRAINT INSTRLOCK_MODULEID_NN NOT NULL,
  LOCK_DATE Timestamp(6) CONSTRAINT INSTRLOCK_LOCKDATE_NN NOT NULL,
  IS_SUSPENDED Number(1,0) CONSTRAINT INSTRLOCK_SUSPENDED_NN NOT NULL
)
/

-- Add keys for table INSTRUCTION_LOCK

ALTER TABLE INSTRUCTION_LOCK ADD CONSTRAINT INSTRLOCK_PK PRIMARY KEY (INSTRUCTION_ID)
/

-- Table and Columns comments section
  
COMMENT ON TABLE INSTRUCTION_LOCK IS 'Used to hold locks between routing modules and instructions. An instruction may only be locked by one module at a time.'
/


CREATE INDEX INSTR_INSTRLOCK_IX ON INSTRUCTION_LOCK (INSTRUCTION_ID) 
/
ALTER TABLE INSTRUCTION_LOCK ADD CONSTRAINT INSTR_INSTRLOCK_FK FOREIGN KEY (INSTRUCTION_ID) REFERENCES INSTRUCTION (INSTRUCTION_ID)
/

CREATE INDEX INSTR_INSTRLOCK_IX ON INSTRUCTION_LOCK (MODULE_ID) 
/
ALTER TABLE INSTRUCTION_LOCK ADD CONSTRAINT IRMODULE_INSTRLOCK_FK FOREIGN KEY (MODULE_ID) REFERENCES INSTRUCTION_ROUTING_MODULE (MODULE_ID)
/

CREATE OR REPLACE PUBLIC SYNONYM INSTRUCTION_LOCK FOR CCLA.INSTRUCTION_LOCK;

GRANT ALL ON INSTRUCTION_LOCK TO UCMADMIN;