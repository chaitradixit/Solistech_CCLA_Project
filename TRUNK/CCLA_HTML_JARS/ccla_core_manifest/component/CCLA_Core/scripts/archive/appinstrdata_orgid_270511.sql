-- Set Org ID as required for all Instruction Types, that don't have the field mapping set already
INSERT INTO APPLICABLE_INSTRUCTION_DATA
SELECT SEQ_APPLICABLE_INSTR_DATA.NEXTVAL, 9, INSTRUCTION_TYPE_ID, 0
FROM REF_INSTRUCTION_TYPE
WHERE INSTRUCTION_TYPE_ID NOT IN
(SELECT INSTRUCTION_TYPE_ID FROM APPLICABLE_INSTRUCTION_DATA WHERE INSTRUCTION_DATA_ID = 9);

-- Ensure Org ID is required for all instruction types to begin with
UPDATE APPLICABLE_INSTRUCTION_DATA
SET IS_OPTIONAL = 0
WHERE INSTRUCTION_DATA_ID = 9;

-- Set Org ID as required for the specials
UPDATE APPLICABLE_INSTRUCTION_DATA
SET IS_OPTIONAL = 1
WHERE INSTRUCTION_DATA_ID = 9
AND INSTRUCTION_TYPE_ID IN
 (SELECT INSTRUCTION_TYPE_ID FROM REF_INSTRUCTION_TYPE
 WHERE INSTRUCTION_TYPE_NAME IN ('CONDINS','DICONDIN','GEN','MMCONFIRM','OTHERS','CONCORR','CONTRACTS','CRMCORR','CSLETTERS','MKTCORR','PROPCORR','TOPANEL'));
 
-- Add new 'SPP Release Failure' instruction process
REM INSERTING into REF_INSTRUCTION_PROCESS
Insert into REF_INSTRUCTION_PROCESS (INSTRUCTION_PROCESS_ID,PROCESS_NAME,PROCESS_DESCRIPTION,USER_GROUPS,IDOC_INCLUDE) values (2,'SPP Release Failure','There was a problem sending the instruction to SPP. It may have triggered a job previously.',null,null);

-- Add applied actions for new process.
REM INSERTING into INSTR_PROCESS_ACTION_APPLIED
Insert into INSTR_PROCESS_ACTION_APPLIED (INSTRUCTION_PROCESS_ID,INSTRUCTION_ACTION_ID,APPLIED_ACTION_LABEL,APPLIED_ACTION_DESCRIPTION) values (2,1,'Retry submission','Tries to start the SPP job again. This won''t work if there is a UCM_JOB_ID value set against the instruction - remove this first to trigger the job.');
Insert into INSTR_PROCESS_ACTION_APPLIED (INSTRUCTION_PROCESS_ID,INSTRUCTION_ACTION_ID,APPLIED_ACTION_LABEL,APPLIED_ACTION_DESCRIPTION) values (2,2,'Mark as Released','Updates the instruction status to Released to SPP');
Insert into INSTR_PROCESS_ACTION_APPLIED (INSTRUCTION_PROCESS_ID,INSTRUCTION_ACTION_ID,APPLIED_ACTION_LABEL,APPLIED_ACTION_DESCRIPTION) values (2,3,'Mark as Failed','Updates the instruction status to Failed SPP Release');
