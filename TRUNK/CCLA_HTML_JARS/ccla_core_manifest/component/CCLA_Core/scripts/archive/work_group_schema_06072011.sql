-- Table REF_WORK_GROUP

-- Create tables section -------------------------------------------------

-- Table REF_WORK_GROUP

CREATE TABLE REF_WORK_GROUP(
  WORK_GROUP_ID Number(15,0) NOT NULL,
  WORK_GROUP_NAME Varchar2(60 ) CONSTRAINT WORKGROUP_NAME_NN NOT NULL,
  WORK_GROUP_DESCRIPTION Varchar2(500 ),
  BUNDLE_QUERY_NAME Varchar2(120 ),
  BUNDLE_QUERY_PARAMS Varchar2(200 )
)
/

-- Add keys for table REF_WORK_GROUP

ALTER TABLE REF_WORK_GROUP ADD CONSTRAINT WORKGROUP_PK PRIMARY KEY (WORK_GROUP_ID)
/

-- Table and Columns comments section
  
COMMENT ON TABLE REF_WORK_GROUP IS 'List of user work groups. Each entry currently identifies the work which is allocated to any users mapped to the Work Group via the USER_WORK_GROUP table.'
/

-- Table USER_WORK_GROUP

CREATE TABLE USER_WORK_GROUP(
  USER_WORK_GROUP_ID Number(15,0) NOT NULL,
  USER_ID Varchar2(50 ) CONSTRAINT USERWORKGROUP_USERID_NN NOT NULL,
  WORK_GROUP_ID Number(15,0) CONSTRAINT USERWORKGROUP_GROUPID_NN NOT NULL,
  LAST_UPDATED Timestamp(6) CONSTRAINT USERWORKGROUP_DATE_NN NOT NULL
)
/

-- Add keys for table USER_WORK_GROUP

ALTER TABLE USER_WORK_GROUP ADD CONSTRAINT USERWORKGROUP_PK PRIMARY KEY (USER_WORK_GROUP_ID)
/

ALTER TABLE USER_WORK_GROUP ADD CONSTRAINT USERWORKGROUP_UQ UNIQUE (USER_ID)
/

-- Create relationships section ------------------------------------------------- 

CREATE INDEX WORKGROUP_USERWORKGROUP_IX ON USER_WORK_GROUP (WORK_GROUP_ID) 
/
ALTER TABLE USER_WORK_GROUP ADD CONSTRAINT WORKGROUP_USERWORKGROUP_FK FOREIGN KEY (WORK_GROUP_ID) REFERENCES REF_WORK_GROUP (WORK_GROUP_ID)
/

ALTER TABLE USER_WORK_GROUP ADD CONSTRAINT USERS_USERWORKGROUP_FK FOREIGN KEY (USER_ID) REFERENCES UCMADMIN.USERS (DNAME)
/

-- Sequence for USER_WORK_GROUP
CREATE SEQUENCE SEQ_USER_WORK_GROUP;

CREATE OR REPLACE PUBLIC SYNONYM REF_WORK_GROUP FOR CCLA.REF_WORK_GROUP;
CREATE OR REPLACE PUBLIC SYNONYM USER_WORK_GROUP FOR CCLA.USER_WORK_GROUP;
CREATE OR REPLACE PUBLIC SYNONYM SEQ_USER_WORK_GROUP FOR CCLA.SEQ_USER_WORK_GROUP;

GRANT ALL ON REF_WORK_GROUP TO UCMADMIN;
GRANT ALL ON USER_WORK_GROUP TO UCMADMIN;
GRANT ALL ON SEQ_USER_WORK_GROUP TO UCMADMIN;


-- Work Groups data load
REM INSERTING into REF_WORK_GROUP
Insert into REF_WORK_GROUP (WORK_GROUP_ID,WORK_GROUP_NAME,WORK_GROUP_DESCRIPTION,BUNDLE_QUERY_NAME,BUNDLE_QUERY_PARAMS) values (1,'All items','Fetches all pending bundles','QGetNextPendingBundle',null);
Insert into REF_WORK_GROUP (WORK_GROUP_ID,WORK_GROUP_NAME,WORK_GROUP_DESCRIPTION,BUNDLE_QUERY_NAME,BUNDLE_QUERY_PARAMS) values (2,'All Mandates','Fetches all pending bundles containing an indexed Mandate instruction, or anything from SCANUSER3','QGetNextPendingMandateBundle',null);
Insert into REF_WORK_GROUP (WORK_GROUP_ID,WORK_GROUP_NAME,WORK_GROUP_DESCRIPTION,BUNDLE_QUERY_NAME,BUNDLE_QUERY_PARAMS) values (3,'BAU Mandates','Fetches all pending scanned bundles from SCANUSER3','QGetNextPendingBundleWithScanUser','scanUser=SCANUSER3');
Insert into REF_WORK_GROUP (WORK_GROUP_ID,WORK_GROUP_NAME,WORK_GROUP_DESCRIPTION,BUNDLE_QUERY_NAME,BUNDLE_QUERY_PARAMS) values (4,'Historic Invoices','Fetches all pending scanned bundles from SCANUSER4','QGetNextPendingBundleWithScanUser','scanUser=SCANUSER4');

-- User Work Group data load (Mandate guys)
Insert into USER_WORK_GROUP
SELECT SEQ_USER_WORK_GROUP.NEXTVAL, DNAME, 2, SYSDATE
FROM UCMADMIN.USERS WHERE DNAME IN 
('CCLA\j.may','CCLA\j.demetris','CCLA\k.louch','CCLA\s.edwards','CCLA\a.akomian','CCLA\s.sensecall','CCLA\a.suleyman','CCLA\d.bowman','CCLA\g.bryant');

-- User Work Group data load (Historic invoices)
Insert into USER_WORK_GROUP
SELECT SEQ_USER_WORK_GROUP.NEXTVAL, DNAME, 4, SYSDATE
FROM UCMADMIN.USERS WHERE DNAME IN 
('CCLA\d.konopka');

