
CREATE TABLE COMM_SIGNATURE(
  COMM_SIGNATURE_ID Char(20 ) NOT NULL,
  DOCNAME Varchar2(90 ),
  COMM_ID Number(15,0),
  PERSON_ID Number(15,0) CONSTRAINT COMMSIG_PERSON_NN NOT NULL,
  MATCH_TYPE Varchar2(30 ) CONSTRAINT COMMSIG_MATCHTYPE_NN NOT NULL,
  USER_ID Varchar2(90 ) CONSTRAINT COMMSIG_USER_NN NOT NULL,
  DATE_ADDED Timestamp(6) CONSTRAINT COMMSIG_DATE_NN NOT NULL,
  CONSTRAINT COMM_SIGNATURE_SRC_CHK CHECK (NOT (DOCNAME IS NULL AND COMM_ID IS NULL))
)
/

ALTER TABLE COMM_SIGNATURE ADD CONSTRAINT COMM_SIGNATURE_PK PRIMARY KEY (COMM_SIGNATURE_ID)
/

COMMENT ON TABLE COMM_SIGNATURE IS 'Signature checking requires 1 table to store the signatures of Persons identified on a particular document/communication.

To begin with, all signatures will be mapped to UCM documents only (i.e. DOCNAME). The COMM_ID is provided here for future implementations. Either the DOCNAME or COMM_ID value must be non-null.

If a map entry exists in this table, it indicates the Person’s signature was found on the document.'
/




-- Table PERSON_SIGNATURE

CREATE TABLE PERSON_SIGNATURE(
  PERSON_ID Number(15,0) CONSTRAINT PSIG_PERSONID_NN NOT NULL,
  SIGNATURE_DOCNAME Varchar2(60 ) CONSTRAINT PSIG_DOCNAME_NN NOT NULL,
  DATE_ADDED Timestamp(6) CONSTRAINT PSIG_DATEADDED_NN NOT NULL,
  LAST_UPDATED Timestamp(6) CONSTRAINT PSIG_LASTUPDATED_NN NOT NULL,
  USER_ID Varchar2(90 ) CONSTRAINT PSIG_USERID_NN NOT NULL
)
/

-- Add keys for table PERSON_SIGNATURE

ALTER TABLE PERSON_SIGNATURE ADD CONSTRAINT PERSON_SIGNATURE_PK PRIMARY KEY (PERSON_ID)
/

-- Table and Columns comments section
  
COMMENT ON COLUMN PERSON_SIGNATURE.SIGNATURE_DOCNAME IS 'UCM Content ID for the signature image'
/

CREATE INDEX IX_PERSON_PSIG_FK ON PERSON_SIGNATURE (PERSON_ID) 
/
ALTER TABLE PERSON_SIGNATURE ADD CONSTRAINT PERSON_PSIG_FK FOREIGN KEY (PERSON_ID) REFERENCES PERSON (PERSON_ID)
/

CREATE OR REPLACE PUBLIC SYNONYM COMM_SIGNATURE FOR CCLA.COMM_SIGNATURE;
CREATE OR REPLACE PUBLIC SYNONYM PERSON_SIGNATURE FOR CCLA.PERSON_SIGNATURE;

GRANT ALL ON COMM_SIGNATURE TO UCMADMIN;
GRANT ALL ON PERSON_SIGNATURE TO UCMADMIN;

CREATE SEQUENCE "UCMADMIN"."SEQ_APPROVED_SIG" MINVALUE 1 MAXVALUE 999999999999 INCREMENT BY 1 START WITH 167 NOCACHE NOORDER NOCYCLE ;