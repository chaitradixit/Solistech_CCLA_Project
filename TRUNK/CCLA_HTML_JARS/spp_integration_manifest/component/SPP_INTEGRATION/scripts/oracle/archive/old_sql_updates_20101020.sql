/** Add new column to DOCUMENT_CLASSES table. */
ALTER TABLE "DOCUMENT_CLASSES" ADD ("PRIORITY" NUMBER(6,0));

UPDATE DOCUMENT_CLASSES SET PRIORITY = 2;

CREATE TABLE "JOB_PRIORITY_RULES" (
	"RULE_ID" 		NUMBER(15,0) NOT NULL,
	
	"RULE_NAME" 	VARCHAR2(100 CHAR) NOT NULL,
	"RULE_FIELD"	VARCHAR2(50 CHAR) NOT NULL,
	"RULE_TYPE"		VARCHAR2(50 CHAR) NOT NULL,
	"RULE_ORDER"	NUMBER(15,0) NOT NULL,
	"IS_ENABLED"	NUMBER(1,0) NOT NULL,
	
	CONSTRAINT "JOB_PRIORITY_RULE_PK" PRIMARY KEY ("RULE_ID")
);

CREATE TABLE "JOB_PRIORITY_RULE_VALUES" (
	"RULE_VALUE_ID"	NUMBER(15,0) NOT NULL,
	"RULE_ID" 		NUMBER(15,0) NOT NULL,
		
	"FIELD_VALUE" 	VARCHAR2(100 CHAR) NOT NULL,
	"PRIORITY"		NUMBER(3,0) NOT NULL,
	
	CONSTRAINT "JOB_PRIORITY_RULE_VALUES_PK" PRIMARY KEY ("RULE_VALUE_ID"),
	CONSTRAINT "JOB_PRIORITY_RULE_VALUES_FK" FOREIGN KEY ("RULE_ID") REFERENCES "JOB_PRIORITY_RULES" ("RULE_ID")
);

/* Fund dealing dates. */

CREATE TABLE "CCLA_FUND_DEALING_DATES" (
	"DEALING_DATE_ID"	NUMBER(15,0) NOT NULL,
	"FUND_CODE"			VARCHAR2 (10 CHAR) NOT NULL,
	"DEALING_DATE"		TIMESTAMP(6) NOT NULL,
	
	CONSTRAINT "FUND_DEALING_DATES_PK" 			PRIMARY KEY ("DEALING_DATE_ID"),
	CONSTRAINT "FUND_DEALING_DATES_FK" 			FOREIGN KEY ("FUND_CODE") REFERENCES "FUND" ("FUND_CODE")
);

ALTER TABLE CCLA_PROCESS_DATES ADD ("DATE_TYPE" VARCHAR2(20 CHAR));